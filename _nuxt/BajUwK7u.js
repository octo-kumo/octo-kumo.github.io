const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B5769S6r.js","./CE1G-McA.js","./TDtrdbi3.js","./z03eawDO.js"])))=>i.map(i=>d[i]);
import{D as K,_ as ae}from"./mpRoWkBO.js";import{E as le}from"./WlXJO-32.js";import{E as ne}from"./Zf_HP6PP.js";import{E as re}from"./DVeqoeK3.js";import{E as se,v as ie}from"./CpFlX34R.js";import{E as ue,a as pe}from"./DQcnEMwU.js";import{E as me}from"./9owE_yBM.js";import{E as de}from"./B6Mhy4WD.js";import{E as ce}from"./DM9fvJ3D.js";import{E as fe}from"./CJN6Q2WT.js";import{E as ve}from"./BLOMouaw.js";import"./CXgh2bVR.js";import{d as ge,e as x,b as F,w as we,c as S,O as n,L as k,P as r,a as C,K as V,k as Y,u as l,F as ye,_ as _e,M as j,a6 as he,a2 as Ee,J as X,N as M}from"./Cdy4ovlM.js";import"./Bj2b9i9X.js";import"./D7SBKgv0.js";import"./Cq9Fpw4b.js";import"./Bp3YSIOJ.js";import"./0_5aF3rL.js";import"./B2_D2k1b.js";import"./DdjagA1o.js";import"./C4GAp2rc.js";import"./hWEbwS_-.js";import"./CM9Vt25o.js";import"./CKYzR6Dw.js";import"./56rOo4GG.js";import"./lEc_mr0M.js";import"./hT5EZHBq.js";import"./BWHN3Fq2.js";import"./Bu0khPrm.js";import"./CNFK1gg8.js";import"./C8b4-tx9.js";import"./CDCU4beR.js";import"./CSF8GnY5.js";import"./BB_Ol6Sd.js";import"./B3lhUXGt.js";import"./BmU_cfaq.js";import"./DIhoAStX.js";import"./BUADUvnR.js";import"./B2bONxHh.js";import"./BwwvTQnZ.js";import"./Bsm-pjvr.js";import"./zcHPfVOM.js";function xe(u,m=!1,p=1){const o=m?1e3:1024;if(Math.abs(u)<o)return u+" B";const y=m?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let f=-1;const b=10**p;do u/=o,++f;while(Math.round(Math.abs(u)*b)/b>=o&&f<y.length-1);return u.toFixed(p)+" "+y[f]}function W(u,m,p){const o=document.createElementNS("http://www.w3.org/1999/xhtml","a");m=m||"download",o.download=m,o.rel="noopener",typeof u=="string"?(o.href=u,o.origin!==location.origin?Ve(o.href)?be(u,m):Z(o,o.target="_blank"):Z(o)):(o.href=URL.createObjectURL(u),setTimeout(function(){URL.revokeObjectURL(o.href)},4e4),setTimeout(function(){Z(o)},0))}function be(u,m,p){const o=new XMLHttpRequest;o.open("GET",u),o.responseType="blob",o.onload=function(){W(o.response,m)},o.onerror=function(){console.error("could not download file")},o.send()}function Ve(u){const m=new XMLHttpRequest;m.open("HEAD",u,!1);try{m.send()}catch{}return m.status>=200&&m.status<=299}function Z(u,m){try{u.dispatchEvent(new MouseEvent("click"))}catch{const o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(o)}}const Be={key:0,class:"flex gap-2"},ke={key:0,class:"flex gap-4 mb-2"},Ue={class:"flex gap-4"},Ce=ge({__name:"image-slicer",setup(u){const m=x(null),p=x([]),o=x([]),y=x([]),f=x([]),b=x([]),A=x([]),I=x([]),D=x(!0),T=x(255),G=F(()=>b.value.map(({width:t},e)=>F({get:()=>t/y.value[e],set:s=>y.value[e]=t/s}))),O=F(()=>b.value.map(({height:t},e)=>F({get:()=>t/f.value[e],set:s=>f.value[e]=t/s}))),P=x("{name}_{x}_{y}");let U,H;function $(t){for(let e=9;e>0;e--)if(t%e===0)return e;return null}function Q(t,e){for(;e!==0;){const s=e;e=t%e,t=s}return t}async function q(){U||(U=(await K(async()=>{const{PNG:t}=await import("./B5769S6r.js").then(e=>e.b);return{PNG:t}},__vite__mapDeps([0,1,2]),import.meta.url)).PNG,H=await K(()=>import("./z03eawDO.js").then(t=>t.j),__vite__mapDeps([3,1,2]),import.meta.url))}async function ee(){await q(),o.value=p.value.map(t=>t.raw&&URL.createObjectURL(t.raw)).filter(t=>t),I.value=new Array(p.value.length).fill(!1),D.value=!1;for(let t=0;t<p.value.length;t++){I.value[t]=!0;const e=p.value[t].raw,s=e.type==="image/png"?await e.arrayBuffer():await te(e);try{await new Promise((h,i)=>U&&new U({filterType:4}).parse(s,async(_,v)=>{if(!v)return i(_);const{width:c,height:d}=b.value[t]=v,E=Q(c,d);y.value[t]=Math.floor(c/E),f.value[t]=Math.floor(d/E),console.log("gcd",c,d,E,y.value[t],f.value[t]),y.value[t]*f.value[t]>128&&(y.value[t]=$(c)??1,f.value[t]=$(d)??1),h(0)}))}catch(h){A.value[t]=h}I.value[t]=!1}D.value=!0}we(p,ee,{deep:!0});function te(t){return new Promise((e,s)=>{const h=new FileReader,i=new Image,_=document.createElement("canvas"),v=_.getContext("2d");h.onload=function(c){i.onload=function(){_.width=i.width,_.height=i.height,v?.drawImage(i,0,0),_.toBlob(d=>d?d.arrayBuffer().then(E=>e(E)):s(),"image/png")},i.onerror=s,i.src=c.target?.result},h.onerror=function(c){s(c)},h.readAsDataURL(t)})}async function oe(){for(let t=0;t<p.value.length;t++)I.value[t]=!0,await J(t),I.value[t]=!1}async function J(t){if(await q(),!U||!H)return;const e=p.value[t].raw,{width:s,height:h,data:i}=b.value[t],_=s/y.value[t],v=h/f.value[t],c=new H;for(let d=0;d<y.value[t];d++)for(let E=0;E<f.value[t];E++){const L=Math.floor(d*_),R=Math.floor(E*v);if(s-L<_||h-R<v)continue;const B=new U({filterType:4,width:_,height:v});let N=0;for(let g=0;g<v;g++)for(let a=0;a<_;a++){const w=((R+g)*s+L+a)*4,z=(g*_+a)*4;B.data[z]=i[w],B.data[z+1]=i[w+1],B.data[z+2]=i[w+2],B.data[z+3]=i[w+3],N<i[w+3]&&(N=i[w+3])}T.value>N||c.file(P.value.replace("{name}",e.name).replace("{x}",String(d)).replace("{y}",String(E))+".png",new Blob([U.sync.write(B)]),{binary:!0})}c.generateAsync({type:"blob"}).then(d=>W(d,`${e.name}.zip`))}return(t,e)=>{const s=le,h=ne,i=re,_=se,v=pe,c=me,d=ue,E=de,L=ce,R=fe,B=ve,N=ie;return C(),S("div",null,[n(s,null,{header:r(()=>[...e[4]||(e[4]=[V("Image Slicer",-1)])]),default:r(()=>[e[5]||(e[5]=k("p",null," Slice up your images based on grid size, only PNGs are exacto-cropped, other images are auto-converted to PNG via canvas API. Sliced images will be downloaded as a zip file. You can change both grid size and grid item size, they sync automatically. In case of fractional grid, extra parts will be discarded, you can also discard empty grids. ",-1)),e[6]||(e[6]=k("p",null,[k("b",null," Everything happens in your browser, nothing is uploaded to anywhere. ")],-1)),e[7]||(e[7]=k("p",null,[k("b",null,"You may run out of memory if the images are too large!")],-1))]),_:1}),n(h),n(s,null,{default:r(()=>[n(d,{gutter:5,class:"space-y-2"},{default:r(()=>[n(v,{cols:24},{default:r(()=>[n(_,{"file-list":l(p),"onUpdate:fileList":e[0]||(e[0]=g=>Y(p)?p.value=g:null),accept:"image/*",multiple:"","auto-upload":!1},{tip:r(()=>[...e[9]||(e[9]=[k("div",{class:"el-upload__tip"},"jpg/png files",-1)])]),default:r(()=>[n(i,null,{default:r(()=>[...e[8]||(e[8]=[V("Click to upload",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),n(v,{cols:24,md:8},{default:r(()=>[n(c,{modelValue:l(P),"onUpdate:modelValue":e[1]||(e[1]=g=>Y(P)?P.value=g:null)},{prefix:r(()=>[...e[10]||(e[10]=[V("format ",-1)])]),suffix:r(()=>[...e[11]||(e[11]=[V(".png",-1)])]),_:1},8,["modelValue"])]),_:1}),n(v,{cols:24,md:8},{default:r(()=>[n(c,{modelValue:l(T),"onUpdate:modelValue":e[2]||(e[2]=g=>Y(T)?T.value=g:null),placeholder:"Empty Item Elimination (max alpha)",type:"number",min:0,max:255},{suffix:r(()=>[...e[12]||(e[12]=[V("≤ keep",-1)])]),prefix:r(()=>[...e[13]||(e[13]=[V("discard",-1)])]),_:1},8,["modelValue"])]),_:1}),n(v,{cols:24,md:8},{default:r(()=>[n(i,{disabled:!l(D),onClick:e[3]||(e[3]=g=>oe())},{default:r(()=>[...e[14]||(e[14]=[V(" Crop All ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(h),n(d,{gutter:10},{default:r(()=>[(C(!0),S(ye,null,_e(l(p),(g,a)=>(C(),j(v,{cols:24,md:8,class:"mb-2"},{default:r(()=>[he((C(),j(s,{shadow:"hover"},Ee({header:r(()=>[V(M(g.name),1)]),default:r(()=>[n(E,{src:l(o)[a],style:{height:"200px",width:"100%"},fit:"cover",lazy:""},null,8,["src"]),l(b)[a]?(C(),S("div",Be,[n(L,{type:"primary",textContent:M(l(b)[a]?.width+"×"+l(b)[a]?.height)},null,8,["textContent"]),n(L,{type:"primary",textContent:M(g.raw.type.replace("image/",""))},null,8,["textContent"]),n(L,{type:"info",textContent:M(("displayFilesize"in t?t.displayFilesize:l(xe))(g.size,!0))},null,8,["textContent"])])):X("",!0),l(A)[a]?(C(),j(R,{key:1},{default:r(()=>[V(M(l(A)[a].message),1)]),_:2},1024)):X("",!0)]),_:2},[!isNaN(l(y)[a])&&!isNaN(l(f)[a])?{name:"footer",fn:r(()=>[l(G)[a]&&l(O)[a]?(C(),S("div",ke,[n(c,{type:"number",modelValue:l(G)[a].value,"onUpdate:modelValue":w=>l(G)[a].value=w},null,8,["modelValue","onUpdate:modelValue"]),n(c,{type:"number",modelValue:l(O)[a].value,"onUpdate:modelValue":w=>l(O)[a].value=w},null,8,["modelValue","onUpdate:modelValue"])])):X("",!0),k("div",Ue,[n(B,{type:"number",modelValue:l(y)[a],"onUpdate:modelValue":w=>l(y)[a]=w},null,8,["modelValue","onUpdate:modelValue"]),n(B,{type:"number",modelValue:l(f)[a],"onUpdate:modelValue":w=>l(f)[a]=w},null,8,["modelValue","onUpdate:modelValue"]),n(i,{onClick:w=>J(a),type:"primary",class:"flex-auto"},{default:r(()=>[...e[15]||(e[15]=[V(" Crop ",-1)])]),_:2},1032,["onClick"])])]),key:"0"}:void 0]),1024)),[[N,l(I)[a]]])]),_:2},1024))),256))]),_:1}),k("canvas",{ref_key:"canvas",ref:m,style:{display:"none"}},null,512)])}}}),wt=ae(Ce,[["__scopeId","data-v-7fb9dc85"]]);export{wt as default};
