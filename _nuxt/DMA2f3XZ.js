import{L as Bo,I as ms,U as Er,ap as Lr,aq as Ki,ar as Fo,as as nn,at as Ce,c as H,p as qe,au as Ne,o as fn,av as Cr,aw as Pr,ax as Yi,b as W,V as P,ay as Ho,Q as ei,az as Rr,O as zo,aA as _t,aB as Mr,r as oe,Z as Ir,am as Uo,aj as Or,al as Dr,ai as Nr,ak as $i,ac as Vo,an as ae,ao as kr,ad as Br,aC as Fr,aD as $n,aE as Hr,M as Go,D as Ft,u as It,X as zr,f as Bt,aF as Ur,a as gt,aG as Vr,aH as Gr,aI as jr,aJ as Xr,G as hi,P as jo,q as se,z as Kr,aK as Yr,aL as $r,aM as Wr,aa as qr,Y as Xo,_ as Zr,a8 as Rs,aN as Ms,aO as Is,aP as Os,aQ as Ds,aR as Wi,aS as Jr,j as xe,d as Ko,aT as Qr,aU as ea,v as De,T as je,y as Ns,R as _s,K as ci,J as mn,ah as V,ab as ta,g as Yo,a2 as _e,a1 as ne,$ as na,e as ia,a4 as yt,a3 as sa,l as oa,W as ra,k as aa,aV as ca,m as la,aW as ua}from"./6G4A7wwE.js";class fa extends Bo{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new ms(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(a){const c=o.parse(JSON.parse(a));t&&t(c)},n,i)}parse(e){return new ha(e)}}class ha{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],i=da(e,t,this.data);for(let o=0,r=i.length;o<r;o++)n.push(...i[o].toShapes());return n}}function da(s,e,t){const n=Array.from(s),i=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,r=[];let a=0,c=0;for(let l=0;l<n.length;l++){const u=n[l];if(u===`
`)a=0,c-=o;else{const f=pa(u,i,a,c,t);a+=f.offsetX,r.push(f.path)}}return r}function pa(s,e,t,n,i){const o=i.glyphs[s]||i.glyphs["?"];if(!o){console.error('THREE.Font: character "'+s+'" does not exists in font family '+i.familyName+".");return}const r=new Er;let a,c,l,u,f,h,d,y;if(o.o){const _=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let p=0,m=_.length;p<m;)switch(_[p++]){case"m":a=_[p++]*e+t,c=_[p++]*e+n,r.moveTo(a,c);break;case"l":a=_[p++]*e+t,c=_[p++]*e+n,r.lineTo(a,c);break;case"q":l=_[p++]*e+t,u=_[p++]*e+n,f=_[p++]*e+t,h=_[p++]*e+n,r.quadraticCurveTo(f,h,l,u);break;case"b":l=_[p++]*e+t,u=_[p++]*e+n,f=_[p++]*e+t,h=_[p++]*e+n,d=_[p++]*e+t,y=_[p++]*e+n,r.bezierCurveTo(f,h,d,y,l,u);break}}return{offsetX:o.ha*e,path:r}}function ks(s,e){if(e===Lr)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===Ki||e===Fo){let t=s.getIndex();if(t===null){const r=[],a=s.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);s.setIndex(r),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const n=t.count-2,i=[];if(e===Ki)for(let r=1;r<=n;r++)i.push(t.getX(0)),i.push(t.getX(r)),i.push(t.getX(r+1));else for(let r=0;r<n;r++)r%2===0?(i.push(t.getX(r)),i.push(t.getX(r+1)),i.push(t.getX(r+2))):(i.push(t.getX(r+2)),i.push(t.getX(r+1)),i.push(t.getX(r)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=s.clone();return o.setIndex(i),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}class ma extends Bo{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new wa(t)}),this.register(function(t){return new xa(t)}),this.register(function(t){return new Ra(t)}),this.register(function(t){return new Ma(t)}),this.register(function(t){return new Ia(t)}),this.register(function(t){return new va(t)}),this.register(function(t){return new Aa(t)}),this.register(function(t){return new Sa(t)}),this.register(function(t){return new Ea(t)}),this.register(function(t){return new ba(t)}),this.register(function(t){return new La(t)}),this.register(function(t){return new Ta(t)}),this.register(function(t){return new Pa(t)}),this.register(function(t){return new Ca(t)}),this.register(function(t){return new ga(t)}),this.register(function(t){return new Oa(t)}),this.register(function(t){return new Da(t)})}load(e,t,n,i){const o=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const l=nn.extractUrlBase(e);r=nn.resolveURL(l,this.path)}else r=nn.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){i?i(l):console.error(l),o.manager.itemError(e),o.manager.itemEnd(e)},c=new ms(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{o.parse(l,r,function(u){t(u),o.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let o;const r={},a={},c=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===$o){try{r[N.KHR_BINARY_GLTF]=new Na(e)}catch(f){i&&i(f);return}o=JSON.parse(r[N.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new $a(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const f=this.pluginCallbacks[u](l);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[f.name]=f,r[f.name]=!0}if(o.extensionsUsed)for(let u=0;u<o.extensionsUsed.length;++u){const f=o.extensionsUsed[u],h=o.extensionsRequired||[];switch(f){case N.KHR_MATERIALS_UNLIT:r[f]=new ya;break;case N.KHR_DRACO_MESH_COMPRESSION:r[f]=new ka(o,this.dracoLoader);break;case N.KHR_TEXTURE_TRANSFORM:r[f]=new Ba;break;case N.KHR_MESH_QUANTIZATION:r[f]=new Fa;break;default:h.indexOf(f)>=0&&a[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,t,i,o)})}}function _a(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const N={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ga{constructor(e){this.parser=e,this.name=N.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const o=t.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const u=new qe(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],Ne);const f=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Yi(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Pr(u),l.distance=f;break;case"spot":l=new Cr(u),l.distance=f,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),Oe(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),i=Promise.resolve(l),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,o=n.json.nodes[e],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class ya{constructor(){this.name=N.KHR_MATERIALS_UNLIT}getMaterialType(){return It}extendParams(e,t,n){const i=[];e.color=new qe(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const r=o.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],Ne),e.opacity=r[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",o.baseColorTexture,fn))}return Promise.all(i)}}class ba{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class wa{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new H(a,a)}return Promise.all(o)}}class xa{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class Ta{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(o)}}class va{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new qe(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ne)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",r.sheenColorTexture,fn)),r.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}}class Aa{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)}}class Sa{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new qe().setRGB(a[0],a[1],a[2],Ne),Promise.all(o)}}class Ea{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class La{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new qe().setRGB(a[0],a[1],a[2],Ne),r.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",r.specularColorTexture,fn)),Promise.all(o)}}class Ca{constructor(e){this.parser=e,this.name=N.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(o)}}class Pa{constructor(e){this.parser=e,this.name=N.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ce}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&o.push(n.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(o)}}class Ra{constructor(e){this.parser=e,this.name=N.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const o=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,r)}}class Ma{constructor(e){this.parser=e,this.name=N.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=i.images[r.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return n.loadTextureImage(e,r.source,c)}}class Ia{constructor(e){this.parser=e,this.name=N.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=i.images[r.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return n.loadTextureImage(e,r.source,c)}}class Oa{constructor(e){this.name=N.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(a){const c=i.byteOffset||0,l=i.byteLength||0,u=i.count,f=i.byteStride,h=new Uint8Array(a,c,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(u,f,h,i.mode,i.filter).then(function(d){return d.buffer}):r.ready.then(function(){const d=new ArrayBuffer(u*f);return r.decodeGltfBuffer(new Uint8Array(d),u,f,h,i.mode,i.filter),d})})}else return null}}class Da{constructor(e){this.name=N.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const l of i.primitives)if(l.mode!==le.TRIANGLES&&l.mode!==le.TRIANGLE_STRIP&&l.mode!==le.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=n.extensions[this.name].attributes,a=[],c={};for(const l in r)a.push(this.parser.getDependency("accessor",r[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const u=l.pop(),f=u.isGroup?u.children:[u],h=l[0].count,d=[];for(const y of f){const _=new W,p=new P,m=new ei,g=new P(1,1,1),b=new Ho(y.geometry,y.material,h);for(let w=0;w<h;w++)c.TRANSLATION&&p.fromBufferAttribute(c.TRANSLATION,w),c.ROTATION&&m.fromBufferAttribute(c.ROTATION,w),c.SCALE&&g.fromBufferAttribute(c.SCALE,w),b.setMatrixAt(w,_.compose(p,m,g));for(const w in c)if(w==="_COLOR_0"){const x=c[w];b.instanceColor=new Rr(x.array,x.itemSize,x.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&y.geometry.setAttribute(w,c[w]);zo.prototype.copy.call(b,y),this.parser.assignFinalMaterial(b),d.push(b)}return u.isGroup?(u.clear(),u.add(...d),u):d[0]}))}}const $o="glTF",zt=12,Bs={JSON:1313821514,BIN:5130562};class Na{constructor(e){this.name=N.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,zt),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==$o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-zt,o=new DataView(e,zt);let r=0;for(;r<i;){const a=o.getUint32(r,!0);r+=4;const c=o.getUint32(r,!0);if(r+=4,c===Bs.JSON){const l=new Uint8Array(e,zt+r,a);this.content=n.decode(l)}else if(c===Bs.BIN){const l=zt+r;this.body=e.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ka{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=N.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},c={},l={};for(const u in r){const f=qi[u]||u.toLowerCase();a[f]=r[u]}for(const u in e.attributes){const f=qi[u]||u.toLowerCase();if(r[u]!==void 0){const h=n.accessors[e.attributes[u]],d=kt[h.componentType];l[f]=d.name,c[f]=h.normalized===!0}}return t.getDependency("bufferView",o).then(function(u){return new Promise(function(f,h){i.decodeDracoFile(u,function(d){for(const y in d.attributes){const _=d.attributes[y],p=c[y];p!==void 0&&(_.normalized=p)}f(d)},a,l,Ne,h)})})}}class Ba{constructor(){this.name=N.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Fa{constructor(){this.name=N.KHR_MESH_QUANTIZATION}}class Wo extends Jr{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i*3+i;for(let r=0;r!==i;r++)t[r]=n[o+r];return t}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,u=i-t,f=(n-t)/u,h=f*f,d=h*f,y=e*l,_=y-l,p=-2*d+3*h,m=d-h,g=1-p,b=m-h+f;for(let w=0;w!==a;w++){const x=r[_+w+a],A=r[_+w+c]*u,T=r[y+w+a],S=r[y+w]*u;o[w]=g*x+b*A+p*T+m*S}return o}}const Ha=new ei;class za extends Wo{interpolate_(e,t,n,i){const o=super.interpolate_(e,t,n,i);return Ha.fromArray(o).normalize().toArray(o),o}}const le={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},kt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Fs={9728:Vo,9729:$i,9984:Nr,9985:Dr,9986:Or,9987:Uo},Hs={33071:Br,33648:kr,10497:ae},di={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Be={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ua={CUBICSPLINE:void 0,LINEAR:Xo,STEP:qr},pi={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Va(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new Go({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Wi})),s.DefaultMaterial}function it(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Oe(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ga(s,e,t){let n=!1,i=!1,o=!1;for(let l=0,u=e.length;l<u;l++){const f=e[l];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(i=!0),f.COLOR_0!==void 0&&(o=!0),n&&i&&o)break}if(!n&&!i&&!o)return Promise.resolve(s);const r=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const f=e[l];if(n){const h=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):s.attributes.position;r.push(h)}if(i){const h=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):s.attributes.normal;a.push(h)}if(o){const h=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):s.attributes.color;c.push(h)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],f=l[1],h=l[2];return n&&(s.morphAttributes.position=u),i&&(s.morphAttributes.normal=f),o&&(s.morphAttributes.color=h),s.morphTargetsRelative=!0,s})}function ja(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Xa(s){let e;const t=s.extensions&&s.extensions[N.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+mi(t.attributes):e=s.indices+":"+mi(s.attributes)+":"+s.mode,s.targets!==void 0)for(let n=0,i=s.targets.length;n<i;n++)e+=":"+mi(s.targets[n]);return e}function mi(s){let e="";const t=Object.keys(s).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+s[t[n]]+";";return e}function Zi(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ka(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":s.search(/\.ktx2($|\?)/i)>0||s.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Ya=new W;class $a{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new _a,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=-1,o=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);i=n&&c?parseInt(c[1],10):-1,o=a.indexOf("Firefox")>-1,r=o?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&i<17||o&&r<98?this.textureLoader=new _t(this.options.manager):this.textureLoader=new Mr(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ms(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(r){const a={scene:r[0][i.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:i.asset,parser:n,userData:{}};return it(o,a,i),Oe(a,i),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=t.length;i<o;i++){const r=t[i].joints;for(let a=0,c=r.length;a<c;a++)e[r[a]].isBone=!0}for(let i=0,o=e.length;i<o;i++){const r=e[i];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(n[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),o=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[l,u]of r.children.entries())o(u,a.children[l])};return o(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const o=e(t[i]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(o,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[N.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(o,r){n.load(nn.resolveURL(t.uri,i.path),o,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const r=di[i.type],a=kt[i.componentType],c=i.normalized===!0,l=new a(i.count*r);return Promise.resolve(new oe(l,r,c))}const o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(r){const a=r[0],c=di[i.type],l=kt[i.componentType],u=l.BYTES_PER_ELEMENT,f=u*c,h=i.byteOffset||0,d=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,y=i.normalized===!0;let _,p;if(d&&d!==f){const m=Math.floor(h/d),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count;let b=t.cache.get(g);b||(_=new l(a,m*d,i.count*d/u),b=new Ir(_,d/u),t.cache.add(g,b)),p=new Zr(b,c,h%d/u,y)}else a===null?_=new l(i.count*c):_=new l(a,h,i.count*c),p=new oe(_,c,y);if(i.sparse!==void 0){const m=di.SCALAR,g=kt[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,w=i.sparse.values.byteOffset||0,x=new g(r[1],b,i.sparse.count*m),A=new l(r[2],w,i.sparse.count*c);a!==null&&(p=new oe(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let T=0,S=x.length;T<S;T++){const E=x[T];if(p.setX(E,A[T*c]),c>=2&&p.setY(E,A[T*c+1]),c>=3&&p.setZ(E,A[T*c+2]),c>=4&&p.setW(E,A[T*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=y}return p})}loadTexture(e){const t=this.json,n=this.options,o=t.textures[e].source,r=t.images[o];let a=this.textureLoader;if(r.uri){const c=n.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(e,o,a)}loadTextureImage(e,t,n){const i=this,o=this.json,r=o.textures[e],a=o.images[t],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=r.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const h=(o.samplers||{})[r.sampler]||{};return u.magFilter=Fs[h.magFilter]||$i,u.minFilter=Fs[h.minFilter]||Uo,u.wrapS=Hs[h.wrapS]||ae,u.wrapT=Hs[h.wrapT]||ae,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==Vo&&u.minFilter!==$i,i.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,i=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const r=i.images[e],a=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=n.getDependency("bufferView",r.bufferView).then(function(f){l=!0;const h=new Blob([f],{type:r.mimeType});return c=a.createObjectURL(h),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(f){return new Promise(function(h,d){let y=h;t.isImageBitmapLoader===!0&&(y=function(_){const p=new Rs(_);p.needsUpdate=!0,h(p)}),t.load(nn.resolveURL(f,o.path),y,void 0,d)})}).then(function(f){return l===!0&&a.revokeObjectURL(c),Oe(f,r),f.userData.mimeType=r.mimeType||Ka(r.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),f});return this.sourceCache[e]=u,u}assignTexture(e,t,n,i){const o=this;return this.getDependency("texture",n.index).then(function(r){if(!r)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(r=r.clone(),r.channel=n.texCoord),o.extensions[N.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[N.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=o.associations.get(r);r=o.extensions[N.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),o.associations.set(r,c)}}return i!==void 0&&(r.colorSpace=i),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new Fr,$n.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new Hr,$n.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(a,c)),n=c}if(i||o||r){let a="ClonedMaterial:"+n.uuid+":";i&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),o&&(c.vertexColors=!0),r&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return Go}loadMaterial(e){const t=this,n=this.json,i=this.extensions,o=n.materials[e];let r;const a={},c=o.extensions||{},l=[];if(c[N.KHR_MATERIALS_UNLIT]){const f=i[N.KHR_MATERIALS_UNLIT];r=f.getMaterialType(),l.push(f.extendParams(a,o,t))}else{const f=o.pbrMetallicRoughness||{};if(a.color=new qe(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const h=f.baseColorFactor;a.color.setRGB(h[0],h[1],h[2],Ne),a.opacity=h[3]}f.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",f.baseColorTexture,fn)),a.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,a.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),r=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}o.doubleSided===!0&&(a.side=Ft);const u=o.alphaMode||pi.OPAQUE;if(u===pi.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===pi.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&r!==It&&(l.push(t.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new H(1,1),o.normalTexture.scale!==void 0)){const f=o.normalTexture.scale;a.normalScale.set(f,f)}if(o.occlusionTexture!==void 0&&r!==It&&(l.push(t.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&r!==It){const f=o.emissiveFactor;a.emissive=new qe().setRGB(f[0],f[1],f[2],Ne)}return o.emissiveTexture!==void 0&&r!==It&&l.push(t.assignTexture(a,"emissiveMap",o.emissiveTexture,fn)),Promise.all(l).then(function(){const f=new r(a);return o.name&&(f.name=o.name),Oe(f,o),t.associations.set(f,{materials:e}),o.extensions&&it(i,f,o),f})}createUniqueName(e){const t=zr.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function o(a){return n[N.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return zs(c,a,t)})}const r=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],u=Xa(l),f=i[u];if(f)r.push(f.promise);else{let h;l.extensions&&l.extensions[N.KHR_DRACO_MESH_COMPRESSION]?h=o(l):h=zs(new Bt,l,t),i[u]={primitive:l,promise:h},r.push(h)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,i=this.extensions,o=n.meshes[e],r=o.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const u=r[c].material===void 0?Va(this.cache):this.getDependency("material",r[c].material);a.push(u)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],f=[];for(let d=0,y=u.length;d<y;d++){const _=u[d],p=r[d];let m;const g=l[d];if(p.mode===le.TRIANGLES||p.mode===le.TRIANGLE_STRIP||p.mode===le.TRIANGLE_FAN||p.mode===void 0)m=o.isSkinnedMesh===!0?new Ur(_,g):new gt(_,g),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),p.mode===le.TRIANGLE_STRIP?m.geometry=ks(m.geometry,Fo):p.mode===le.TRIANGLE_FAN&&(m.geometry=ks(m.geometry,Ki));else if(p.mode===le.LINES)m=new Vr(_,g);else if(p.mode===le.LINE_STRIP)m=new Gr(_,g);else if(p.mode===le.LINE_LOOP)m=new jr(_,g);else if(p.mode===le.POINTS)m=new Xr(_,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(m.geometry.morphAttributes).length>0&&ja(m,o),m.name=t.createUniqueName(o.name||"mesh_"+e),Oe(m,o),p.extensions&&it(i,m,p),t.assignFinalMaterial(m),f.push(m)}for(let d=0,y=f.length;d<y;d++)t.associations.set(f[d],{meshes:e,primitives:d});if(f.length===1)return o.extensions&&it(i,f[0],o),f[0];const h=new hi;o.extensions&&it(i,h,o),t.associations.set(h,{meshes:e});for(let d=0,y=f.length;d<y;d++)h.add(f[d]);return h})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new jo(se.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Kr(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Oe(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,o=t.joints.length;i<o;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const o=i.pop(),r=i,a=[],c=[];for(let l=0,u=r.length;l<u;l++){const f=r[l];if(f){a.push(f);const h=new W;o!==null&&h.fromArray(o.array,l*16),c.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Yr(a,c)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],o=i.name?i.name:"animation_"+e,r=[],a=[],c=[],l=[],u=[];for(let f=0,h=i.channels.length;f<h;f++){const d=i.channels[f],y=i.samplers[d.sampler],_=d.target,p=_.node,m=i.parameters!==void 0?i.parameters[y.input]:y.input,g=i.parameters!==void 0?i.parameters[y.output]:y.output;_.node!==void 0&&(r.push(this.getDependency("node",p)),a.push(this.getDependency("accessor",m)),c.push(this.getDependency("accessor",g)),l.push(y),u.push(_))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(f){const h=f[0],d=f[1],y=f[2],_=f[3],p=f[4],m=[];for(let g=0,b=h.length;g<b;g++){const w=h[g],x=d[g],A=y[g],T=_[g],S=p[g];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const E=n._createAnimationTracks(w,x,A,T,S);if(E)for(let R=0;R<E.length;R++)m.push(E[R])}return new $r(o,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){const r=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let c=0,l=i.weights.length;c<l;c++)a.morphTargetInfluences[c]=i.weights[c]}),r})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],o=n._loadNodeShallow(e),r=[],a=i.children||[];for(let l=0,u=a.length;l<u;l++)r.push(n.getDependency("node",a[l]));const c=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([o,Promise.all(r),c]).then(function(l){const u=l[0],f=l[1],h=l[2];h!==null&&u.traverse(function(d){d.isSkinnedMesh&&d.bind(h,Ya)});for(let d=0,y=f.length;d<y;d++)u.add(f[d]);return u})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],r=o.name?i.createUniqueName(o.name):"",a=[],c=i._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),o.camera!==void 0&&a.push(i.getDependency("camera",o.camera).then(function(l){return i._getNodeRef(i.cameraCache,o.camera,l)})),i._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let u;if(o.isBone===!0?u=new Wr:l.length>1?u=new hi:l.length===1?u=l[0]:u=new zo,u!==l[0])for(let f=0,h=l.length;f<h;f++)u.add(l[f]);if(o.name&&(u.userData.name=o.name,u.name=r),Oe(u,o),o.extensions&&it(n,u,o),o.matrix!==void 0){const f=new W;f.fromArray(o.matrix),u.applyMatrix4(f)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);if(!i.associations.has(u))i.associations.set(u,{});else if(o.mesh!==void 0&&i.meshCache.refs[o.mesh]>1){const f=i.associations.get(u);i.associations.set(u,{...f})}return i.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,o=new hi;n.name&&(o.name=i.createUniqueName(n.name)),Oe(o,n),n.extensions&&it(t,o,n);const r=n.nodes||[],a=[];for(let c=0,l=r.length;c<l;c++)a.push(i.getDependency("node",r[c]));return Promise.all(a).then(function(c){for(let u=0,f=c.length;u<f;u++)o.add(c[u]);const l=u=>{const f=new Map;for(const[h,d]of i.associations)(h instanceof $n||h instanceof Rs)&&f.set(h,d);return u.traverse(h=>{const d=i.associations.get(h);d!=null&&f.set(h,d)}),f};return i.associations=l(o),o})}_createAnimationTracks(e,t,n,i,o){const r=[],a=e.name?e.name:e.uuid,c=[];Be[o.path]===Be.weights?e.traverse(function(h){h.morphTargetInfluences&&c.push(h.name?h.name:h.uuid)}):c.push(a);let l;switch(Be[o.path]){case Be.weights:l=Is;break;case Be.rotation:l=Os;break;case Be.translation:case Be.scale:l=Ms;break;default:switch(n.itemSize){case 1:l=Is;break;case 2:case 3:default:l=Ms;break}break}const u=i.interpolation!==void 0?Ua[i.interpolation]:Xo,f=this._getArrayFromAccessor(n);for(let h=0,d=c.length;h<d;h++){const y=new l(c[h]+"."+Be[o.path],t.array,f,u);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(y),r.push(y)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=Zi(t.constructor),i=new Float32Array(t.length);for(let o=0,r=t.length;o<r;o++)i[o]=t[o]*n;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const i=this instanceof Os?za:Wo;return new i(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Wa(s,e,t){const n=e.attributes,i=new xe;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(i.set(new P(c[0],c[1],c[2]),new P(l[0],l[1],l[2])),a.normalized){const u=Zi(kt[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const a=new P,c=new P;for(let l=0,u=o.length;l<u;l++){const f=o[l];if(f.POSITION!==void 0){const h=t.json.accessors[f.POSITION],d=h.min,y=h.max;if(d!==void 0&&y!==void 0){if(c.setX(Math.max(Math.abs(d[0]),Math.abs(y[0]))),c.setY(Math.max(Math.abs(d[1]),Math.abs(y[1]))),c.setZ(Math.max(Math.abs(d[2]),Math.abs(y[2]))),h.normalized){const _=Zi(kt[h.componentType]);c.multiplyScalar(_)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}s.boundingBox=i;const r=new Ko;i.getCenter(r.center),r.radius=i.min.distanceTo(i.max)/2,s.boundingSphere=r}function zs(s,e,t){const n=e.attributes,i=[];function o(r,a){return t.getDependency("accessor",r).then(function(c){s.setAttribute(a,c)})}for(const r in n){const a=qi[r]||r.toLowerCase();a in s.attributes||i.push(o(n[r],a))}if(e.indices!==void 0&&!s.index){const r=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});i.push(r)}return Ds.workingColorSpace!==Ne&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ds.workingColorSpace}" not supported.`),Oe(s,e),Wa(s,e,t),Promise.all(i).then(function(){return e.targets!==void 0?Ga(s,e.targets,t):s})}const Ji=new W;Ji.setPosition(99999,99999,99999);const qa={},Za={},Xe={};let ti;const Ja=new ma;new _t;const Qa="/projects/assets/";function qo(s){s instanceof $n?s.metalness=0:Array.isArray(s)&&s.forEach(e=>{e.metalness=0})}function ec(s){ti=s;const e=Object.values(Xe).flatMap(t=>t.meshes);e.length>0&&ti.add(...e)}function tc(s,e=!1,t=!1){return qa[s]??=Ja.loadAsync(Qa+s).then(n=>(n.scene.traverse(i=>{if(i.type==="Mesh"){const o=i;o.geometry.computeVertexNormals(),o.geometry.computeBoundingBox(),o.receiveShadow=e,o.castShadow=t,qo(o.material)}}),n))}async function Us(s){const e=Xe[s],t=e?.capacity?e?.capacity*2:1;return(Za[s]??={})[t]??=(async function(){const n=await tc(s),i={capacity:t,count:e?.count??0,meshes:[],offsets:[]};if(n.scene.traverse(o=>{if(o.type==="Mesh"){const r=o;qo(r.material);const a=new Ho(r.geometry,r.material,t),c=new P;o.getWorldPosition(c),i.offsets.push(c),i.meshes.push(a),a.castShadow=!0,a.receiveShadow=!0,ti?.add(a)}}),e){let o=new W;if(i.meshes.length!==e.meshes.length)throw new Error("Mesh length mismatch during expansion!");for(let r=0;r<i.meshes.length;r++){for(let a=0;a<e.count;a++)e.meshes[r].getMatrixAt(a,o),i.meshes[r].setMatrixAt(a,o);for(let a=e.count;a<t;a++)i.meshes[r].setMatrixAt(a,Ji)}ti?.remove(...e.meshes),e.meshes.forEach(r=>r.dispose()),e.meshes=[]}else for(let o=0;o<i.meshes.length;o++)for(let r=0;r<t;r++)i.meshes[o].setMatrixAt(r,Ji);return Xe[s]=i})()}async function nc(s){Xe[s]||(Xe[s]=await Us(s));const e=Xe[s].count++;for(;e>=Xe[s].capacity;)await Us(s);return e}async function ff(s){const e=await nc(s);return t=>{Xe[s]?.meshes.forEach(n=>{n.setMatrixAt(e,t)})}}let _i;async function hf(s,e,t="left",n="bottom"){_i||(_i=await new fa().loadAsync("https://raw.githubusercontent.com/mrdoob/three.js/e7fd8b9d7d941c4670521f7d843a7fa12435410a/examples/fonts/helvetiker_regular.typeface.json"));const i=26265,o=new It({color:i,side:Ft}),r=_i.generateShapes(s,e),a=new Qr(r);a.computeBoundingBox();const c=(a.boundingBox?.max?.x??0)-(a.boundingBox?.min?.x??0),l=(a.boundingBox?.max?.y??0)-(a.boundingBox?.min?.y??0);t=="center"?a.translate(-.5*c,0,0):t==="right"&&a.translate(-c,0,0),n=="center"?a.translate(0,-.5*l,0):n==="top"&&a.translate(0,-l,0);let u=new gt(a,o);return u.castShadow=!0,u}function ic(s){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=s,document.head.appendChild(e),s}}function Ot(s,e){var t=s.__state.conversionName.toString(),n=Math.round(s.r),i=Math.round(s.g),o=Math.round(s.b),r=s.a,a=Math.round(s.h),c=s.s.toFixed(1),l=s.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var u=s.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}else{if(t==="CSS_RGB")return"rgb("+n+","+i+","+o+")";if(t==="CSS_RGBA")return"rgba("+n+","+i+","+o+","+r+")";if(t==="HEX")return"0x"+s.hex.toString(16);if(t==="RGB_ARRAY")return"["+n+","+i+","+o+"]";if(t==="RGBA_ARRAY")return"["+n+","+i+","+o+","+r+"]";if(t==="RGB_OBJ")return"{r:"+n+",g:"+i+",b:"+o+"}";if(t==="RGBA_OBJ")return"{r:"+n+",g:"+i+",b:"+o+",a:"+r+"}";if(t==="HSV_OBJ")return"{h:"+a+",s:"+c+",v:"+l+"}";if(t==="HSVA_OBJ")return"{h:"+a+",s:"+c+",v:"+l+",a:"+r+"}"}return"unknown format"}var Vs=Array.prototype.forEach,Ut=Array.prototype.slice,L={BREAK:{},extend:function(e){return this.each(Ut.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(i){this.isUndefined(t[i])||(e[i]=t[i])}.bind(this))},this),e},defaults:function(e){return this.each(Ut.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(i){this.isUndefined(e[i])&&(e[i]=t[i])}.bind(this))},this),e},compose:function(){var e=Ut.call(arguments);return function(){for(var t=Ut.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e){if(Vs&&e.forEach&&e.forEach===Vs)e.forEach(t,n);else if(e.length===e.length+0){var i=void 0,o=void 0;for(i=0,o=e.length;i<o;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i=void 0;return function(){var o=this,r=arguments;function a(){i=null,n||e.apply(o,r)}var c=n||!i;clearTimeout(i),i=setTimeout(a,t),c&&e.apply(o,r)}},toArray:function(e){return e.toArray?e.toArray():Ut.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:(function(s){function e(t){return s.apply(this,arguments)}return e.toString=function(){return s.toString()},e})(function(s){return isNaN(s)}),isArray:Array.isArray||function(s){return s.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},sc=[{litmus:L.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Ot},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Ot},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Ot},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Ot}}},{litmus:L.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:L.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:L.isObject,conversions:{RGBA_OBJ:{read:function(e){return L.isNumber(e.r)&&L.isNumber(e.g)&&L.isNumber(e.b)&&L.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return L.isNumber(e.r)&&L.isNumber(e.g)&&L.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return L.isNumber(e.h)&&L.isNumber(e.s)&&L.isNumber(e.v)&&L.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return L.isNumber(e.h)&&L.isNumber(e.s)&&L.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Vt=void 0,yn=void 0,Qi=function(){yn=!1;var e=arguments.length>1?L.toArray(arguments):arguments[0];return L.each(sc,function(t){if(t.litmus(e))return L.each(t.conversions,function(n,i){if(Vt=n.read(e),yn===!1&&Vt!==!1)return yn=Vt,Vt.conversionName=i,Vt.conversion=n,L.BREAK}),L.BREAK}),yn},Gs=void 0,ni={hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),r=n*(1-t),a=n*(1-o*t),c=n*(1-(1-o)*t),l=[[n,c,r],[a,n,r],[r,n,c],[r,a,n],[c,r,n],[n,r,a]][i];return{r:l[0]*255,g:l[1]*255,b:l[2]*255}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),o=Math.max(e,t,n),r=o-i,a=void 0,c=void 0;if(o!==0)c=r/o;else return{h:NaN,s:0,v:0};return e===o?a=(t-n)/r:t===o?a=2+(n-e)/r:a=4+(e-t)/r,a/=6,a<0&&(a+=1),{h:a*360,s:c,v:o/255}},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n),i},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,n){return n<<(Gs=t*8)|e&~(255<<Gs)}},oc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},Te=function(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")},ve=(function(){function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}})(),Ze=function s(e,t,n){e===null&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(i===void 0){var o=Object.getPrototypeOf(e);return o===null?void 0:s(o,t,n)}else{if("value"in i)return i.value;var r=i.get;return r===void 0?void 0:r.call(n)}},et=function(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):s.__proto__=e)},tt=function(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:s},$=(function(){function s(){if(Te(this,s),this.__state=Qi.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ve(s,[{key:"toString",value:function(){return Ot(this)}},{key:"toHexString",value:function(){return Ot(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),s})();function gs(s,e,t){Object.defineProperty(s,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:($.recalculateRGB(this,e,t),this.__state[e])},set:function(i){this.__state.space!=="RGB"&&($.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=i}})}function ys(s,e){Object.defineProperty(s,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:($.recalculateHSV(this),this.__state[e])},set:function(n){this.__state.space!=="HSV"&&($.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=n}})}$.recalculateRGB=function(s,e,t){if(s.__state.space==="HEX")s.__state[e]=ni.component_from_hex(s.__state.hex,t);else if(s.__state.space==="HSV")L.extend(s.__state,ni.hsv_to_rgb(s.__state.h,s.__state.s,s.__state.v));else throw new Error("Corrupted color state")};$.recalculateHSV=function(s){var e=ni.rgb_to_hsv(s.r,s.g,s.b);L.extend(s.__state,{s:e.s,v:e.v}),L.isNaN(e.h)?L.isUndefined(s.__state.h)&&(s.__state.h=0):s.__state.h=e.h};$.COMPONENTS=["r","g","b","h","s","v","hex","a"];gs($.prototype,"r",2);gs($.prototype,"g",1);gs($.prototype,"b",0);ys($.prototype,"h");ys($.prototype,"s");ys($.prototype,"v");Object.defineProperty($.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty($.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ni.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var bt=(function(){function s(e,t){Te(this,s),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return ve(s,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),s})(),rc={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Zo={};L.each(rc,function(s,e){L.each(s,function(t){Zo[t]=e})});var ac=/(\d+(\.\d+)?)px/;function Ae(s){if(s==="0"||L.isUndefined(s))return 0;var e=s.match(ac);return L.isNull(e)?0:parseFloat(e[1])}var v={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,o=t;L.isUndefined(o)&&(o=!0),L.isUndefined(i)&&(i=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var o=n||{},r=Zo[t];if(!r)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":{var c=o.x||o.clientX||0,l=o.y||o.clientY||0;a.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,c,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var u=a.initKeyboardEvent||a.initKeyEvent;L.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{a.initEvent(t,o.bubbles||!1,o.cancelable||!0);break}}L.defaults(a,i),e.dispatchEvent(a)},bind:function(e,t,n,i){var o=i||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),v},unbind:function(e,t,n,i){var o=i||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),v},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)===-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return v},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);i!==-1&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return v},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return Ae(t["border-left-width"])+Ae(t["border-right-width"])+Ae(t["padding-left"])+Ae(t["padding-right"])+Ae(t.width)},getHeight:function(e){var t=getComputedStyle(e);return Ae(t["border-top-width"])+Ae(t["border-bottom-width"])+Ae(t["padding-top"])+Ae(t["padding-bottom"])+Ae(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Jo=(function(s){et(e,s);function e(t,n){Te(this,e);var i=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox");function r(){o.setValue(!o.__prev)}return v.bind(i.__checkbox,"change",r,!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return ve(e,[{key:"setValue",value:function(n){var i=Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(bt),cc=(function(s){et(e,s);function e(t,n,i){Te(this,e);var o=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i,a=o;if(o.__select=document.createElement("select"),L.isArray(r)){var c={};L.each(r,function(l){c[l]=l}),r=c}return L.each(r,function(l,u){var f=document.createElement("option");f.innerHTML=u,f.setAttribute("value",l),a.__select.appendChild(f)}),o.updateDisplay(),v.bind(o.__select,"change",function(){var l=this.options[this.selectedIndex].value;a.setValue(l)}),o.domElement.appendChild(o.__select),o}return ve(e,[{key:"setValue",value:function(n){var i=Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return v.isActive(this.__select)?this:(this.__select.value=this.getValue(),Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e})(bt),lc=(function(s){et(e,s);function e(t,n){Te(this,e);var i=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;function r(){o.setValue(o.__input.value)}function a(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),v.bind(i.__input,"keyup",r),v.bind(i.__input,"change",r),v.bind(i.__input,"blur",a),v.bind(i.__input,"keydown",function(c){c.keyCode===13&&this.blur()}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return ve(e,[{key:"updateDisplay",value:function(){return v.isActive(this.__input)||(this.__input.value=this.getValue()),Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(bt);function js(s){var e=s.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Qo=(function(s){et(e,s);function e(t,n,i){Te(this,e);var o=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i||{};return o.__min=r.min,o.__max=r.max,o.__step=r.step,L.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=js(o.__impliedStep),o}return ve(e,[{key:"setValue",value:function(n){var i=n;return this.__min!==void 0&&i<this.__min?i=this.__min:this.__max!==void 0&&i>this.__max&&(i=this.__max),this.__step!==void 0&&i%this.__step!==0&&(i=Math.round(i/this.__step)*this.__step),Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(n){return this.__min=n,this}},{key:"max",value:function(n){return this.__max=n,this}},{key:"step",value:function(n){return this.__step=n,this.__impliedStep=n,this.__precision=js(n),this}}]),e})(bt);function uc(s,e){var t=Math.pow(10,e);return Math.round(s*t)/t}var ii=(function(s){et(e,s);function e(t,n,i){Te(this,e);var o=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));o.__truncationSuspended=!1;var r=o,a=void 0;function c(){var y=parseFloat(r.__input.value);L.isNaN(y)||r.setValue(y)}function l(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function u(){l()}function f(y){var _=a-y.clientY;r.setValue(r.getValue()+_*r.__impliedStep),a=y.clientY}function h(){v.unbind(window,"mousemove",f),v.unbind(window,"mouseup",h),l()}function d(y){v.bind(window,"mousemove",f),v.bind(window,"mouseup",h),a=y.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),v.bind(o.__input,"change",c),v.bind(o.__input,"blur",u),v.bind(o.__input,"mousedown",d),v.bind(o.__input,"keydown",function(y){y.keyCode===13&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,l())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return ve(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():uc(this.getValue(),this.__precision),Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(Qo);function Xs(s,e,t,n,i){return n+(i-n)*((s-e)/(t-e))}var es=(function(s){et(e,s);function e(t,n,i,o,r){Te(this,e);var a=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:o,step:r})),c=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),v.bind(a.__background,"mousedown",l),v.bind(a.__background,"touchstart",h),v.addClass(a.__background,"slider"),v.addClass(a.__foreground,"slider-fg");function l(_){document.activeElement.blur(),v.bind(window,"mousemove",u),v.bind(window,"mouseup",f),u(_)}function u(_){_.preventDefault();var p=c.__background.getBoundingClientRect();return c.setValue(Xs(_.clientX,p.left,p.right,c.__min,c.__max)),!1}function f(){v.unbind(window,"mousemove",u),v.unbind(window,"mouseup",f),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function h(_){_.touches.length===1&&(v.bind(window,"touchmove",d),v.bind(window,"touchend",y),d(_))}function d(_){var p=_.touches[0].clientX,m=c.__background.getBoundingClientRect();c.setValue(Xs(p,m.left,m.right,c.__min,c.__max))}function y(){v.unbind(window,"touchmove",d),v.unbind(window,"touchend",y),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return ve(e,[{key:"updateDisplay",value:function(){var n=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=n*100+"%",Ze(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(Qo),er=(function(s){et(e,s);function e(t,n,i){Te(this,e);var o=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=i===void 0?"Fire":i,v.bind(o.__button,"click",function(a){return a.preventDefault(),r.fire(),!1}),v.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return ve(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e})(bt),ts=(function(s){et(e,s);function e(t,n){Te(this,e);var i=tt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new $(i.getValue()),i.__temp=new $(0);var o=i;i.domElement=document.createElement("div"),v.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",v.bind(i.__input,"keydown",function(_){_.keyCode===13&&f.call(this)}),v.bind(i.__input,"blur",f),v.bind(i.__selector,"mousedown",function(){v.addClass(this,"drag").bind(window,"mouseup",function(){v.removeClass(o.__selector,"drag")})}),v.bind(i.__selector,"touchstart",function(){v.addClass(this,"drag").bind(window,"touchend",function(){v.removeClass(o.__selector,"drag")})});var r=document.createElement("div");L.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),L.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),L.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),L.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),L.extend(r.style,{width:"100%",height:"100%",background:"none"}),Ks(r,"top","rgba(0,0,0,0)","#000"),L.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hc(i.__hue_field),L.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),v.bind(i.__saturation_field,"mousedown",a),v.bind(i.__saturation_field,"touchstart",a),v.bind(i.__field_knob,"mousedown",a),v.bind(i.__field_knob,"touchstart",a),v.bind(i.__hue_field,"mousedown",c),v.bind(i.__hue_field,"touchstart",c);function a(_){d(_),v.bind(window,"mousemove",d),v.bind(window,"touchmove",d),v.bind(window,"mouseup",l),v.bind(window,"touchend",l)}function c(_){y(_),v.bind(window,"mousemove",y),v.bind(window,"touchmove",y),v.bind(window,"mouseup",u),v.bind(window,"touchend",u)}function l(){v.unbind(window,"mousemove",d),v.unbind(window,"touchmove",d),v.unbind(window,"mouseup",l),v.unbind(window,"touchend",l),h()}function u(){v.unbind(window,"mousemove",y),v.unbind(window,"touchmove",y),v.unbind(window,"mouseup",u),v.unbind(window,"touchend",u),h()}function f(){var _=Qi(this.value);_!==!1?(o.__color.__state=_,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function h(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}i.__saturation_field.appendChild(r),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay();function d(_){_.type.indexOf("touch")===-1&&_.preventDefault();var p=o.__saturation_field.getBoundingClientRect(),m=_.touches&&_.touches[0]||_,g=m.clientX,b=m.clientY,w=(g-p.left)/(p.right-p.left),x=1-(b-p.top)/(p.bottom-p.top);return x>1?x=1:x<0&&(x=0),w>1?w=1:w<0&&(w=0),o.__color.v=x,o.__color.s=w,o.setValue(o.__color.toOriginal()),!1}function y(_){_.type.indexOf("touch")===-1&&_.preventDefault();var p=o.__hue_field.getBoundingClientRect(),m=_.touches&&_.touches[0]||_,g=m.clientY,b=1-(g-p.top)/(p.bottom-p.top);return b>1?b=1:b<0&&(b=0),o.__color.h=b*360,o.setValue(o.__color.toOriginal()),!1}return i}return ve(e,[{key:"updateDisplay",value:function(){var n=Qi(this.getValue());if(n!==!1){var i=!1;L.each($.COMPONENTS,function(a){if(!L.isUndefined(n[a])&&!L.isUndefined(this.__color.__state[a])&&n[a]!==this.__color.__state[a])return i=!0,{}},this),i&&L.extend(this.__color.__state,n)}L.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,r=255-o;L.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Ks(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),L.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e})(bt),fc=["-moz-","-o-","-webkit-","-ms-",""];function Ks(s,e,t,n){s.style.background="",L.each(fc,function(i){s.style.cssText+="background: "+i+"linear-gradient("+e+", "+t+" 0%, "+n+" 100%); "})}function hc(s){s.style.background="",s.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",s.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var dc={load:function(e,t){var n=t||document,i=n.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,n.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch{}}},pc=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,mc=function(e,t){var n=e[t];return L.isArray(arguments[2])||L.isObject(arguments[2])?new cc(e,t,arguments[2]):L.isNumber(n)?L.isNumber(arguments[2])&&L.isNumber(arguments[3])?L.isNumber(arguments[4])?new es(e,t,arguments[2],arguments[3],arguments[4]):new es(e,t,arguments[2],arguments[3]):L.isNumber(arguments[4])?new ii(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ii(e,t,{min:arguments[2],max:arguments[3]}):L.isString(n)?new lc(e,t):L.isFunction(n)?new er(e,t,""):L.isBoolean(n)?new Jo(e,t):null};function _c(s){setTimeout(s,1e3/60)}var gc=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||_c,yc=(function(){function s(){Te(this,s),this.backgroundElement=document.createElement("div"),L.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),v.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),L.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;v.bind(this.backgroundElement,"click",function(){e.hide()})}return ve(s,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),L.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,n=function i(){t.domElement.style.display="none",t.backgroundElement.style.display="none",v.unbind(t.domElement,"webkitTransitionEnd",i),v.unbind(t.domElement,"transitionend",i),v.unbind(t.domElement,"oTransitionEnd",i)};v.bind(this.domElement,"webkitTransitionEnd",n),v.bind(this.domElement,"transitionend",n),v.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-v.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-v.getHeight(this.domElement)/2+"px"}}]),s})(),bc=ic(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);dc.inject(bc);var Ys="dg",$s=72,Ws=20,hn="Default",Jt=(function(){try{return!!window.localStorage}catch{return!1}})(),sn=void 0,qs=!0,Pt=void 0,gi=!1,tr=[],F=function s(e){var t=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),v.addClass(this.domElement,Ys),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=L.defaults(n,{closeOnTop:!1,autoPlace:!0,width:s.DEFAULT_WIDTH}),n=L.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),L.isUndefined(n.load)?n.load={preset:hn}:n.preset&&(n.load.preset=n.preset),L.isUndefined(n.parent)&&n.hideable&&tr.push(this),n.resizable=L.isUndefined(n.parent)&&n.resizable,n.autoPlace&&L.isUndefined(n.scrollable)&&(n.scrollable=!0);var i=Jt&&localStorage.getItem(Rt(this,"isLocal"))==="true",o=void 0,r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:n.load.preset},set:function(h){t.parent?t.getRoot().preset=h:n.load.preset=h,vc(this),t.revert()}},width:{get:function(){return n.width},set:function(h){n.width=h,ss(t,h)}},name:{get:function(){return n.name},set:function(h){n.name=h,r&&(r.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(h){n.closed=h,n.closed?v.addClass(t.__ul,s.CLASS_CLOSED):v.removeClass(t.__ul,s.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=h?s.TEXT_OPEN:s.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return i},set:function(h){Jt&&(i=h,h?v.bind(window,"unload",o):v.unbind(window,"unload",o),localStorage.setItem(Rt(t,"isLocal"),h))}}}),L.isUndefined(n.parent)){if(this.closed=n.closed||!1,v.addClass(this.domElement,s.CLASS_MAIN),v.makeSelectable(this.domElement,!1),Jt&&i){t.useLocalStorage=!0;var a=localStorage.getItem(Rt(this,"gui"));a&&(n.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=s.TEXT_CLOSED,v.addClass(this.__closeButton,s.CLASS_CLOSE_BUTTON),n.closeOnTop?(v.addClass(this.__closeButton,s.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(v.addClass(this.__closeButton,s.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),v.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{n.closed===void 0&&(n.closed=!0);var c=document.createTextNode(n.name);v.addClass(c,"controller-name"),r=bs(t,c);var l=function(h){return h.preventDefault(),t.closed=!t.closed,!1};v.addClass(this.__ul,s.CLASS_CLOSED),v.addClass(r,"title"),v.bind(r,"click",l),n.closed||(this.closed=!1)}n.autoPlace&&(L.isUndefined(n.parent)&&(qs&&(Pt=document.createElement("div"),v.addClass(Pt,Ys),v.addClass(Pt,s.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Pt),qs=!1),Pt.appendChild(this.domElement),v.addClass(this.domElement,s.CLASS_AUTO_PLACE)),this.parent||ss(t,n.width)),this.__resizeHandler=function(){t.onResizeDebounced()},v.bind(window,"resize",this.__resizeHandler),v.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),v.bind(this.__ul,"transitionend",this.__resizeHandler),v.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&Tc(this),o=function(){Jt&&localStorage.getItem(Rt(t,"isLocal"))==="true"&&localStorage.setItem(Rt(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=o;function u(){var f=t.getRoot();f.width+=1,L.defer(function(){f.width-=1})}n.parent||u()};F.toggleHide=function(){gi=!gi,L.each(tr,function(s){s.domElement.style.display=gi?"none":""})};F.CLASS_AUTO_PLACE="a";F.CLASS_AUTO_PLACE_CONTAINER="ac";F.CLASS_MAIN="main";F.CLASS_CONTROLLER_ROW="cr";F.CLASS_TOO_TALL="taller-than-window";F.CLASS_CLOSED="closed";F.CLASS_CLOSE_BUTTON="close-button";F.CLASS_CLOSE_TOP="close-top";F.CLASS_CLOSE_BOTTOM="close-bottom";F.CLASS_DRAG="drag";F.DEFAULT_WIDTH=245;F.TEXT_CLOSED="Close Controls";F.TEXT_OPEN="Open Controls";F._keydownHandler=function(s){document.activeElement.type!=="text"&&(s.which===$s||s.keyCode===$s)&&F.toggleHide()};v.bind(window,"keydown",F._keydownHandler,!1);L.extend(F.prototype,{add:function(e,t){return on(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return on(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;L.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Pt.removeChild(this.domElement);var e=this;L.each(this.__folders,function(t){e.removeFolder(t)}),v.unbind(window,"keydown",F._keydownHandler,!1),Zs(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new F(t);this.__folders[e]=n;var i=bs(this,n.domElement);return v.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Zs(e);var t=this;L.each(e.__folders,function(n){e.removeFolder(n)}),L.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=v.getOffset(e.__ul).top,n=0;L.each(e.__ul.childNodes,function(i){e.autoPlace&&i===e.__save_row||(n+=v.getHeight(i))}),window.innerHeight-t-Ws<n?(v.addClass(e.domElement,F.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-Ws+"px"):(v.removeClass(e.domElement,F.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&L.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:L.debounce(function(){this.onResize()},50),remember:function(){if(L.isUndefined(sn)&&(sn=new yc,sn.domElement.innerHTML=pc),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;L.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&xc(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&ss(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=bn(this)),e.folders={},L.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=bn(this),ns(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[hn]=bn(this,!0)),this.load.remembered[e]=bn(this),this.preset=e,is(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){L.each(this.__controllers,function(t){this.getRoot().load.remembered?nr(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),L.each(this.__folders,function(t){t.revert(t)}),e||ns(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&ir(this.__listening)},updateDisplay:function(){L.each(this.__controllers,function(e){e.updateDisplay()}),L.each(this.__folders,function(e){e.updateDisplay()})}});function bs(s,e,t){var n=document.createElement("li");return e&&n.appendChild(e),t?s.__ul.insertBefore(n,t):s.__ul.appendChild(n),s.onResize(),n}function Zs(s){v.unbind(window,"resize",s.__resizeHandler),s.saveToLocalStorageIfPossible&&v.unbind(window,"unload",s.saveToLocalStorageIfPossible)}function ns(s,e){var t=s.__preset_select[s.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function wc(s,e,t){if(t.__li=e,t.__gui=s,L.extend(t,{options:function(r){if(arguments.length>1){var a=t.__li.nextElementSibling;return t.remove(),on(s,t.object,t.property,{before:a,factoryArgs:[L.toArray(arguments)]})}if(L.isArray(r)||L.isObject(r)){var c=t.__li.nextElementSibling;return t.remove(),on(s,t.object,t.property,{before:c,factoryArgs:[r]})}},name:function(r){return t.__li.firstElementChild.firstElementChild.innerHTML=r,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof es){var n=new ii(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});L.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var r=t[o],a=n[o];t[o]=n[o]=function(){var c=Array.prototype.slice.call(arguments);return a.apply(n,c),r.apply(t,c)}}),v.addClass(e,"has-slider"),t.domElement.insertBefore(n.domElement,t.domElement.firstElementChild)}else if(t instanceof ii){var i=function(r){if(L.isNumber(t.__min)&&L.isNumber(t.__max)){var a=t.__li.firstElementChild.firstElementChild.innerHTML,c=t.__gui.__listening.indexOf(t)>-1;t.remove();var l=on(s,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return l.name(a),c&&l.listen(),l}return r};t.min=L.compose(i,t.min),t.max=L.compose(i,t.max)}else t instanceof Jo?(v.bind(e,"click",function(){v.fakeEvent(t.__checkbox,"click")}),v.bind(t.__checkbox,"click",function(o){o.stopPropagation()})):t instanceof er?(v.bind(e,"click",function(){v.fakeEvent(t.__button,"click")}),v.bind(e,"mouseover",function(){v.addClass(t.__button,"hover")}),v.bind(e,"mouseout",function(){v.removeClass(t.__button,"hover")})):t instanceof ts&&(v.addClass(e,"color"),t.updateDisplay=L.compose(function(o){return e.style.borderLeftColor=t.__color.toString(),o},t.updateDisplay),t.updateDisplay());t.setValue=L.compose(function(o){return s.getRoot().__preset_select&&t.isModified()&&ns(s.getRoot(),!0),o},t.setValue)}function nr(s,e){var t=s.getRoot(),n=t.__rememberedObjects.indexOf(e.object);if(n!==-1){var i=t.__rememberedObjectIndecesToControllers[n];if(i===void 0&&(i={},t.__rememberedObjectIndecesToControllers[n]=i),i[e.property]=e,t.load&&t.load.remembered){var o=t.load.remembered,r=void 0;if(o[s.preset])r=o[s.preset];else if(o[hn])r=o[hn];else return;if(r[n]&&r[n][e.property]!==void 0){var a=r[n][e.property];e.initialValue=a,e.setValue(a)}}}}function on(s,e,t,n){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var i=void 0;if(n.color)i=new ts(e,t);else{var o=[e,t].concat(n.factoryArgs);i=mc.apply(s,o)}n.before instanceof bt&&(n.before=n.before.__li),nr(s,i),v.addClass(i.domElement,"c");var r=document.createElement("span");v.addClass(r,"property-name"),r.innerHTML=i.property;var a=document.createElement("div");a.appendChild(r),a.appendChild(i.domElement);var c=bs(s,a,n.before);return v.addClass(c,F.CLASS_CONTROLLER_ROW),i instanceof ts?v.addClass(c,"color"):v.addClass(c,oc(i.getValue())),wc(s,c,i),s.__controllers.push(i),i}function Rt(s,e){return document.location.href+"."+e}function is(s,e,t){var n=document.createElement("option");n.innerHTML=e,n.value=e,s.__preset_select.appendChild(n),t&&(s.__preset_select.selectedIndex=s.__preset_select.length-1)}function Js(s,e){e.style.display=s.useLocalStorage?"block":"none"}function xc(s){var e=s.__save_row=document.createElement("li");v.addClass(s.domElement,"has-save"),s.__ul.insertBefore(e,s.__ul.firstChild),v.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",v.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",v.addClass(n,"button"),v.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",v.addClass(i,"button"),v.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",v.addClass(o,"button"),v.addClass(o,"revert");var r=s.__preset_select=document.createElement("select");if(s.load&&s.load.remembered?L.each(s.load.remembered,function(f,h){is(s,h,h===s.preset)}):is(s,hn,!1),v.bind(r,"change",function(){for(var f=0;f<s.__preset_select.length;f++)s.__preset_select[f].innerHTML=s.__preset_select[f].value;s.preset=this.value}),e.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(o),Jt){var a=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(Rt(s,"isLocal"))==="true"&&c.setAttribute("checked","checked"),Js(s,a),v.bind(c,"change",function(){s.useLocalStorage=!s.useLocalStorage,Js(s,a)})}var u=document.getElementById("dg-new-constructor");v.bind(u,"keydown",function(f){f.metaKey&&(f.which===67||f.keyCode===67)&&sn.hide()}),v.bind(t,"click",function(){u.innerHTML=JSON.stringify(s.getSaveObject(),void 0,2),sn.show(),u.focus(),u.select()}),v.bind(n,"click",function(){s.save()}),v.bind(i,"click",function(){var f=prompt("Enter a new preset name.");f&&s.saveAs(f)}),v.bind(o,"click",function(){s.revert()})}function Tc(s){var e=void 0;s.__resize_handle=document.createElement("div"),L.extend(s.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(o){return o.preventDefault(),s.width+=e-o.clientX,s.onResize(),e=o.clientX,!1}function n(){v.removeClass(s.__closeButton,F.CLASS_DRAG),v.unbind(window,"mousemove",t),v.unbind(window,"mouseup",n)}function i(o){return o.preventDefault(),e=o.clientX,v.addClass(s.__closeButton,F.CLASS_DRAG),v.bind(window,"mousemove",t),v.bind(window,"mouseup",n),!1}v.bind(s.__resize_handle,"mousedown",i),v.bind(s.__closeButton,"mousedown",i),s.domElement.insertBefore(s.__resize_handle,s.domElement.firstElementChild)}function ss(s,e){s.domElement.style.width=e+"px",s.__save_row&&s.autoPlace&&(s.__save_row.style.width=e+"px"),s.__closeButton&&(s.__closeButton.style.width=e+"px")}function bn(s,e){var t={};return L.each(s.__rememberedObjects,function(n,i){var o={},r=s.__rememberedObjectIndecesToControllers[i];L.each(r,function(a,c){o[c]=e?a.initialValue:a.getValue()}),t[i]=o}),t}function vc(s){for(var e=0;e<s.__preset_select.length;e++)s.__preset_select[e].value===s.preset&&(s.__preset_select.selectedIndex=e)}function ir(s){s.length!==0&&gc.call(window,function(){ir(s)}),L.each(s,function(e){e.updateDisplay()})}var Ac=F;const Qs={type:"change"},ws={type:"start"},sr={type:"end"},wn=new _s,eo=new ci,Sc=Math.cos(70*se.DEG2RAD),K=new P,ee=2*Math.PI,B={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},yi=1e-6;class Ec extends ea{constructor(e,t=null){super(e,t),this.state=B.NONE,this.target=new P,this.cursor=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:De.ROTATE,MIDDLE:De.DOLLY,RIGHT:De.PAN},this.touches={ONE:je.ROTATE,TWO:je.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new P,this._lastQuaternion=new ei,this._lastTargetPosition=new P,this._quat=new ei().setFromUnitVectors(e.up,new P(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Ns,this._sphericalDelta=new Ns,this._scale=1,this._panOffset=new P,this._rotateStart=new H,this._rotateEnd=new H,this._rotateDelta=new H,this._panStart=new H,this._panEnd=new H,this._panDelta=new H,this._dollyStart=new H,this._dollyEnd=new H,this._dollyDelta=new H,this._dollyDirection=new P,this._mouse=new H,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Cc.bind(this),this._onPointerDown=Lc.bind(this),this._onPointerUp=Pc.bind(this),this._onContextMenu=kc.bind(this),this._onMouseWheel=Ic.bind(this),this._onKeyDown=Oc.bind(this),this._onTouchStart=Dc.bind(this),this._onTouchMove=Nc.bind(this),this._onMouseDown=Rc.bind(this),this._onMouseMove=Mc.bind(this),this._interceptControlDown=Bc.bind(this),this._interceptControlUp=Fc.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Qs),this.update(),this.state=B.NONE}update(e=null){const t=this.object.position;K.copy(t).sub(this.target),K.applyQuaternion(this._quat),this._spherical.setFromVector3(K),this.autoRotate&&this.state===B.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=ee:n>Math.PI&&(n-=ee),i<-Math.PI?i+=ee:i>Math.PI&&(i-=ee),n<=i?this._spherical.theta=Math.max(n,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+i)/2?Math.max(n,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=r!=this._spherical.radius}if(K.setFromSpherical(this._spherical),K.applyQuaternion(this._quatInverse),t.copy(this.target).add(K),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const a=K.length();r=this._clampDistance(a*this._scale);const c=a-r;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),o=!!c}else if(this.object.isOrthographicCamera){const a=new P(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=c!==this.object.zoom;const l=new P(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),r=K.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(wn.origin.copy(this.object.position),wn.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(wn.direction))<Sc?this.object.lookAt(this.target):(eo.setFromNormalAndCoplanarPoint(this.object.up,this.target),wn.intersectPlane(eo,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>yi||8*(1-this._lastQuaternion.dot(this.object.quaternion))>yi||this._lastTargetPosition.distanceToSquared(this.target)>yi?(this.dispatchEvent(Qs),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ee/60*this.autoRotateSpeed*e:ee/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){K.setFromMatrixColumn(t,0),K.multiplyScalar(-e),this._panOffset.add(K)}_panUp(e,t){this.screenSpacePanning===!0?K.setFromMatrixColumn(t,1):(K.setFromMatrixColumn(t,0),K.crossVectors(this.object.up,K)),K.multiplyScalar(e),this._panOffset.add(K)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;K.copy(i).sub(this.target);let o=K.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/n.clientHeight,this.object.matrix),this._panUp(2*t*o/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=e-n.left,o=t-n.top,r=n.width,a=n.height;this._mouse.x=i/r*2-1,this._mouse.y=-(o/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ee*this._rotateDelta.x/t.clientHeight),this._rotateUp(ee*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ee*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ee*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ee*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ee*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(n,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(n*n+i*i);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),o=.5*(e.pageY+n.y);this._rotateEnd.set(i,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ee*this._rotateDelta.x/t.clientHeight),this._rotateUp(ee*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(r,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new H,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Lc(s){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(s)&&(this._addPointer(s),s.pointerType==="touch"?this._onTouchStart(s):this._onMouseDown(s)))}function Cc(s){this.enabled!==!1&&(s.pointerType==="touch"?this._onTouchMove(s):this._onMouseMove(s))}function Pc(s){switch(this._removePointer(s),this._pointers.length){case 0:this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(sr),this.state=B.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Rc(s){let e;switch(s.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case De.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(s),this.state=B.DOLLY;break;case De.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=B.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=B.ROTATE}break;case De.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=B.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=B.PAN}break;default:this.state=B.NONE}this.state!==B.NONE&&this.dispatchEvent(ws)}function Mc(s){switch(this.state){case B.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(s);break;case B.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(s);break;case B.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(s);break}}function Ic(s){this.enabled===!1||this.enableZoom===!1||this.state!==B.NONE||(s.preventDefault(),this.dispatchEvent(ws),this._handleMouseWheel(this._customWheelEvent(s)),this.dispatchEvent(sr))}function Oc(s){this.enabled!==!1&&this._handleKeyDown(s)}function Dc(s){switch(this._trackPointer(s),this._pointers.length){case 1:switch(this.touches.ONE){case je.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(s),this.state=B.TOUCH_ROTATE;break;case je.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(s),this.state=B.TOUCH_PAN;break;default:this.state=B.NONE}break;case 2:switch(this.touches.TWO){case je.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(s),this.state=B.TOUCH_DOLLY_PAN;break;case je.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(s),this.state=B.TOUCH_DOLLY_ROTATE;break;default:this.state=B.NONE}break;default:this.state=B.NONE}this.state!==B.NONE&&this.dispatchEvent(ws)}function Nc(s){switch(this._trackPointer(s),this.state){case B.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(s),this.update();break;case B.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(s),this.update();break;case B.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(s),this.update();break;case B.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(s),this.update();break;default:this.state=B.NONE}}function kc(s){this.enabled!==!1&&s.preventDefault()}function Bc(s){s.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Fc(s){s.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class Hc extends Ec{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons={LEFT:De.PAN,MIDDLE:De.DOLLY,RIGHT:De.ROTATE},this.touches={ONE:je.PAN,TWO:je.DOLLY_ROTATE}}}var rn=function(){var s=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),n(++s%e.children.length)},!1);function t(u){return e.appendChild(u.dom),u}function n(u){for(var f=0;f<e.children.length;f++)e.children[f].style.display=f===u?"block":"none";s=u}var i=(performance||Date).now(),o=i,r=0,a=t(new rn.Panel("FPS","#0ff","#002")),c=t(new rn.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new rn.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){r++;var u=(performance||Date).now();if(c.update(u-i,200),u>=o+1e3&&(a.update(r*1e3/(u-o),100),o=u,r=0,l)){var f=performance.memory;l.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return u},update:function(){i=this.end()},domElement:e,setMode:n}};rn.Panel=function(s,e,t){var n=1/0,i=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,c=48*r,l=3*r,u=2*r,f=3*r,h=15*r,d=74*r,y=30*r,_=document.createElement("canvas");_.width=a,_.height=c,_.style.cssText="width:80px;height:48px";var p=_.getContext("2d");return p.font="bold "+9*r+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=t,p.fillRect(0,0,a,c),p.fillStyle=e,p.fillText(s,l,u),p.fillRect(f,h,d,y),p.fillStyle=t,p.globalAlpha=.9,p.fillRect(f,h,d,y),{dom:_,update:function(m,g){n=Math.min(n,m),i=Math.max(i,m),p.fillStyle=t,p.globalAlpha=1,p.fillRect(0,0,a,h),p.fillStyle=e,p.fillText(o(m)+" "+s+" ("+o(n)+"-"+o(i)+")",l,u),p.drawImage(_,f+r,h,d-r,y,f,h,d-r,y),p.fillRect(f+d-r,h,r,y),p.fillStyle=t,p.globalAlpha=.9,p.fillRect(f+d-r,h,r,o((1-m/g)*y))}}};const zc=`
    const float FOG_DISTANCE = 1000.0;
`,or=`
    #include <common>

    const float DITHER_STRENGTH = 0.1;

    const vec3 DAY_SKY_COLOR = vec3(0.25, 0.4, 0.6);
    const vec3 DAY_HORIZON_COLOR = vec3(0.75, 0.9, 1);
    const vec3 EARLY_TWILIGHT_COLOR = vec3(1, 0.83, 0.5);
    const vec3 LATE_TWILIGHT_COLOR = vec3(1, 0.333, 0.167);
    const vec3 NIGHT_SKY_COLOR = vec3(0.06, 0.1, 0.15);
    const vec3 NIGHT_HORIZON_COLOR = vec3(0.07, 0.13, 0.18);

    const float SUN_SHARPNESS = 2000.0;
    const float SUN_SIZE = 5.0;
    const float MOON_SHARPNESS = 12000.0;
    const float MOON_SIZE = 5000.0;

    const float STARS_SHARPNESS = 50.0;
    const float STARS_SIZE = 10.0;
    const float WIDTH_SCALE = 1.0 / 6.0;
    const float WIDTH_SCALE_HALF = WIDTH_SCALE / 2.0;
    const vec3 STARS_COLORS[6] = vec3[6]
    (
        vec3(1.0, 0.95, 0.9),
        vec3(1.0, 0.9, 0.9),
        vec3(0.9, 1.0, 1.0),
        vec3(0.9, 0.95, 1.0),
        vec3(1.0, 0.9, 1.0),
        vec3(1.0, 1.0, 1.0)
    );
    const float STARS_FALLOFF = 15.0;
    const float STARS_VISIBILITY = 450.0;

    const vec3 UP = vec3(0.0, 1.0, 0.0);

    uniform mat3 _SkyRotationMatrix;

    uniform sampler2D _DitherTexture;
    uniform vec2 _DitherTextureSize;
    uniform float _SunVisibility;
    uniform float _TwilightTime;
    uniform float _TwilightVisibility;
    uniform float _MoonVisibility;
    uniform float _GridSize;
    uniform float _GridSizeScaled;
    uniform sampler2D _Stars;
    uniform float _SpecularVisibility;
    uniform vec3 _DirToLight;
    uniform vec3 _Light;

    float dither = 0.0;

    vec2 sampleCubeCoords(vec3 dir)
    {
        vec3 absDir = abs(dir);

        bool xPositive = dir.x > 0.0 ? true : false;
        bool yPositive = dir.y > 0.0 ? true : false;
        bool zPositive = dir.z > 0.0 ? true : false;

        float maxAxis = 1.0;
        float u = 0.0;
        float v = 0.0;
        float i = 0.0;

        if (xPositive && absDir.x >= absDir.y && absDir.x >= absDir.z)
        {
            maxAxis = absDir.x;
            u = -dir.z;
            v = dir.y;
            i = 0.0;
        }

        if (!xPositive && absDir.x >= absDir.y && absDir.x >= absDir.z)
        {
            maxAxis = absDir.x;
            u = dir.z;
            v = dir.y;
            i = 1.0;
        }

        if (yPositive && absDir.y >= absDir.x && absDir.y >= absDir.z)
        {
            maxAxis = absDir.y;
            u = dir.x;
            v = -dir.z;
            i = 2.0;
        }

        if (!yPositive && absDir.y >= absDir.x && absDir.y >= absDir.z)
        {
            maxAxis = absDir.y;
            u = dir.x;
            v = dir.z;
            i = 3.0;
        }

        if (zPositive && absDir.z >= absDir.x && absDir.z >= absDir.y)
        {
            maxAxis = absDir.z;
            u = dir.x;
            v = dir.y;
            i = 4.0;
        }

        if (!zPositive && absDir.z >= absDir.x && absDir.z >= absDir.y)
        {
            maxAxis = absDir.z;
            u = -dir.x;
            v = dir.y;
            i = 5.0;
        }

        u = i * WIDTH_SCALE + (u / maxAxis + 1.0) * WIDTH_SCALE_HALF;
        v = (v / maxAxis + 1.0) * 0.5;
        return vec2(u, v);
    }

    void sampleDither(vec2 fragCoord)
    {
        dither = (texture2D(_DitherTexture, (fragCoord - vec2(0.5)) / _DitherTextureSize).x - 0.5) * DITHER_STRENGTH;
    }

    vec3 sampleSkybox(vec3 dir)
    {
        vec3 viewDir = _SkyRotationMatrix * dir;

        float density = clamp(pow2(1.0 - max(0.0, dot(dir, UP) + dither)), 0.0, 1.0);

        float sunLight = dot(viewDir, UP);
        float sun = min(pow(max(0.0, sunLight), SUN_SHARPNESS) * SUN_SIZE, 1.0);

        float moonLight = -sunLight;
        float moon = min(pow(max(0.0, moonLight), MOON_SHARPNESS) * MOON_SIZE, 1.0);

        vec3 day = mix(DAY_SKY_COLOR, DAY_HORIZON_COLOR, density);
        vec3 twilight = mix(LATE_TWILIGHT_COLOR, EARLY_TWILIGHT_COLOR, _TwilightTime);
        vec3 night = mix(NIGHT_SKY_COLOR, NIGHT_HORIZON_COLOR, density);

        vec3 sky = mix(night, day, _SunVisibility);
        sky = mix(sky, twilight, density * clamp(sunLight * 0.5 + 0.5 + dither, 0.0, 1.0) * _TwilightVisibility);

        vec2 cubeCoords = sampleCubeCoords(viewDir);
        vec4 gridValue = texture2D(_Stars, cubeCoords);

        vec2 gridCoords = vec2(cubeCoords.x * _GridSizeScaled, cubeCoords.y * _GridSize);
        vec2 gridCenterCoords = floor(gridCoords) + gridValue.xy;
        float stars = max(min(pow(1.0 - min(distance(gridCoords, gridCenterCoords), 1.0), STARS_SHARPNESS) * gridValue.z * STARS_SIZE, 1.0), moon);
        stars *= min(exp(-dot(sky, vec3(1.0)) * STARS_FALLOFF) * STARS_VISIBILITY, 1.0);

        sky = mix(sky, max(STARS_COLORS[int(gridValue.w * 6.0)], vec3(moon)), stars);
        sky = mix(sky, vec3(1.0), sun);
        
        return sky;
    }

    vec3 sampleFog(vec3 dir)
    {
        vec3 viewDir = _SkyRotationMatrix * dir;

        float sunLight = dot(viewDir, UP);
        vec3 twilight = mix(LATE_TWILIGHT_COLOR, EARLY_TWILIGHT_COLOR, _TwilightTime);
        vec3 horizon = mix(NIGHT_HORIZON_COLOR, DAY_HORIZON_COLOR, _SunVisibility);
        horizon = mix(horizon, twilight, clamp(sunLight * 0.5 + 0.5 + dither, 0.0, 1.0) * _TwilightVisibility);

        return horizon;
    }
`,_n=`
    ${zc}
    ${or}

    const float NORMAL_MAP_SCALE = 0.1;
    const float NORMAL_MAP_STRENGTH = 0.2;
    const vec2 VELOCITY_1 = vec2(0.1, 0.0);
    const vec2 VELOCITY_2 = vec2(0.0, 0.1);
    const float SPECULAR_SHARPNESS = 100.0;
    const float SPECULAR_SIZE = 1.1;
    const float MAX_VIEW_DEPTH = 100.0;
    const float DENSITY = 0.35;
    const float MAX_VIEW_DEPTH_DENSITY = MAX_VIEW_DEPTH * DENSITY;
    const vec3 ABSORPTION = vec3(1.0) / vec3(10.0, 40.0, 100.0);
    const float CRITICAL_ANGLE = asin(1.0 / 1.33) / PI_HALF;

    uniform float _Time;
    uniform sampler2D _NormalMap1;
    uniform sampler2D _NormalMap2;
`,Uc=`
    uniform mat3 _SkyRotationMatrix;

    attribute vec3 coord;

    varying vec3 _worldPos;
    varying vec3 _coord;

    void main()
    {
        _worldPos = coord;
        _coord = _SkyRotationMatrix * _worldPos;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
`,Vc=`
${or}

    varying vec3 _worldPos;
    varying vec3 _coord;

    void main() 
    {
        vec3 worldDir = normalize(_worldPos);
        vec3 viewDir = normalize(_coord);

        float dither = (texture2D(_DitherTexture, (gl_FragCoord.xy - vec2(0.5)) / _DitherTextureSize).x - 0.5) * DITHER_STRENGTH;
        float density = clamp(pow2(1.0 - max(0.0, dot(worldDir, UP) + dither)), 0.0, 1.0);

        float sunLight = dot(viewDir, UP);
        float sun = min(pow(max(0.0, sunLight), SUN_SHARPNESS) * SUN_SIZE, 1.0);

        float moonLight = -sunLight;
        float moon = min(pow(max(0.0, moonLight), MOON_SHARPNESS) * MOON_SIZE, 1.0);

        vec3 day = mix(DAY_SKY_COLOR, DAY_HORIZON_COLOR, density);
        vec3 twilight = mix(LATE_TWILIGHT_COLOR, EARLY_TWILIGHT_COLOR, _TwilightTime);
        vec3 night = mix(NIGHT_SKY_COLOR, NIGHT_HORIZON_COLOR, density);

        vec3 sky = mix(night, day, _SunVisibility);
        sky = mix(sky, twilight, density * clamp(sunLight * 0.5 + 0.5 + dither, 0.0, 1.0) * _TwilightVisibility);

        vec2 cubeCoords = sampleCubeCoords(viewDir);
        vec4 gridValue = texture2D(_Stars, cubeCoords);

        vec2 gridCoords = vec2(cubeCoords.x * _GridSizeScaled, cubeCoords.y * _GridSize);
        vec2 gridCenterCoords = floor(gridCoords) + gridValue.xy;
        float stars = max(min(pow(1.0 - min(distance(gridCoords, gridCenterCoords), 1.0), STARS_SHARPNESS) * gridValue.z * STARS_SIZE, 1.0), moon);
        stars *= min(exp(-dot(sky, vec3(1.0)) * STARS_FALLOFF) * STARS_VISIBILITY, 1.0);

        sky = mix(sky, max(STARS_COLORS[int(gridValue.w * 6.0)], vec3(moon)), stars);
        sky = mix(sky, vec3(1.0), sun);

        gl_FragColor = vec4(sky, 1.0);
    }
`;class rr{seed=0;state=0;constructor(e){e?(this.seed=e,this.state=this.Generate(e)):(this.seed=Math.random(),this.state=this.Generate(this.seed))}Next(){return this.state=this.Generate(this.state),this.state}Generate(e){let t=Math.sin(e*12.9898)*43758.5453;return t-Math.floor(t)}Generate2D(e,t){e+=this.seed,t+=this.seed;let n=Math.sin(e*12.9898+t*78.233)*43758.5453;return n-Math.floor(n)}Perlin(e,t){function n(A,T,S){return S=S*S*S*(S*(S*6-15)+10),(1-S)*A+S*T}let i=Math.floor(e),o=Math.floor(t),r=i+1,a=o+1,c=e-i,l=t-o,u=e-r,f=t-a,h=this.Generate2D(i,o)*Math.PI*2,d=this.Generate2D(r,o)*Math.PI*2,y=this.Generate2D(i,a)*Math.PI*2,_=this.Generate2D(r,a)*Math.PI*2,p=c*Math.cos(h)+l*Math.sin(h),m=u*Math.cos(d)+l*Math.sin(d),g=c*Math.cos(y)+f*Math.sin(y),b=u*Math.cos(_)+f*Math.sin(_),w=n(p,m,c),x=n(g,b,c);return se.clamp(n(w,x,l),-.7,.7)/.7}Ridge(e,t,n){return Math.pow(Math.abs(this.Perlin(e,t)),n)}}const gn="/projects/assets/",an=new mn;let pt;const bi=new V(new H),to=new V(void 0),We=new V(1),dn=new V(0),pn=new V(0),Gc=87,Ee=64,jc=1e4,xn=.43,Qt=new Uint8Array(Ee*Ee*24),wi=new V(void 0),ar=new V(Math.sqrt(We.value)),cr=new V(new P(1,1,1)),lr=new P(0,1,0);let Ke=0,Tn=0;function Xc(s,e){const t=new P(Math.abs(s.x),Math.abs(s.y),Math.abs(s.z)),n=s.x>0,i=s.y>0,o=s.z>0;let r=0,a=0,c=0,l=0;n&&t.x>=t.y&&t.x>=t.z&&(r=t.x,a=-s.z,c=s.y,l=0),!n&&t.x>=t.y&&t.x>=t.z&&(r=t.x,a=s.z,c=s.y,l=1),i&&t.y>=t.x&&t.y>=t.z&&(r=t.y,a=s.x,c=-s.z,l=2),!i&&t.y>=t.x&&t.y>=t.z&&(r=t.y,a=s.x,c=s.z,l=3),o&&t.z>=t.x&&t.z>=t.y&&(r=t.z,a=s.x,c=s.y,l=4),!o&&t.z>=t.x&&t.z>=t.y&&(r=t.z,a=-s.x,c=s.y,l=5),a=Math.floor((a/r+1)*.5*Ee),c=Math.floor((c/r+1)*.5*Ee);const u=(c*Ee*6+l*Ee+a)*4;Qt[u]=e[0],Qt[u+1]=e[1],Qt[u+2]=e[2],Qt[u+3]=e[3]}function ur(){to.value=new _t().load(gn+"base/bluenoise.png",function(e){bi.value.x=e.image.width,bi.value.y=e.image.height,e.wrapS=ae,e.wrapT=ae});const s=new rr(Gc);for(let e=0;e<jc;e++){const t=s.Next()*Math.PI*2,n=s.Next()*2-1,i=Math.sqrt(1-n*n),o=new P(Math.cos(t)*i,Math.sin(t)*i,n);Xc(o,[se.lerp(.5-xn,.5+xn,s.Next())*255,se.lerp(.5-xn,.5+xn,s.Next())*255,Math.pow(s.Next(),6)*255,s.Next()*255])}wi.value=new ta(Qt,Ee*6,Ee),wi.value.needsUpdate=!0,an.vertexShader=Uc,an.fragmentShader=Vc,Ke=Je.dot(lr),We.value=se.clamp((Ke+.1)*2,0,1),dn.value=se.clamp((Ke+.1)*3,0,1),pn.value=1-Math.min(Math.abs(Ke*3),1),pt=function(e){e.uniforms._SkyRotationMatrix=li,e.uniforms._DitherTexture=to,e.uniforms._DitherTextureSize=bi,e.uniforms._SunVisibility=We,e.uniforms._TwilightTime=dn,e.uniforms._TwilightVisibility=pn,e.uniforms._GridSize=new V(Ee),e.uniforms._GridSizeScaled=new V(Ee*6),e.uniforms._Stars=wi,e.uniforms._SpecularVisibility=ar,e.uniforms._DirToLight=new V(Je),e.uniforms._Light=cr},pt(an)}function fr(){Ke=Je.dot(lr),We.value=se.clamp((Ke+.1)*2,0,1),dn.value=se.clamp((Ke+.1)*3,0,1),pn.value=1-Math.min(Math.abs(Ke*3),1),ar.value=Math.sqrt(We.value),Tn=Math.min(We.value+.333,1),cr.value.set(Tn,Tn,Tn)}const Kc=Object.freeze(Object.defineProperty({__proto__:null,get SetSkyboxUniforms(){return pt},Start:ur,Update:fr,material:an,sunVisibility:We,twilightTime:dn,twilightVisibility:pn},Symbol.toStringTag,{value:"Module"})),si=new gt,Je=new P,li=new V(new Yo),Yc=Kc,U=2e3,be=new P(0,1,0),xi=new P(0,0,1).applyAxisAngle(new P(0,1,0),se.degToRad(-30));let os=-1;function hr(s){const e=Math.cos(s),t=1-e,n=Math.sin(s),i=xi,o=xi.clone().multiply(xi);li.value.set(e+o.x*t,i.x*i.y*t-i.z*n,i.x*i.z*t+i.y*n,i.y*i.x*t+i.z*n,e+o.y*t,i.y*i.z*t-i.x*n,i.z*i.x*t-i.y*n,i.z*i.y*t+i.x*n,e+o.z*t)}function $c(){Je.copy(be),ur();const s=new Float32Array([-U,-U,-U,U,-U,-U,-U,-U,U,U,-U,U,-U,U,-U,U,U,-U,-U,U,U,U,U,U]),e=[2,3,0,3,1,0,0,1,4,1,5,4,1,3,5,3,7,5,3,2,7,2,6,7,2,0,6,0,4,6,4,5,6,5,7,6],t=new Bt;t.setAttribute("position",new oe(s,3)),t.setAttribute("coord",new oe(s,3)),t.setIndex(e),si.geometry=t,si.material=an,hr(os),be.applyMatrix3(li.value),Je.set(-be.x,be.y,-be.z),be.set(0,1,0)}function Wc(s,e){os=e*.05%Math.PI*2-Math.PI/2,hr(os),be.applyMatrix3(li.value),Je.set(-be.x,be.y,-be.z),be.set(0,1,0),fr(),si.position.copy(s.position)}function qc(){const s=new P(.75,.9,1),e=new P(1,.333,.167).lerp(new P(1,.83,.5),dn.value);return s.lerp(e,pn.value).multiplyScalar(We.value)}const Zc=`
${_n}

    varying vec2 _worldPos;
    varying vec2 _uv;

    void main()
    {
        vec4 worldPos = modelMatrix * vec4(position, 1.0);
        _worldPos = worldPos.xz;
        _uv = _worldPos * NORMAL_MAP_SCALE;
        gl_Position = projectionMatrix * viewMatrix * worldPos;
    }
`,Jc=`
${_n}

    varying vec2 _worldPos;
    varying vec2 _uv;

    void main()
    {
        vec3 viewVec = vec3(_worldPos.x, 0.0, _worldPos.y) - cameraPosition;
        float viewLen = length(viewVec);
        vec3 viewDir = viewVec / viewLen;

        vec3 normal = texture2D(_NormalMap1, _uv + VELOCITY_1 * _Time).xyz * 2.0 - 1.0;
        normal += texture2D(_NormalMap2, _uv + VELOCITY_2 * _Time).xyz * 2.0 - 1.0;
        normal *= NORMAL_MAP_STRENGTH;
        normal += vec3(0.0, 0.0, 1.0);
        normal = normalize(normal).xzy;

        sampleDither(gl_FragCoord.xy);

        if (cameraPosition.y > 0.0)
        {
            vec3 halfWayDir = normalize(_DirToLight - viewDir);
            float specular = max(0.0, dot(normal, halfWayDir));
            specular = pow(specular, SPECULAR_SHARPNESS) * _SpecularVisibility;

            float reflectivity = pow2(1.0 - max(0.0, dot(-viewDir, normal)));

            vec3 reflection = sampleSkybox(reflect(viewDir, normal));
            vec3 surface = reflectivity * reflection;
            surface = max(surface, specular);

            float fog = clamp(viewLen / FOG_DISTANCE + dither, 0.0, 1.0);
            surface = mix(surface, sampleFog(viewDir), fog);

            gl_FragColor = vec4(surface, max(max(reflectivity, specular), fog));
            return;
        }

        float originY = cameraPosition.y;
        viewLen = min(viewLen, MAX_VIEW_DEPTH);
        float sampleY = originY + viewDir.y * viewLen;
        vec3 light = exp((sampleY - MAX_VIEW_DEPTH_DENSITY) * ABSORPTION);
        light *= _Light;

        float reflectivity = pow2(1.0 - max(0.0, dot(viewDir, normal)));
        float t = clamp(max(reflectivity, viewLen / MAX_VIEW_DEPTH) + dither, 0.0, 1.0);

        if (dot(viewDir, normal) < CRITICAL_ANGLE)
        {
            vec3 r = reflect(viewDir, -normal);
            sampleY = r.y * (MAX_VIEW_DEPTH - viewLen);
            vec3 rColor = exp((sampleY - MAX_VIEW_DEPTH_DENSITY) * ABSORPTION);
            rColor *= _Light;

            gl_FragColor = vec4(mix(rColor, light, t), 1.0);
            return;
        }

        gl_FragColor = vec4(light, t);
    }
`,Qc=`
    varying vec3 _worldPos;

    void main()
    {
        vec4 worldPos = modelMatrix * vec4(position, 1.0);
        _worldPos = worldPos.xyz;
        gl_Position = projectionMatrix * viewMatrix * worldPos;
    }
`,el=`
${_n}

    varying vec3 _worldPos;

    void main()
    {
        vec3 viewVec = _worldPos - cameraPosition;
        float viewLen = length(viewVec);
        vec3 viewDir = viewVec / viewLen;
        float originY = cameraPosition.y;

        if (cameraPosition.y > 0.0)
        {
            float distAbove = cameraPosition.y / -viewDir.y;
            viewLen -= distAbove;
            originY = 0.0;
        }
        viewLen = min(viewLen, MAX_VIEW_DEPTH);

        float sampleY = originY + viewDir.y * viewLen;
        vec3 light = exp((sampleY - viewLen * DENSITY) * ABSORPTION);
        light *= _Light;
        
        gl_FragColor = vec4(light, 1.0);
    }
`,tl=`
    varying vec3 _worldPos;
    varying vec3 _normal;
    varying vec2 _uv;
    
    void main()
    {
        vec4 worldPos = modelMatrix * vec4(position, 1.0);
        _worldPos = worldPos.xyz;
        _normal = normal;
        _uv = uv;
        gl_Position = projectionMatrix * viewMatrix * worldPos;
    }
`,nl=`
${_n}

    uniform vec3 _CameraForward;
    uniform sampler2D _MainTexture;
    uniform float _SpotLightSharpness;
    uniform float _SpotLightDistance;

    varying vec3 _worldPos;
    varying vec3 _normal;
    varying vec2 _uv;

    void main()
    {
        float dirLighting = max(0.0, dot(_normal, _DirToLight));
        vec3 texture = texture2D(_MainTexture, _uv).xyz * dirLighting;
        
        vec3 viewVec = _worldPos - cameraPosition;
        float viewLen = length(viewVec);
        vec3 viewDir = viewVec / viewLen;

        if (_worldPos.y > 0.0)
        {
            if (cameraPosition.y < 0.0)
            {
                viewLen -= cameraPosition.y / -viewDir.y;
            }

            sampleDither(gl_FragCoord.xy);
            vec3 fogColor = sampleFog(viewDir);
            float fog = clamp(viewLen / FOG_DISTANCE + dither, 0.0, 1.0);
            gl_FragColor = vec4(mix(texture, fogColor, fog), 1.0);
            return;
        }

        float originY = cameraPosition.y;

        if (cameraPosition.y > 0.0)
        {
            viewLen -= cameraPosition.y / -viewDir.y;
            originY = 0.0;
        }
        viewLen = min(viewLen, MAX_VIEW_DEPTH);

        float sampleY = originY + viewDir.y * viewLen;
        vec3 light = exp((sampleY - viewLen * DENSITY) * ABSORPTION) * _Light;

        float spotLight = 0.0;
        float spotLightDistance = 1.0;
        if (_SpotLightDistance > 0.0)
        {
            spotLightDistance =  min(distance(_worldPos, cameraPosition) / _SpotLightDistance, 1.0);
            spotLight = pow(max(dot(viewDir, _CameraForward), 0.0), _SpotLightSharpness) * (1.0 - spotLightDistance);
        }
        
        light = min(light + spotLight, vec3(1.0));

        gl_FragColor = vec4(mix(texture * light, light, min(viewLen / MAX_VIEW_DEPTH, 1.0 - spotLight)), 1.0);
    }
`,il=`
    varying vec3 _worldPos;
    varying vec3 _normal;
    
    void main()
    {
        vec4 worldPos = modelMatrix * vec4(position, 1.0);
        _worldPos = worldPos.xyz;
        _normal = normal;
        gl_Position = projectionMatrix * viewMatrix * worldPos;
    }
`,sl=`
${_n}

    uniform vec3 _CameraForward;
    uniform sampler2D _MainTexture;
    uniform float _BlendSharpness;
    uniform float _Scale;
    uniform float _SpotLightSharpness;
    uniform float _SpotLightDistance;

    varying vec3 _worldPos;
    varying vec3 _normal;

    void main()
    {
        float dirLighting = max(0.4, dot(_normal, _DirToLight));

        vec3 weights = abs(_normal);
        weights = vec3(pow(weights.x, _BlendSharpness), pow(weights.y, _BlendSharpness), pow(weights.z, _BlendSharpness));
        weights = weights / (weights.x + weights.y + weights.z);

        vec3 textureX = texture2D(_MainTexture, _worldPos.yz * _Scale).xyz * weights.x;
        vec3 textureY = texture2D(_MainTexture, _worldPos.xz * _Scale).xyz * weights.y;
        vec3 textureZ = texture2D(_MainTexture, _worldPos.xy * _Scale).xyz * weights.z;

        vec3 texture = (textureX + textureY + textureZ) * dirLighting;
        
        vec3 viewVec = _worldPos - cameraPosition;
        float viewLen = length(viewVec);
        vec3 viewDir = viewVec / viewLen;

        if (_worldPos.y > 0.0)
        {
            if (cameraPosition.y < 0.0)
            {
                viewLen -= cameraPosition.y / -viewDir.y;
            }

            sampleDither(gl_FragCoord.xy);
            vec3 fogColor = sampleFog(viewDir);
            float fog = clamp(viewLen / FOG_DISTANCE + dither, 0.0, 1.0);
            gl_FragColor = vec4(mix(texture, fogColor, fog), 1.0);
            return;
        }

        float originY = cameraPosition.y;

        if (cameraPosition.y > 0.0)
        {
            viewLen -= cameraPosition.y / -viewDir.y;
            originY = 0.0;
        }
        viewLen = min(viewLen, MAX_VIEW_DEPTH);

        float sampleY = originY + viewDir.y * viewLen;
        vec3 light = exp((sampleY - viewLen * DENSITY) * ABSORPTION) * _Light;

        float spotLight = 0.0;
        float spotLightDistance = 1.0;
        if (_SpotLightDistance > 0.0)
        {
            spotLightDistance =  min(distance(_worldPos, cameraPosition) / _SpotLightDistance, 1.0);
            spotLight = pow(max(dot(viewDir, _CameraForward), 0.0), _SpotLightSharpness) * (1.0 - spotLightDistance);
        }
        
        light = min(light + spotLight, vec3(1.0));

        gl_FragColor = vec4(mix(texture * light, light, min(viewLen / MAX_VIEW_DEPTH, 1.0 - spotLight)), 1.0);
    }
`,ut=new mn,Wn=new mn,vn=new mn,en=new mn,xs=new V(new _t().load(gn+"base/waterNormal1.png"));xs.value.wrapS=ae;xs.value.wrapT=ae;const Ts=new V(new _t().load(gn+"base/waterNormal2.png"));Ts.value.wrapS=ae;Ts.value.wrapT=ae;const no=10,ol=200,io=new V(ol),vs=new _t().load(gn+"base/basicChecker.png");vs.wrapS=ae;vs.wrapT=ae;const As=new _t().load(gn+"base/sand.png");As.wrapS=ae;As.wrapT=ae;const rl=3,al=1;function cl(s,e){ut.vertexShader=Zc,ut.fragmentShader=Jc,ut.side=Ft,ut.transparent=!0,ut.uniforms={_Time:e,_NormalMap1:xs,_NormalMap2:Ts},pt(ut),Wn.vertexShader=Qc,Wn.fragmentShader=el,pt(Wn),vn.vertexShader=tl,vn.fragmentShader=nl,vn.uniforms={_MainTexture:new V(vs),_CameraForward:new V(s),_SpotLightSharpness:new V(no),_SpotLightDistance:io},pt(vn),en.vertexShader=il,en.fragmentShader=sl,en.uniforms={_MainTexture:new V(As),_CameraForward:new V(s),_BlendSharpness:new V(rl),_Scale:new V(al),_SpotLightSharpness:new V(no),_SpotLightDistance:io},pt(en)}const Dt=new gt,An=new gt;function ll(s,e){cl(s,e);const t=1500,n=new Float32Array([-t,0,-t,t,0,-t,-t,0,t,t,0,t]),i=[2,3,0,3,1,0],o=new Bt;o.setAttribute("position",new oe(n,3)),o.setIndex(i),Dt.geometry=o,Dt.material=ut;const r=new Float32Array([-t,-1e3,-t,t,-1e3,-t,-t,-1e3,t,t,-1e3,t,-t,0,-t,t,0,-t,-t,0,t,t,0,t]),a=[2,3,0,3,1,0,0,1,4,1,5,4,1,3,5,3,7,5,3,2,7,2,6,7,2,0,6,0,4,6],c=new Bt;c.setAttribute("position",new oe(r,3)),c.setIndex(a),An.geometry=c,An.material=Wn,An.parent=Dt,Dt.add(An)}function ul(s){Dt.position.set(s.position.x,0,s.position.z)}const dr=0,fl=1,hl=2,so=2,Ti=1.25,oo=1,cn=32,ui=65535,dl=Math.pow(2,-24),vi=Symbol("SKIP_GENERATION");function pl(s){return s.index?s.index.count:s.attributes.position.count}function Ht(s){return pl(s)/3}function ml(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function _l(s,e){if(!s.index){const t=s.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=ml(t,n);s.setIndex(new oe(i,1));for(let o=0;o<t;o++)i[o]=o}}function pr(s,e){const t=Ht(s),n=e||s.drawRange,i=n.start/3,o=(n.start+n.count)/3,r=Math.max(0,i),a=Math.min(t,o)-r;return[{offset:Math.floor(r),count:Math.floor(a)}]}function mr(s,e){if(!s.groups||!s.groups.length)return pr(s,e);const t=[],n=new Set,i=e||s.drawRange,o=i.start/3,r=(i.start+i.count)/3;for(const c of s.groups){const l=c.start/3,u=(c.start+c.count)/3;n.add(Math.max(o,l)),n.add(Math.min(r,u))}const a=Array.from(n.values()).sort((c,l)=>c-l);for(let c=0;c<a.length-1;c++){const l=a[c],u=a[c+1];t.push({offset:Math.floor(l),count:Math.floor(u-l)})}return t}function gl(s,e){const t=Ht(s),n=mr(s,e).sort((r,a)=>r.offset-a.offset),i=n[n.length-1];i.count=Math.min(t-i.offset,i.count);let o=0;return n.forEach(({count:r})=>o+=r),t!==o}function Ai(s,e,t,n,i){let o=1/0,r=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0,f=1/0,h=1/0,d=1/0,y=-1/0,_=-1/0,p=-1/0;for(let m=e*6,g=(e+t)*6;m<g;m+=6){const b=s[m+0],w=s[m+1],x=b-w,A=b+w;x<o&&(o=x),A>c&&(c=A),b<f&&(f=b),b>y&&(y=b);const T=s[m+2],S=s[m+3],E=T-S,R=T+S;E<r&&(r=E),R>l&&(l=R),T<h&&(h=T),T>_&&(_=T);const I=s[m+4],C=s[m+5],M=I-C,O=I+C;M<a&&(a=M),O>u&&(u=O),I<d&&(d=I),I>p&&(p=I)}n[0]=o,n[1]=r,n[2]=a,n[3]=c,n[4]=l,n[5]=u,i[0]=f,i[1]=h,i[2]=d,i[3]=y,i[4]=_,i[5]=p}function yl(s,e=null,t=null,n=null){const i=s.attributes.position,o=s.index?s.index.array:null,r=Ht(s),a=i.normalized;let c;e===null?(c=new Float32Array(r*6),t=0,n=r):(c=e,t=t||0,n=n||r);const l=i.array,u=i.offset||0;let f=3;i.isInterleavedBufferAttribute&&(f=i.data.stride);const h=["getX","getY","getZ"];for(let d=t;d<t+n;d++){const y=d*3,_=d*6;let p=y+0,m=y+1,g=y+2;o&&(p=o[p],m=o[m],g=o[g]),a||(p=p*f+u,m=m*f+u,g=g*f+u);for(let b=0;b<3;b++){let w,x,A;a?(w=i[h[b]](p),x=i[h[b]](m),A=i[h[b]](g)):(w=l[p+b],x=l[m+b],A=l[g+b]);let T=w;x<T&&(T=x),A<T&&(T=A);let S=w;x>S&&(S=x),A>S&&(S=A);const E=(S-T)/2,R=b*2;c[_+R+0]=T+E,c[_+R+1]=E+(Math.abs(T)+E)*dl}}return c}function G(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function ro(s){let e=-1,t=-1/0;for(let n=0;n<3;n++){const i=s[n+3]-s[n];i>t&&(t=i,e=n)}return e}function ao(s,e){e.set(s)}function co(s,e,t){let n,i;for(let o=0;o<3;o++){const r=o+3;n=s[o],i=e[o],t[o]=n<i?n:i,n=s[r],i=e[r],t[r]=n>i?n:i}}function Sn(s,e,t){for(let n=0;n<3;n++){const i=e[s+2*n],o=e[s+2*n+1],r=i-o,a=i+o;r<t[n]&&(t[n]=r),a>t[n+3]&&(t[n+3]=a)}}function Gt(s){const e=s[3]-s[0],t=s[4]-s[1],n=s[5]-s[2];return 2*(e*t+t*n+n*e)}const Ie=32,bl=(s,e)=>s.candidate-e.candidate,Fe=new Array(Ie).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),En=new Float32Array(6);function wl(s,e,t,n,i,o){let r=-1,a=0;if(o===dr)r=ro(e),r!==-1&&(a=(e[r]+e[r+3])/2);else if(o===fl)r=ro(s),r!==-1&&(a=xl(t,n,i,r));else if(o===hl){const c=Gt(s);let l=Ti*i;const u=n*6,f=(n+i)*6;for(let h=0;h<3;h++){const d=e[h],p=(e[h+3]-d)/Ie;if(i<Ie/4){const m=[...Fe];m.length=i;let g=0;for(let w=u;w<f;w+=6,g++){const x=m[g];x.candidate=t[w+2*h],x.count=0;const{bounds:A,leftCacheBounds:T,rightCacheBounds:S}=x;for(let E=0;E<3;E++)S[E]=1/0,S[E+3]=-1/0,T[E]=1/0,T[E+3]=-1/0,A[E]=1/0,A[E+3]=-1/0;Sn(w,t,A)}m.sort(bl);let b=i;for(let w=0;w<b;w++){const x=m[w];for(;w+1<b&&m[w+1].candidate===x.candidate;)m.splice(w+1,1),b--}for(let w=u;w<f;w+=6){const x=t[w+2*h];for(let A=0;A<b;A++){const T=m[A];x>=T.candidate?Sn(w,t,T.rightCacheBounds):(Sn(w,t,T.leftCacheBounds),T.count++)}}for(let w=0;w<b;w++){const x=m[w],A=x.count,T=i-x.count,S=x.leftCacheBounds,E=x.rightCacheBounds;let R=0;A!==0&&(R=Gt(S)/c);let I=0;T!==0&&(I=Gt(E)/c);const C=oo+Ti*(R*A+I*T);C<l&&(r=h,l=C,a=x.candidate)}}else{for(let b=0;b<Ie;b++){const w=Fe[b];w.count=0,w.candidate=d+p+b*p;const x=w.bounds;for(let A=0;A<3;A++)x[A]=1/0,x[A+3]=-1/0}for(let b=u;b<f;b+=6){let A=~~((t[b+2*h]-d)/p);A>=Ie&&(A=Ie-1);const T=Fe[A];T.count++,Sn(b,t,T.bounds)}const m=Fe[Ie-1];ao(m.bounds,m.rightCacheBounds);for(let b=Ie-2;b>=0;b--){const w=Fe[b],x=Fe[b+1];co(w.bounds,x.rightCacheBounds,w.rightCacheBounds)}let g=0;for(let b=0;b<Ie-1;b++){const w=Fe[b],x=w.count,A=w.bounds,S=Fe[b+1].rightCacheBounds;x!==0&&(g===0?ao(A,En):co(A,En,En)),g+=x;let E=0,R=0;g!==0&&(E=Gt(En)/c);const I=i-g;I!==0&&(R=Gt(S)/c);const C=oo+Ti*(E*g+R*I);C<l&&(r=h,l=C,a=w.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:r,pos:a}}function xl(s,e,t,n){let i=0;for(let o=e,r=e+t;o<r;o++)i+=s[o*6+n*2];return i/t}class Si{constructor(){this.boundingData=new Float32Array(6)}}function Tl(s,e,t,n,i,o){let r=n,a=n+i-1;const c=o.pos,l=o.axis*2;for(;;){for(;r<=a&&t[r*6+l]<c;)r++;for(;r<=a&&t[a*6+l]>=c;)a--;if(r<a){for(let u=0;u<3;u++){let f=e[r*3+u];e[r*3+u]=e[a*3+u],e[a*3+u]=f}for(let u=0;u<6;u++){let f=t[r*6+u];t[r*6+u]=t[a*6+u],t[a*6+u]=f}r++,a--}else return r}}function vl(s,e,t,n,i,o){let r=n,a=n+i-1;const c=o.pos,l=o.axis*2;for(;;){for(;r<=a&&t[r*6+l]<c;)r++;for(;r<=a&&t[a*6+l]>=c;)a--;if(r<a){let u=s[r];s[r]=s[a],s[a]=u;for(let f=0;f<6;f++){let h=t[r*6+f];t[r*6+f]=t[a*6+f],t[a*6+f]=h}r++,a--}else return r}}function ie(s,e){return e[s+15]===65535}function re(s,e){return e[s+6]}function fe(s,e){return e[s+14]}function he(s){return s+8}function de(s,e){return e[s+6]}function _r(s,e){return e[s+7]}let gr,tn,qn,yr;const Al=Math.pow(2,32);function rs(s){return"count"in s?1:1+rs(s.left)+rs(s.right)}function Sl(s,e,t){return gr=new Float32Array(t),tn=new Uint32Array(t),qn=new Uint16Array(t),yr=new Uint8Array(t),as(s,e)}function as(s,e){const t=s/4,n=s/2,i="count"in e,o=e.boundingData;for(let r=0;r<6;r++)gr[t+r]=o[r];if(i)if(e.buffer){const r=e.buffer;yr.set(new Uint8Array(r),s);for(let a=s,c=s+r.byteLength;a<c;a+=cn){const l=a/2;ie(l,qn)||(tn[a/4+6]+=t)}return s+r.byteLength}else{const r=e.offset,a=e.count;return tn[t+6]=r,qn[n+14]=a,qn[n+15]=ui,s+cn}else{const r=e.left,a=e.right,c=e.splitAxis;let l;if(l=as(s+cn,r),l/4>Al)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return tn[t+6]=l/4,l=as(l,a),tn[t+7]=c,l}}function El(s,e){const t=(s.index?s.index.count:s.attributes.position.count)/3,n=t>2**16,i=n?4:2,o=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=n?new Uint32Array(o):new Uint16Array(o);for(let a=0,c=r.length;a<c;a++)r[a]=a;return r}function Ll(s,e,t,n,i){const{maxDepth:o,verbose:r,maxLeafTris:a,strategy:c,onProgress:l,indirect:u}=i,f=s._indirectBuffer,h=s.geometry,d=h.index?h.index.array:null,y=u?vl:Tl,_=Ht(h),p=new Float32Array(6);let m=!1;const g=new Si;return Ai(e,t,n,g.boundingData,p),w(g,t,n,p),g;function b(x){l&&l(x/_)}function w(x,A,T,S=null,E=0){if(!m&&E>=o&&(m=!0,r&&(console.warn(`MeshBVH: Max depth of ${o} reached when generating BVH. Consider increasing maxDepth.`),console.warn(h))),T<=a||E>=o)return b(A+T),x.offset=A,x.count=T,x;const R=wl(x.boundingData,S,e,A,T,c);if(R.axis===-1)return b(A+T),x.offset=A,x.count=T,x;const I=y(f,d,e,A,T,R);if(I===A||I===A+T)b(A+T),x.offset=A,x.count=T;else{x.splitAxis=R.axis;const C=new Si,M=A,O=I-A;x.left=C,Ai(e,M,O,C.boundingData,p),w(C,M,O,p,E+1);const D=new Si,k=I,q=T-O;x.right=D,Ai(e,k,q,D.boundingData,p),w(D,k,q,p,E+1)}return x}}function Cl(s,e){const t=s.geometry;e.indirect&&(s._indirectBuffer=El(t,e.useSharedArrayBuffer),gl(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||_l(t,e);const n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=yl(t),o=e.indirect?pr(t,e.range):mr(t,e.range);s._roots=o.map(r=>{const a=Ll(s,i,r.offset,r.count,e),c=rs(a),l=new n(cn*c);return Sl(0,a,l),l})}class ke{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let o=0,r=e.length;o<r;o++){const c=e[o][t];n=c<n?c:n,i=c>i?c:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let o=0,r=t.length;o<r;o++){const a=t[o],c=e.dot(a);n=c<n?c:n,i=c>i?c:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}ke.prototype.setFromBox=(function(){const s=new P;return function(t,n){const i=n.min,o=n.max;let r=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){s.x=i.x*c+o.x*(1-c),s.y=i.y*l+o.y*(1-l),s.z=i.z*u+o.z*(1-u);const f=t.dot(s);r=Math.min(f,r),a=Math.max(f,a)}this.min=r,this.max=a}})();const Pl=(function(){const s=new P,e=new P,t=new P;return function(i,o,r){const a=i.start,c=s,l=o.start,u=e;t.subVectors(a,l),s.subVectors(i.end,i.start),e.subVectors(o.end,o.start);const f=t.dot(u),h=u.dot(c),d=u.dot(u),y=t.dot(c),p=c.dot(c)*d-h*h;let m,g;p!==0?m=(f*h-y*d)/p:m=0,g=(f+m*h)/d,r.x=m,r.y=g}})(),Ss=(function(){const s=new H,e=new P,t=new P;return function(i,o,r,a){Pl(i,o,s);let c=s.x,l=s.y;if(c>=0&&c<=1&&l>=0&&l<=1){i.at(c,r),o.at(l,a);return}else if(c>=0&&c<=1){l<0?o.at(0,a):o.at(1,a),i.closestPointToPoint(a,!0,r);return}else if(l>=0&&l<=1){c<0?i.at(0,r):i.at(1,r),o.closestPointToPoint(r,!0,a);return}else{let u;c<0?u=i.start:u=i.end;let f;l<0?f=o.start:f=o.end;const h=e,d=t;if(i.closestPointToPoint(f,!0,e),o.closestPointToPoint(u,!0,t),h.distanceToSquared(f)<=d.distanceToSquared(u)){r.copy(h),a.copy(f);return}else{r.copy(u),a.copy(d);return}}}})(),Rl=(function(){const s=new P,e=new P,t=new ci,n=new _e;return function(o,r){const{radius:a,center:c}=o,{a:l,b:u,c:f}=r;if(n.start=l,n.end=u,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a||(n.start=l,n.end=f,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a)||(n.start=u,n.end=f,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a))return!0;const _=r.getPlane(t);if(Math.abs(_.distanceToPoint(c))<=a){const m=_.projectPoint(c,e);if(r.containsPoint(m))return!0}return!1}})(),Ml=1e-15;function Ei(s){return Math.abs(s)<Ml}class ge extends ne{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new P),this.satBounds=new Array(4).fill().map(()=>new ke),this.points=[this.a,this.b,this.c],this.sphere=new Ko,this.plane=new ci,this.needsUpdate=!0}intersectsSphere(e){return Rl(e,this)}update(){const e=this.a,t=this.b,n=this.c,i=this.points,o=this.satAxes,r=this.satBounds,a=o[0],c=r[0];this.getNormal(a),c.setFromPoints(a,i);const l=o[1],u=r[1];l.subVectors(e,t),u.setFromPoints(l,i);const f=o[2],h=r[2];f.subVectors(t,n),h.setFromPoints(f,i);const d=o[3],y=r[3];d.subVectors(n,e),y.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}ge.prototype.closestPointToSegment=(function(){const s=new P,e=new P,t=new _e;return function(i,o=null,r=null){const{start:a,end:c}=i,l=this.points;let u,f=1/0;for(let h=0;h<3;h++){const d=(h+1)%3;t.start.copy(l[h]),t.end.copy(l[d]),Ss(t,i,s,e),u=s.distanceToSquared(e),u<f&&(f=u,o&&o.copy(s),r&&r.copy(e))}return this.closestPointToPoint(a,s),u=a.distanceToSquared(s),u<f&&(f=u,o&&o.copy(s),r&&r.copy(a)),this.closestPointToPoint(c,s),u=c.distanceToSquared(s),u<f&&(f=u,o&&o.copy(s),r&&r.copy(c)),Math.sqrt(f)}})();ge.prototype.intersectsTriangle=(function(){const s=new ge,e=new Array(3),t=new Array(3),n=new ke,i=new ke,o=new P,r=new P,a=new P,c=new P,l=new P,u=new _e,f=new _e,h=new _e,d=new P;function y(_,p,m){const g=_.points;let b=0,w=-1;for(let x=0;x<3;x++){const{start:A,end:T}=u;A.copy(g[x]),T.copy(g[(x+1)%3]),u.delta(r);const S=Ei(p.distanceToPoint(A));if(Ei(p.normal.dot(r))&&S){m.copy(u),b=2;break}const E=p.intersectLine(u,d);if(!E&&S&&d.copy(A),(E||S)&&!Ei(d.distanceTo(T))){if(b<=1)(b===1?m.start:m.end).copy(d),S&&(w=b);else if(b>=2){(w===1?m.start:m.end).copy(d),b=2;break}if(b++,b===2&&w===-1)break}}return b}return function(p,m=null,g=!1){this.needsUpdate&&this.update(),p.isExtendedTriangle?p.needsUpdate&&p.update():(s.copy(p),s.update(),p=s);const b=this.plane,w=p.plane;if(Math.abs(b.normal.dot(w.normal))>1-1e-10){const x=this.satBounds,A=this.satAxes;t[0]=p.a,t[1]=p.b,t[2]=p.c;for(let E=0;E<4;E++){const R=x[E],I=A[E];if(n.setFromPoints(I,t),R.isSeparated(n))return!1}const T=p.satBounds,S=p.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let E=0;E<4;E++){const R=T[E],I=S[E];if(n.setFromPoints(I,e),R.isSeparated(n))return!1}for(let E=0;E<4;E++){const R=A[E];for(let I=0;I<4;I++){const C=S[I];if(o.crossVectors(R,C),n.setFromPoints(o,e),i.setFromPoints(o,t),n.isSeparated(i))return!1}}return m&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),m.start.set(0,0,0),m.end.set(0,0,0)),!0}else{const x=y(this,w,f);if(x===1&&p.containsPoint(f.end))return m&&(m.start.copy(f.end),m.end.copy(f.end)),!0;if(x!==2)return!1;const A=y(p,b,h);if(A===1&&this.containsPoint(h.end))return m&&(m.start.copy(h.end),m.end.copy(h.end)),!0;if(A!==2)return!1;if(f.delta(a),h.delta(c),a.dot(c)<0){let M=h.start;h.start=h.end,h.end=M}const T=f.start.dot(a),S=f.end.dot(a),E=h.start.dot(a),R=h.end.dot(a),I=S<E,C=T<R;return T!==R&&E!==S&&I===C?!1:(m&&(l.subVectors(f.start,h.start),l.dot(a)>0?m.start.copy(f.start):m.start.copy(h.start),l.subVectors(f.end,h.end),l.dot(a)<0?m.end.copy(f.end):m.end.copy(h.end)),!0)}}})();ge.prototype.distanceToPoint=(function(){const s=new P;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}})();ge.prototype.distanceToTriangle=(function(){const s=new P,e=new P,t=["a","b","c"],n=new _e,i=new _e;return function(r,a=null,c=null){const l=a||c?n:null;if(this.intersectsTriangle(r,l))return(a||c)&&(a&&l.getCenter(a),c&&l.getCenter(c)),0;let u=1/0;for(let f=0;f<3;f++){let h;const d=t[f],y=r[d];this.closestPointToPoint(y,s),h=y.distanceToSquared(s),h<u&&(u=h,a&&a.copy(s),c&&c.copy(y));const _=this[d];r.closestPointToPoint(_,s),h=_.distanceToSquared(s),h<u&&(u=h,a&&a.copy(_),c&&c.copy(s))}for(let f=0;f<3;f++){const h=t[f],d=t[(f+1)%3];n.set(this[h],this[d]);for(let y=0;y<3;y++){const _=t[y],p=t[(y+1)%3];i.set(r[_],r[p]),Ss(n,i,s,e);const m=s.distanceToSquared(e);m<u&&(u=m,a&&a.copy(s),c&&c.copy(e))}}return Math.sqrt(u)}})();class Q{constructor(e,t,n){this.isOrientedBox=!0,this.min=new P,this.max=new P,this.matrix=new W,this.invMatrix=new W,this.points=new Array(8).fill().map(()=>new P),this.satAxes=new Array(3).fill().map(()=>new P),this.satBounds=new Array(3).fill().map(()=>new ke),this.alignedSatBounds=new Array(3).fill().map(()=>new ke),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Q.prototype.update=(function(){return function(){const e=this.matrix,t=this.min,n=this.max,i=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let f=0;f<=1;f++){const h=1*l|2*u|4*f,d=i[h];d.x=l?n.x:t.x,d.y=u?n.y:t.y,d.z=f?n.z:t.z,d.applyMatrix4(e)}const o=this.satBounds,r=this.satAxes,a=i[0];for(let l=0;l<3;l++){const u=r[l],f=o[l],h=1<<l,d=i[h];u.subVectors(a,d),f.setFromPoints(u,i)}const c=this.alignedSatBounds;c[0].setFromPointsField(i,"x"),c[1].setFromPointsField(i,"y"),c[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();Q.prototype.intersectsBox=(function(){const s=new ke;return function(t){this.needsUpdate&&this.update();const n=t.min,i=t.max,o=this.satBounds,r=this.satAxes,a=this.alignedSatBounds;if(s.min=n.x,s.max=i.x,a[0].isSeparated(s)||(s.min=n.y,s.max=i.y,a[1].isSeparated(s))||(s.min=n.z,s.max=i.z,a[2].isSeparated(s)))return!1;for(let c=0;c<3;c++){const l=r[c],u=o[c];if(s.setFromBox(l,t),u.isSeparated(s))return!1}return!0}})();Q.prototype.intersectsTriangle=(function(){const s=new ge,e=new Array(3),t=new ke,n=new ke,i=new P;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);const a=this.satBounds,c=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let h=0;h<3;h++){const d=a[h],y=c[h];if(t.setFromPoints(y,e),d.isSeparated(t))return!1}const l=r.satBounds,u=r.satAxes,f=this.points;for(let h=0;h<3;h++){const d=l[h],y=u[h];if(t.setFromPoints(y,f),d.isSeparated(t))return!1}for(let h=0;h<3;h++){const d=c[h];for(let y=0;y<4;y++){const _=u[y];if(i.crossVectors(d,_),t.setFromPoints(i,e),n.setFromPoints(i,f),t.isSeparated(n))return!1}}return!0}})();Q.prototype.closestPointToPoint=(function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})();Q.prototype.distanceToPoint=(function(){const s=new P;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}})();Q.prototype.distanceToBox=(function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new _e),t=new Array(12).fill().map(()=>new _e),n=new P,i=new P;return function(r,a=0,c=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(c||l)&&(r.getCenter(i),this.closestPointToPoint(i,n),r.closestPointToPoint(n,i),c&&c.copy(n),l&&l.copy(i)),0;const u=a*a,f=r.min,h=r.max,d=this.points;let y=1/0;for(let p=0;p<8;p++){const m=d[p];i.copy(m).clamp(f,h);const g=m.distanceToSquared(i);if(g<y&&(y=g,c&&c.copy(m),l&&l.copy(i),g<u))return Math.sqrt(g)}let _=0;for(let p=0;p<3;p++)for(let m=0;m<=1;m++)for(let g=0;g<=1;g++){const b=(p+1)%3,w=(p+2)%3,x=m<<b|g<<w,A=1<<p|m<<b|g<<w,T=d[x],S=d[A];e[_].set(T,S);const R=s[p],I=s[b],C=s[w],M=t[_],O=M.start,D=M.end;O[R]=f[R],O[I]=m?f[I]:h[I],O[C]=g?f[C]:h[I],D[R]=h[R],D[I]=m?f[I]:h[I],D[C]=g?f[C]:h[I],_++}for(let p=0;p<=1;p++)for(let m=0;m<=1;m++)for(let g=0;g<=1;g++){i.x=p?h.x:f.x,i.y=m?h.y:f.y,i.z=g?h.z:f.z,this.closestPointToPoint(i,n);const b=i.distanceToSquared(n);if(b<y&&(y=b,c&&c.copy(n),l&&l.copy(i),b<u))return Math.sqrt(b)}for(let p=0;p<12;p++){const m=e[p];for(let g=0;g<12;g++){const b=t[g];Ss(m,b,n,i);const w=n.distanceToSquared(i);if(w<y&&(y=w,c&&c.copy(n),l&&l.copy(i),w<u))return Math.sqrt(w)}}return Math.sqrt(y)}})();class Es{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Il extends Es{constructor(){super(()=>new ge)}}const pe=new Il;class Ol{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const z=new Ol;let Ye,Nt;const xt=[],Ln=new Es(()=>new xe);function Dl(s,e,t,n,i,o){Ye=Ln.getPrimitive(),Nt=Ln.getPrimitive(),xt.push(Ye,Nt),z.setBuffer(s._roots[e]);const r=cs(0,s.geometry,t,n,i,o);z.clearBuffer(),Ln.releasePrimitive(Ye),Ln.releasePrimitive(Nt),xt.pop(),xt.pop();const a=xt.length;return a>0&&(Nt=xt[a-1],Ye=xt[a-2]),r}function cs(s,e,t,n,i=null,o=0,r=0){const{float32Array:a,uint16Array:c,uint32Array:l}=z;let u=s*2;if(ie(u,c)){const h=re(s,l),d=fe(u,c);return G(s,a,Ye),n(h,d,!1,r,o+s,Ye)}else{let R=function(C){const{uint16Array:M,uint32Array:O}=z;let D=C*2;for(;!ie(D,M);)C=he(C),D=C*2;return re(C,O)},I=function(C){const{uint16Array:M,uint32Array:O}=z;let D=C*2;for(;!ie(D,M);)C=de(C,O),D=C*2;return re(C,O)+fe(D,M)};const h=he(s),d=de(s,l);let y=h,_=d,p,m,g,b;if(i&&(g=Ye,b=Nt,G(y,a,g),G(_,a,b),p=i(g),m=i(b),m<p)){y=d,_=h;const C=p;p=m,m=C,g=b}g||(g=Ye,G(y,a,g));const w=ie(y*2,c),x=t(g,w,p,r+1,o+y);let A;if(x===so){const C=R(y),O=I(y)-C;A=n(C,O,!0,r+1,o+y,g)}else A=x&&cs(y,e,t,n,i,o,r+1);if(A)return!0;b=Nt,G(_,a,b);const T=ie(_*2,c),S=t(b,T,m,r+1,o+_);let E;if(S===so){const C=R(_),O=I(_)-C;E=n(C,O,!0,r+1,o+_,b)}else E=S&&cs(_,e,t,n,i,o,r+1);return!!E}}const jt=new P,Li=new P;function Nl(s,e,t={},n=0,i=1/0){const o=n*n,r=i*i;let a=1/0,c=null;if(s.shapecast({boundsTraverseOrder:u=>(jt.copy(e).clamp(u.min,u.max),jt.distanceToSquared(e)),intersectsBounds:(u,f,h)=>h<a&&h<r,intersectsTriangle:(u,f)=>{u.closestPointToPoint(e,jt);const h=e.distanceToSquared(jt);return h<a&&(Li.copy(jt),a=h,c=f),h<o}}),a===1/0)return null;const l=Math.sqrt(a);return t.point?t.point.copy(Li):t.point=Li.clone(),t.distance=l,t.faceIndex=c,t}const kl=parseInt(ia)>=169,st=new P,ot=new P,rt=new P,Cn=new H,Pn=new H,Rn=new H,lo=new P,uo=new P,fo=new P,Xt=new P;function Bl(s,e,t,n,i,o,r,a){let c;if(o===na?c=s.intersectTriangle(n,t,e,!0,i):c=s.intersectTriangle(e,t,n,o!==Ft,i),c===null)return null;const l=s.origin.distanceTo(i);return l<r||l>a?null:{distance:l,point:i.clone()}}function Fl(s,e,t,n,i,o,r,a,c,l,u){st.fromBufferAttribute(e,o),ot.fromBufferAttribute(e,r),rt.fromBufferAttribute(e,a);const f=Bl(s,st,ot,rt,Xt,c,l,u);if(f){const h=new P;ne.getBarycoord(Xt,st,ot,rt,h),n&&(Cn.fromBufferAttribute(n,o),Pn.fromBufferAttribute(n,r),Rn.fromBufferAttribute(n,a),f.uv=ne.getInterpolation(Xt,st,ot,rt,Cn,Pn,Rn,new H)),i&&(Cn.fromBufferAttribute(i,o),Pn.fromBufferAttribute(i,r),Rn.fromBufferAttribute(i,a),f.uv1=ne.getInterpolation(Xt,st,ot,rt,Cn,Pn,Rn,new H)),t&&(lo.fromBufferAttribute(t,o),uo.fromBufferAttribute(t,r),fo.fromBufferAttribute(t,a),f.normal=ne.getInterpolation(Xt,st,ot,rt,lo,uo,fo,new P),f.normal.dot(s.direction)>0&&f.normal.multiplyScalar(-1));const d={a:o,b:r,c:a,normal:new P,materialIndex:0};ne.getNormal(st,ot,rt,d.normal),f.face=d,f.faceIndex=o,kl&&(f.barycoord=h)}return f}function fi(s,e,t,n,i,o,r){const a=n*3;let c=a+0,l=a+1,u=a+2;const f=s.index;s.index&&(c=f.getX(c),l=f.getX(l),u=f.getX(u));const{position:h,normal:d,uv:y,uv1:_}=s.attributes,p=Fl(t,h,d,y,_,c,l,u,e,o,r);return p?(p.faceIndex=n,i&&i.push(p),p):null}function X(s,e,t,n){const i=s.a,o=s.b,r=s.c;let a=e,c=e+1,l=e+2;t&&(a=t.getX(a),c=t.getX(c),l=t.getX(l)),i.x=n.getX(a),i.y=n.getY(a),i.z=n.getZ(a),o.x=n.getX(c),o.y=n.getY(c),o.z=n.getZ(c),r.x=n.getX(l),r.y=n.getY(l),r.z=n.getZ(l)}function Hl(s,e,t,n,i,o,r,a){const{geometry:c,_indirectBuffer:l}=s;for(let u=n,f=n+i;u<f;u++)fi(c,e,t,u,o,r,a)}function zl(s,e,t,n,i,o,r){const{geometry:a,_indirectBuffer:c}=s;let l=1/0,u=null;for(let f=n,h=n+i;f<h;f++){let d;d=fi(a,e,t,f,null,o,r),d&&d.distance<l&&(u=d,l=d.distance)}return u}function Ul(s,e,t,n,i,o,r){const{geometry:a}=t,{index:c}=a,l=a.attributes.position;for(let u=s,f=e+s;u<f;u++){let h;if(h=u,X(r,h*3,c,l),r.needsUpdate=!0,n(r,h,i,o))return!0}return!1}function Vl(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,n=t.index?t.index.array:null,i=t.attributes.position;let o,r,a,c,l=0;const u=s._roots;for(let h=0,d=u.length;h<d;h++)o=u[h],r=new Uint32Array(o),a=new Uint16Array(o),c=new Float32Array(o),f(0,l),l+=o.byteLength;function f(h,d,y=!1){const _=h*2;if(a[_+15]===ui){const m=r[h+6],g=a[_+14];let b=1/0,w=1/0,x=1/0,A=-1/0,T=-1/0,S=-1/0;for(let E=3*m,R=3*(m+g);E<R;E++){let I=n[E];const C=i.getX(I),M=i.getY(I),O=i.getZ(I);C<b&&(b=C),C>A&&(A=C),M<w&&(w=M),M>T&&(T=M),O<x&&(x=O),O>S&&(S=O)}return c[h+0]!==b||c[h+1]!==w||c[h+2]!==x||c[h+3]!==A||c[h+4]!==T||c[h+5]!==S?(c[h+0]=b,c[h+1]=w,c[h+2]=x,c[h+3]=A,c[h+4]=T,c[h+5]=S,!0):!1}else{const m=h+8,g=r[h+6],b=m+d,w=g+d;let x=y,A=!1,T=!1;e?x||(A=e.has(b),T=e.has(w),x=!A&&!T):(A=!0,T=!0);const S=x||A,E=x||T;let R=!1;S&&(R=f(m,d,x));let I=!1;E&&(I=f(g,d,x));const C=R||I;if(C)for(let M=0;M<3;M++){const O=m+M,D=g+M,k=c[O],q=c[O+3],wt=c[D],nt=c[D+3];c[h+M]=k<wt?k:wt,c[h+M+3]=q>nt?q:nt}return C}}}function Qe(s,e,t,n,i){let o,r,a,c,l,u;const f=1/t.direction.x,h=1/t.direction.y,d=1/t.direction.z,y=t.origin.x,_=t.origin.y,p=t.origin.z;let m=e[s],g=e[s+3],b=e[s+1],w=e[s+3+1],x=e[s+2],A=e[s+3+2];return f>=0?(o=(m-y)*f,r=(g-y)*f):(o=(g-y)*f,r=(m-y)*f),h>=0?(a=(b-_)*h,c=(w-_)*h):(a=(w-_)*h,c=(b-_)*h),o>c||a>r||((a>o||isNaN(o))&&(o=a),(c<r||isNaN(r))&&(r=c),d>=0?(l=(x-p)*d,u=(A-p)*d):(l=(A-p)*d,u=(x-p)*d),o>u||l>r)?!1:((l>o||o!==o)&&(o=l),(u<r||r!==r)&&(r=u),o<=i&&r>=n)}function Gl(s,e,t,n,i,o,r,a){const{geometry:c,_indirectBuffer:l}=s;for(let u=n,f=n+i;u<f;u++){let h=l?l[u]:u;fi(c,e,t,h,o,r,a)}}function jl(s,e,t,n,i,o,r){const{geometry:a,_indirectBuffer:c}=s;let l=1/0,u=null;for(let f=n,h=n+i;f<h;f++){let d;d=fi(a,e,t,c?c[f]:f,null,o,r),d&&d.distance<l&&(u=d,l=d.distance)}return u}function Xl(s,e,t,n,i,o,r){const{geometry:a}=t,{index:c}=a,l=a.attributes.position;for(let u=s,f=e+s;u<f;u++){let h;if(h=t.resolveTriangleIndex(u),X(r,h*3,c,l),r.needsUpdate=!0,n(r,h,i,o))return!0}return!1}function Kl(s,e,t,n,i,o,r){z.setBuffer(s._roots[e]),ls(0,s,t,n,i,o,r),z.clearBuffer()}function ls(s,e,t,n,i,o,r){const{float32Array:a,uint16Array:c,uint32Array:l}=z,u=s*2;if(ie(u,c)){const h=re(s,l),d=fe(u,c);Hl(e,t,n,h,d,i,o,r)}else{const h=he(s);Qe(h,a,n,o,r)&&ls(h,e,t,n,i,o,r);const d=de(s,l);Qe(d,a,n,o,r)&&ls(d,e,t,n,i,o,r)}}const Yl=["x","y","z"];function $l(s,e,t,n,i,o){z.setBuffer(s._roots[e]);const r=us(0,s,t,n,i,o);return z.clearBuffer(),r}function us(s,e,t,n,i,o){const{float32Array:r,uint16Array:a,uint32Array:c}=z;let l=s*2;if(ie(l,a)){const f=re(s,c),h=fe(l,a);return zl(e,t,n,f,h,i,o)}else{const f=_r(s,c),h=Yl[f],y=n.direction[h]>=0;let _,p;y?(_=he(s),p=de(s,c)):(_=de(s,c),p=he(s));const g=Qe(_,r,n,i,o)?us(_,e,t,n,i,o):null;if(g){const x=g.point[h];if(y?x<=r[p+f]:x>=r[p+f+3])return g}const w=Qe(p,r,n,i,o)?us(p,e,t,n,i,o):null;return g&&w?g.distance<=w.distance?g:w:g||w||null}}const Mn=new xe,Tt=new ge,vt=new ge,Kt=new W,ho=new Q,In=new Q;function Wl(s,e,t,n){z.setBuffer(s._roots[e]);const i=fs(0,s,t,n);return z.clearBuffer(),i}function fs(s,e,t,n,i=null){const{float32Array:o,uint16Array:r,uint32Array:a}=z;let c=s*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),ho.set(t.boundingBox.min,t.boundingBox.max,n),i=ho),ie(c,r)){const u=e.geometry,f=u.index,h=u.attributes.position,d=t.index,y=t.attributes.position,_=re(s,a),p=fe(c,r);if(Kt.copy(n).invert(),t.boundsTree)return G(s,o,In),In.matrix.copy(Kt),In.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>In.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(n),g.b.applyMatrix4(n),g.c.applyMatrix4(n),g.needsUpdate=!0;for(let b=_*3,w=(p+_)*3;b<w;b+=3)if(X(vt,b,f,h),vt.needsUpdate=!0,g.intersectsTriangle(vt))return!0;return!1}});for(let m=_*3,g=(p+_)*3;m<g;m+=3){X(Tt,m,f,h),Tt.a.applyMatrix4(Kt),Tt.b.applyMatrix4(Kt),Tt.c.applyMatrix4(Kt),Tt.needsUpdate=!0;for(let b=0,w=d.count;b<w;b+=3)if(X(vt,b,d,y),vt.needsUpdate=!0,Tt.intersectsTriangle(vt))return!0}}else{const u=s+8,f=a[s+6];return G(u,o,Mn),!!(i.intersectsBox(Mn)&&fs(u,e,t,n,i)||(G(f,o,Mn),i.intersectsBox(Mn)&&fs(f,e,t,n,i)))}}const On=new W,Ci=new Q,Yt=new Q,ql=new P,Zl=new P,Jl=new P,Ql=new P;function eu(s,e,t,n={},i={},o=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Ci.set(e.boundingBox.min,e.boundingBox.max,t),Ci.needsUpdate=!0;const a=s.geometry,c=a.attributes.position,l=a.index,u=e.attributes.position,f=e.index,h=pe.getPrimitive(),d=pe.getPrimitive();let y=ql,_=Zl,p=null,m=null;i&&(p=Jl,m=Ql);let g=1/0,b=null,w=null;return On.copy(t).invert(),Yt.matrix.copy(On),s.shapecast({boundsTraverseOrder:x=>Ci.distanceToBox(x),intersectsBounds:(x,A,T)=>T<g&&T<r?(A&&(Yt.min.copy(x.min),Yt.max.copy(x.max),Yt.needsUpdate=!0),!0):!1,intersectsRange:(x,A)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:S=>Yt.distanceToBox(S),intersectsBounds:(S,E,R)=>R<g&&R<r,intersectsRange:(S,E)=>{for(let R=S,I=S+E;R<I;R++){X(d,3*R,f,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=x,M=x+A;C<M;C++){X(h,3*C,l,c),h.needsUpdate=!0;const O=h.distanceToTriangle(d,y,p);if(O<g&&(_.copy(y),m&&m.copy(p),g=O,b=C,w=R),O<o)return!0}}}});{const T=Ht(e);for(let S=0,E=T;S<E;S++){X(d,3*S,f,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let R=x,I=x+A;R<I;R++){X(h,3*R,l,c),h.needsUpdate=!0;const C=h.distanceToTriangle(d,y,p);if(C<g&&(_.copy(y),m&&m.copy(p),g=C,b=R,w=S),C<o)return!0}}}}}),pe.releasePrimitive(h),pe.releasePrimitive(d),g===1/0?null:(n.point?n.point.copy(_):n.point=_.clone(),n.distance=g,n.faceIndex=b,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(On),_.applyMatrix4(On),i.distance=_.sub(i.point).length(),i.faceIndex=w),n)}function tu(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,n=t.index?t.index.array:null,i=t.attributes.position;let o,r,a,c,l=0;const u=s._roots;for(let h=0,d=u.length;h<d;h++)o=u[h],r=new Uint32Array(o),a=new Uint16Array(o),c=new Float32Array(o),f(0,l),l+=o.byteLength;function f(h,d,y=!1){const _=h*2;if(a[_+15]===ui){const m=r[h+6],g=a[_+14];let b=1/0,w=1/0,x=1/0,A=-1/0,T=-1/0,S=-1/0;for(let E=m,R=m+g;E<R;E++){const I=3*s.resolveTriangleIndex(E);for(let C=0;C<3;C++){let M=I+C;M=n?n[M]:M;const O=i.getX(M),D=i.getY(M),k=i.getZ(M);O<b&&(b=O),O>A&&(A=O),D<w&&(w=D),D>T&&(T=D),k<x&&(x=k),k>S&&(S=k)}}return c[h+0]!==b||c[h+1]!==w||c[h+2]!==x||c[h+3]!==A||c[h+4]!==T||c[h+5]!==S?(c[h+0]=b,c[h+1]=w,c[h+2]=x,c[h+3]=A,c[h+4]=T,c[h+5]=S,!0):!1}else{const m=h+8,g=r[h+6],b=m+d,w=g+d;let x=y,A=!1,T=!1;e?x||(A=e.has(b),T=e.has(w),x=!A&&!T):(A=!0,T=!0);const S=x||A,E=x||T;let R=!1;S&&(R=f(m,d,x));let I=!1;E&&(I=f(g,d,x));const C=R||I;if(C)for(let M=0;M<3;M++){const O=m+M,D=g+M,k=c[O],q=c[O+3],wt=c[D],nt=c[D+3];c[h+M]=k<wt?k:wt,c[h+M+3]=q>nt?q:nt}return C}}}function nu(s,e,t,n,i,o,r){z.setBuffer(s._roots[e]),hs(0,s,t,n,i,o,r),z.clearBuffer()}function hs(s,e,t,n,i,o,r){const{float32Array:a,uint16Array:c,uint32Array:l}=z,u=s*2;if(ie(u,c)){const h=re(s,l),d=fe(u,c);Gl(e,t,n,h,d,i,o,r)}else{const h=he(s);Qe(h,a,n,o,r)&&hs(h,e,t,n,i,o,r);const d=de(s,l);Qe(d,a,n,o,r)&&hs(d,e,t,n,i,o,r)}}const iu=["x","y","z"];function su(s,e,t,n,i,o){z.setBuffer(s._roots[e]);const r=ds(0,s,t,n,i,o);return z.clearBuffer(),r}function ds(s,e,t,n,i,o){const{float32Array:r,uint16Array:a,uint32Array:c}=z;let l=s*2;if(ie(l,a)){const f=re(s,c),h=fe(l,a);return jl(e,t,n,f,h,i,o)}else{const f=_r(s,c),h=iu[f],y=n.direction[h]>=0;let _,p;y?(_=he(s),p=de(s,c)):(_=de(s,c),p=he(s));const g=Qe(_,r,n,i,o)?ds(_,e,t,n,i,o):null;if(g){const x=g.point[h];if(y?x<=r[p+f]:x>=r[p+f+3])return g}const w=Qe(p,r,n,i,o)?ds(p,e,t,n,i,o):null;return g&&w?g.distance<=w.distance?g:w:g||w||null}}const Dn=new xe,At=new ge,St=new ge,$t=new W,po=new Q,Nn=new Q;function ou(s,e,t,n){z.setBuffer(s._roots[e]);const i=ps(0,s,t,n);return z.clearBuffer(),i}function ps(s,e,t,n,i=null){const{float32Array:o,uint16Array:r,uint32Array:a}=z;let c=s*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),po.set(t.boundingBox.min,t.boundingBox.max,n),i=po),ie(c,r)){const u=e.geometry,f=u.index,h=u.attributes.position,d=t.index,y=t.attributes.position,_=re(s,a),p=fe(c,r);if($t.copy(n).invert(),t.boundsTree)return G(s,o,Nn),Nn.matrix.copy($t),Nn.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>Nn.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(n),g.b.applyMatrix4(n),g.c.applyMatrix4(n),g.needsUpdate=!0;for(let b=_,w=p+_;b<w;b++)if(X(St,3*e.resolveTriangleIndex(b),f,h),St.needsUpdate=!0,g.intersectsTriangle(St))return!0;return!1}});for(let m=_,g=p+_;m<g;m++){const b=e.resolveTriangleIndex(m);X(At,3*b,f,h),At.a.applyMatrix4($t),At.b.applyMatrix4($t),At.c.applyMatrix4($t),At.needsUpdate=!0;for(let w=0,x=d.count;w<x;w+=3)if(X(St,w,d,y),St.needsUpdate=!0,At.intersectsTriangle(St))return!0}}else{const u=s+8,f=a[s+6];return G(u,o,Dn),!!(i.intersectsBox(Dn)&&ps(u,e,t,n,i)||(G(f,o,Dn),i.intersectsBox(Dn)&&ps(f,e,t,n,i)))}}const kn=new W,Pi=new Q,Wt=new Q,ru=new P,au=new P,cu=new P,lu=new P;function uu(s,e,t,n={},i={},o=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Pi.set(e.boundingBox.min,e.boundingBox.max,t),Pi.needsUpdate=!0;const a=s.geometry,c=a.attributes.position,l=a.index,u=e.attributes.position,f=e.index,h=pe.getPrimitive(),d=pe.getPrimitive();let y=ru,_=au,p=null,m=null;i&&(p=cu,m=lu);let g=1/0,b=null,w=null;return kn.copy(t).invert(),Wt.matrix.copy(kn),s.shapecast({boundsTraverseOrder:x=>Pi.distanceToBox(x),intersectsBounds:(x,A,T)=>T<g&&T<r?(A&&(Wt.min.copy(x.min),Wt.max.copy(x.max),Wt.needsUpdate=!0),!0):!1,intersectsRange:(x,A)=>{if(e.boundsTree){const T=e.boundsTree;return T.shapecast({boundsTraverseOrder:S=>Wt.distanceToBox(S),intersectsBounds:(S,E,R)=>R<g&&R<r,intersectsRange:(S,E)=>{for(let R=S,I=S+E;R<I;R++){const C=T.resolveTriangleIndex(R);X(d,3*C,f,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let M=x,O=x+A;M<O;M++){const D=s.resolveTriangleIndex(M);X(h,3*D,l,c),h.needsUpdate=!0;const k=h.distanceToTriangle(d,y,p);if(k<g&&(_.copy(y),m&&m.copy(p),g=k,b=M,w=R),k<o)return!0}}}})}else{const T=Ht(e);for(let S=0,E=T;S<E;S++){X(d,3*S,f,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let R=x,I=x+A;R<I;R++){const C=s.resolveTriangleIndex(R);X(h,3*C,l,c),h.needsUpdate=!0;const M=h.distanceToTriangle(d,y,p);if(M<g&&(_.copy(y),m&&m.copy(p),g=M,b=R,w=S),M<o)return!0}}}}}),pe.releasePrimitive(h),pe.releasePrimitive(d),g===1/0?null:(n.point?n.point.copy(_):n.point=_.clone(),n.distance=g,n.faceIndex=b,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(kn),_.applyMatrix4(kn),i.distance=_.sub(i.point).length(),i.faceIndex=w),n)}function fu(){return typeof SharedArrayBuffer<"u"}const ln=new z.constructor,oi=new z.constructor,Ve=new Es(()=>new xe),Et=new xe,Lt=new xe,Ri=new xe,Mi=new xe;let Ii=!1;function hu(s,e,t,n){if(Ii)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Ii=!0;const i=s._roots,o=e._roots;let r,a=0,c=0;const l=new W().copy(t).invert();for(let u=0,f=i.length;u<f;u++){ln.setBuffer(i[u]),c=0;const h=Ve.getPrimitive();G(0,ln.float32Array,h),h.applyMatrix4(l);for(let d=0,y=o.length;d<y&&(oi.setBuffer(o[d]),r=ye(0,0,t,l,n,a,c,0,0,h),oi.clearBuffer(),c+=o[d].length,!r);d++);if(Ve.releasePrimitive(h),ln.clearBuffer(),a+=i[u].length,r)break}return Ii=!1,r}function ye(s,e,t,n,i,o=0,r=0,a=0,c=0,l=null,u=!1){let f,h;u?(f=oi,h=ln):(f=ln,h=oi);const d=f.float32Array,y=f.uint32Array,_=f.uint16Array,p=h.float32Array,m=h.uint32Array,g=h.uint16Array,b=s*2,w=e*2,x=ie(b,_),A=ie(w,g);let T=!1;if(A&&x)u?T=i(re(e,m),fe(e*2,g),re(s,y),fe(s*2,_),c,r+e,a,o+s):T=i(re(s,y),fe(s*2,_),re(e,m),fe(e*2,g),a,o+s,c,r+e);else if(A){const S=Ve.getPrimitive();G(e,p,S),S.applyMatrix4(t);const E=he(s),R=de(s,y);G(E,d,Et),G(R,d,Lt);const I=S.intersectsBox(Et),C=S.intersectsBox(Lt);T=I&&ye(e,E,n,t,i,r,o,c,a+1,S,!u)||C&&ye(e,R,n,t,i,r,o,c,a+1,S,!u),Ve.releasePrimitive(S)}else{const S=he(e),E=de(e,m);G(S,p,Ri),G(E,p,Mi);const R=l.intersectsBox(Ri),I=l.intersectsBox(Mi);if(R&&I)T=ye(s,S,t,n,i,o,r,a,c+1,l,u)||ye(s,E,t,n,i,o,r,a,c+1,l,u);else if(R)if(x)T=ye(s,S,t,n,i,o,r,a,c+1,l,u);else{const C=Ve.getPrimitive();C.copy(Ri).applyMatrix4(t);const M=he(s),O=de(s,y);G(M,d,Et),G(O,d,Lt);const D=C.intersectsBox(Et),k=C.intersectsBox(Lt);T=D&&ye(S,M,n,t,i,r,o,c,a+1,C,!u)||k&&ye(S,O,n,t,i,r,o,c,a+1,C,!u),Ve.releasePrimitive(C)}else if(I)if(x)T=ye(s,E,t,n,i,o,r,a,c+1,l,u);else{const C=Ve.getPrimitive();C.copy(Mi).applyMatrix4(t);const M=he(s),O=de(s,y);G(M,d,Et),G(O,d,Lt);const D=C.intersectsBox(Et),k=C.intersectsBox(Lt);T=D&&ye(E,M,n,t,i,r,o,c,a+1,C,!u)||k&&ye(E,O,n,t,i,r,o,c,a+1,C,!u),Ve.releasePrimitive(C)}}return T}const Bn=new Q,mo=new xe,du={strategy:dr,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Ls{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,i=e._roots,o=e._indirectBuffer,r=n.getIndex();let a;return t.cloneBuffers?a={roots:i.map(c=>c.slice()),index:r?r.array.slice():null,indirectBuffer:o?o.slice():null}:a={roots:i,index:r?r.array:null,indirectBuffer:o},a}static deserialize(e,t,n={}){n={setIndex:!0,indirect:!!e.indirectBuffer,...n};const{index:i,roots:o,indirectBuffer:r}=e,a=new Ls(t,{...n,[vi]:!0});if(a._roots=o,a._indirectBuffer=r||null,n.setIndex){const c=t.getIndex();if(c===null){const l=new oe(e.index,1,!1);t.setIndex(l)}else c.array!==i&&(c.array.set(i),c.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...du,[vi]:!1},t),t.useSharedArrayBuffer&&!fu())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[vi]||(Cl(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new xe))),this.resolveTriangleIndex=t.indirect?n=>this._indirectBuffer[n]:n=>n}refit(e=null){return(this.indirect?tu:Vl)(this,e)}traverse(e,t=0){const n=this._roots[t],i=new Uint32Array(n),o=new Uint16Array(n);r(0);function r(a,c=0){const l=a*2,u=o[l+15]===ui;if(u){const f=i[a+6],h=o[l+14];e(c,u,new Float32Array(n,a*4,6),f,h)}else{const f=a+cn/4,h=i[a+6],d=i[a+7];e(c,u,new Float32Array(n,a*4,6),d)||(r(f,c+1),r(h,c+1))}}}raycast(e,t=Wi,n=0,i=1/0){const o=this._roots,r=this.geometry,a=[],c=t.isMaterial,l=Array.isArray(t),u=r.groups,f=c?t.side:t,h=this.indirect?nu:Kl;for(let d=0,y=o.length;d<y;d++){const _=l?t[u[d].materialIndex].side:f,p=a.length;if(h(this,d,_,e,a,n,i),l){const m=u[d].materialIndex;for(let g=p,b=a.length;g<b;g++)a[g].face.materialIndex=m}}return a}raycastFirst(e,t=Wi,n=0,i=1/0){const o=this._roots,r=this.geometry,a=t.isMaterial,c=Array.isArray(t);let l=null;const u=r.groups,f=a?t.side:t,h=this.indirect?su:$l;for(let d=0,y=o.length;d<y;d++){const _=c?t[u[d].materialIndex].side:f,p=h(this,d,_,e,n,i);p!=null&&(l==null||p.distance<l.distance)&&(l=p,c&&(p.face.materialIndex=u[d].materialIndex))}return l}intersectsGeometry(e,t){let n=!1;const i=this._roots,o=this.indirect?ou:Wl;for(let r=0,a=i.length;r<a&&(n=o(this,r,e,t),!n);r++);return n}shapecast(e){const t=pe.getPrimitive(),n=this.indirect?Xl:Ul;let{boundsTraverseOrder:i,intersectsBounds:o,intersectsRange:r,intersectsTriangle:a}=e;if(r&&a){const f=r;r=(h,d,y,_,p)=>f(h,d,y,_,p)?!0:n(h,d,this,a,y,_,t)}else r||(a?r=(f,h,d,y)=>n(f,h,this,a,d,y,t):r=(f,h,d)=>d);let c=!1,l=0;const u=this._roots;for(let f=0,h=u.length;f<h;f++){const d=u[f];if(c=Dl(this,f,o,r,i,l),c)break;l+=d.byteLength}return pe.releasePrimitive(t),c}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:o}=n;const r=pe.getPrimitive(),a=this.geometry.index,c=this.geometry.attributes.position,l=this.indirect?y=>{const _=this.resolveTriangleIndex(y);X(r,_*3,a,c)}:y=>{X(r,y*3,a,c)},u=pe.getPrimitive(),f=e.geometry.index,h=e.geometry.attributes.position,d=e.indirect?y=>{const _=e.resolveTriangleIndex(y);X(u,_*3,f,h)}:y=>{X(u,y*3,f,h)};if(o){const y=(_,p,m,g,b,w,x,A)=>{for(let T=m,S=m+g;T<S;T++){d(T),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let E=_,R=_+p;E<R;E++)if(l(E),r.needsUpdate=!0,o(r,u,E,T,b,w,x,A))return!0}return!1};if(i){const _=i;i=function(p,m,g,b,w,x,A,T){return _(p,m,g,b,w,x,A,T)?!0:y(p,m,g,b,w,x,A,T)}}else i=y}return hu(this,e,t,i)}intersectsBox(e,t){return Bn.set(e.min,e.max,t),Bn.needsUpdate=!0,this.shapecast({intersectsBounds:n=>Bn.intersectsBox(n),intersectsTriangle:n=>Bn.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},i={},o=0,r=1/0){return(this.indirect?uu:eu)(this,e,t,n,i,o,r)}closestPointToPoint(e,t={},n=0,i=1/0){return Nl(this,e,t,n,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(n=>{G(0,new Float32Array(n),mo),e.union(mo)}),e}}const br=1e-6,pu=br*.5,wr=Math.pow(10,-Math.log10(br)),mu=pu*wr;function Le(s){return~~(s*wr+mu)}function _u(s){return`${Le(s.x)},${Le(s.y)}`}function _o(s){return`${Le(s.x)},${Le(s.y)},${Le(s.z)}`}function gu(s){return`${Le(s.x)},${Le(s.y)},${Le(s.z)},${Le(s.w)}`}function yu(s,e,t){t.direction.subVectors(e,s).normalize();const n=s.dot(t.direction);return t.origin.copy(s).addScaledVector(t.direction,-n),t}function xr(){return typeof SharedArrayBuffer<"u"}function bu(s){if(s.buffer instanceof SharedArrayBuffer)return s;const e=s.constructor,t=s.buffer,n=new SharedArrayBuffer(t.byteLength),i=new Uint8Array(t);return new Uint8Array(n).set(i,0),new e(n)}function wu(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function xu(s,e){if(!s.index){const t=s.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=wu(t,n);s.setIndex(new oe(i,1));for(let o=0;o<t;o++)i[o]=o}}function Tu(s){return s.index?s.index.count:s.attributes.position.count}function Cs(s){return Tu(s)/3}const vu=1e-8,Au=new P;function Su(s){return~~(s/3)}function Eu(s){return s%3}function go(s,e){return s.start-e.start}function yo(s,e){return Au.subVectors(e,s.origin).dot(s.direction)}function Lu(s,e,t,n=vu){s.sort(go),e.sort(go);for(let a=0;a<s.length;a++){const c=s[a];for(let l=0;l<e.length;l++){const u=e[l];if(!(u.start>c.end)){if(c.end<u.start||u.end<c.start)continue;if(c.start<=u.start&&c.end>=u.end)o(u.end,c.end)||s.splice(a+1,0,{start:u.end,end:c.end,index:c.index}),c.end=u.start,u.start=0,u.end=0;else if(c.start>=u.start&&c.end<=u.end)o(c.end,u.end)||e.splice(l+1,0,{start:c.end,end:u.end,index:u.index}),u.end=c.start,c.start=0,c.end=0;else if(c.start<=u.start&&c.end<=u.end){const f=c.end;c.end=u.start,u.start=f}else if(c.start>=u.start&&c.end>=u.end){const f=u.end;u.end=c.start,c.start=f}else throw new Error}if(t.has(c.index)||t.set(c.index,[]),t.has(u.index)||t.set(u.index,[]),t.get(c.index).push(u.index),t.get(u.index).push(c.index),r(u)&&(e.splice(l,1),l--),r(c)){s.splice(a,1),a--;break}}}i(s),i(e);function i(a){for(let c=0;c<a.length;c++)r(a[c])&&(a.splice(c,1),c--)}function o(a,c){return Math.abs(c-a)<n}function r(a){return Math.abs(a.end-a.start)<n}}const bo=1e-5,wo=1e-4;class Cu{constructor(){this._rays=[]}addRay(e){this._rays.push(e)}findClosestRay(e){const t=this._rays,n=e.clone();n.direction.multiplyScalar(-1);let i=1/0,o=null;for(let c=0,l=t.length;c<l;c++){const u=t[c];if(r(u,e)&&r(u,n))continue;const f=a(u,e),h=a(u,n),d=Math.min(f,h);d<i&&(i=d,o=u)}return o;function r(c,l){const u=c.origin.distanceTo(l.origin)>bo;return c.direction.angleTo(l.direction)>wo||u}function a(c,l){const u=c.origin.distanceTo(l.origin),f=c.direction.angleTo(l.direction);return u/bo+f/wo}}}const Oi=new P,Di=new P,Fn=new _s;function Pu(s,e,t){const n=s.attributes,i=s.index,o=n.position,r=new Map,a=new Map,c=Array.from(e),l=new Cu;for(let u=0,f=c.length;u<f;u++){const h=c[u],d=Su(h),y=Eu(h);let _=3*d+y,p=3*d+(y+1)%3;i&&(_=i.getX(_),p=i.getX(p)),Oi.fromBufferAttribute(o,_),Di.fromBufferAttribute(o,p),yu(Oi,Di,Fn);let m,g=l.findClosestRay(Fn);g===null&&(g=Fn.clone(),l.addRay(g)),a.has(g)||a.set(g,{forward:[],reverse:[],ray:g}),m=a.get(g);let b=yo(g,Oi),w=yo(g,Di);b>w&&([b,w]=[w,b]),Fn.direction.dot(g.direction)<0?m.reverse.push({start:b,end:w,index:h}):m.forward.push({start:b,end:w,index:h})}return a.forEach(({forward:u,reverse:f},h)=>{Lu(u,f,r,t),u.length===0&&f.length===0&&a.delete(h)}),{disjointConnectivityMap:r,fragmentMap:a}}const Ru=new H,Ni=new P,Mu=new yt,ki=["","",""];class Iu{constructor(e=null){this.data=null,this.disjointConnections=null,this.unmatchedDisjointEdges=null,this.unmatchedEdges=-1,this.matchedEdges=-1,this.useDrawRange=!0,this.useAllAttributes=!1,this.matchDisjointEdges=!1,this.degenerateEpsilon=1e-8,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[e*3+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[e*3+t];return n===-1?-1:n%3}getDisjointSiblingTriangleIndices(e,t){const n=e*3+t,i=this.disjointConnections.get(n);return i?i.map(o=>~~(o/3)):[]}getDisjointSiblingEdgeIndices(e,t){const n=e*3+t,i=this.disjointConnections.get(n);return i?i.map(o=>o%3):[]}isFullyConnected(){return this.unmatchedEdges===0}updateFrom(e){const{useAllAttributes:t,useDrawRange:n,matchDisjointEdges:i,degenerateEpsilon:o}=this,r=t?b:g,a=new Map,{attributes:c}=e,l=t?Object.keys(c):null,u=e.index,f=c.position;let h=Cs(e);const d=h;let y=0;n&&(y=e.drawRange.start,e.drawRange.count!==1/0&&(h=~~(e.drawRange.count/3)));let _=this.data;(!_||_.length<3*d)&&(_=new Int32Array(3*d)),_.fill(-1);let p=0,m=new Set;for(let w=y,x=h*3+y;w<x;w+=3){const A=w;for(let T=0;T<3;T++){let S=A+T;u&&(S=u.getX(S)),ki[T]=r(S)}for(let T=0;T<3;T++){const S=(T+1)%3,E=ki[T],R=ki[S],I=`${R}_${E}`;if(a.has(I)){const C=A+T,M=a.get(I);_[C]=M,_[M]=C,a.delete(I),p+=2,m.delete(M)}else{const C=`${E}_${R}`,M=A+T;a.set(C,M),m.add(M)}}}if(i){const{fragmentMap:w,disjointConnectivityMap:x}=Pu(e,m,o);m.clear(),w.forEach(({forward:A,reverse:T})=>{A.forEach(({index:S})=>m.add(S)),T.forEach(({index:S})=>m.add(S))}),this.unmatchedDisjointEdges=w,this.disjointConnections=x,p=h*3-m.size}this.matchedEdges=p,this.unmatchedEdges=m.size,this.data=_;function g(w){return Ni.fromBufferAttribute(f,w),_o(Ni)}function b(w){let x="";for(let A=0,T=l.length;A<T;A++){const S=c[l[A]];let E;switch(S.itemSize){case 1:E=Le(S.getX(w));break;case 2:E=_u(Ru.fromBufferAttribute(S,w));break;case 3:E=_o(Ni.fromBufferAttribute(S,w));break;case 4:E=gu(Mu.fromBufferAttribute(S,w));break}x!==""&&(x+="|"),x+=E}return x}}}class xo extends gt{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new W,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,i=t.elements;for(let o=0;o<16;o++)if(n[o]!==i[o])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes,n=xr();if(n)for(const i in t){const o=t[i];if(o.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");o.array=bu(o.array)}if(e.boundsTree||(xu(e,{useSharedArrayBuffer:n}),e.boundsTree=new Ls(e,{maxLeafTris:3,indirect:!0,useSharedArrayBuffer:n})),e.halfEdges||(e.halfEdges=new Iu(e)),!e.groupIndices){const i=Cs(e),o=new Uint16Array(i),r=e.groups;for(let a=0,c=r.length;a<c;a++){const{start:l,count:u}=r[a];for(let f=l/3,h=(l+u)/3;f<h;f++)o[f]=a}e.groupIndices=o}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}const Ou=1e-14,Bi=new P,To=new P,vo=new P;function Ge(s,e=Ou){Bi.subVectors(s.b,s.a),To.subVectors(s.c,s.a),vo.subVectors(s.b,s.c);const t=Bi.angleTo(To),n=Bi.angleTo(vo),i=Math.PI-t-n;return Math.abs(t)<e||Math.abs(n)<e||Math.abs(i)<e||s.a.distanceToSquared(s.b)<e||s.a.distanceToSquared(s.c)<e||s.b.distanceToSquared(s.c)<e}const Fi=1e-10,qt=1e-10,Du=1e-10,Pe=new _e,j=new _e,Re=new P,Hi=new P,Ao=new P,Hn=new ci,zi=new ge;class Nu{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new ne),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class ku{constructor(){this.trianglePool=new Nu,this.triangles=[],this.normal=new P,this.coplanarTriangleUsed=!1}initialize(e){this.reset();const{triangles:t,trianglePool:n,normal:i}=this;if(Array.isArray(e))for(let o=0,r=e.length;o<r;o++){const a=e[o];if(o===0)a.getNormal(i);else if(Math.abs(1-a.getNormal(Re).dot(i))>Fi)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const c=n.getTriangle();c.copy(a),t.push(c)}else{e.getNormal(i);const o=n.getTriangle();o.copy(e),t.push(o)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getNormal(Hi).normalize(),Math.abs(1-Math.abs(Hi.dot(t)))<Du){this.coplanarTriangleUsed=!0;for(let o=0,r=n.length;o<r;o++){const a=n[o];a.coplanarCount=0}const i=[e.a,e.b,e.c];for(let o=0;o<3;o++){const r=(o+1)%3,a=i[o],c=i[r];Re.subVectors(c,a).normalize(),Ao.crossVectors(Hi,Re),Hn.setFromNormalAndCoplanarPoint(Ao,a),this.splitByPlane(Hn,e)}}else e.getPlane(Hn),this.splitByPlane(Hn,e)}splitByPlane(e,t){const{triangles:n,trianglePool:i}=this;zi.copy(t),zi.needsUpdate=!0;for(let o=0,r=n.length;o<r;o++){const a=n[o];if(!zi.intersectsTriangle(a,Pe,!0))continue;const{a:c,b:l,c:u}=a;let f=0,h=-1,d=!1,y=[],_=[];const p=[c,l,u];for(let m=0;m<3;m++){const g=(m+1)%3;Pe.start.copy(p[m]),Pe.end.copy(p[g]);const b=e.distanceToPoint(Pe.start),w=e.distanceToPoint(Pe.end);if(Math.abs(b)<qt&&Math.abs(w)<qt){d=!0;break}if(b>0?y.push(m):_.push(m),Math.abs(b)<qt)continue;let x=!!e.intersectLine(Pe,Re);!x&&Math.abs(w)<qt&&(Re.copy(Pe.end),x=!0),x&&!(Re.distanceTo(Pe.start)<Fi)&&(Re.distanceTo(Pe.end)<Fi&&(h=m),f===0?j.start.copy(Re):j.end.copy(Re),f++)}if(!d&&f===2&&j.distance()>qt)if(h!==-1){h=(h+1)%3;let m=0;m===h&&(m=(m+1)%3);let g=m+1;g===h&&(g=(g+1)%3);const b=i.getTriangle();b.a.copy(p[g]),b.b.copy(j.end),b.c.copy(j.start),Ge(b)||n.push(b),a.a.copy(p[m]),a.b.copy(j.start),a.c.copy(j.end),Ge(a)&&(n.splice(o,1),o--,r--)}else{const m=y.length>=2?_[0]:y[0];if(m===0){let A=j.start;j.start=j.end,j.end=A}const g=(m+1)%3,b=(m+2)%3,w=i.getTriangle(),x=i.getTriangle();p[g].distanceToSquared(j.start)<p[b].distanceToSquared(j.end)?(w.a.copy(p[g]),w.b.copy(j.start),w.c.copy(j.end),x.a.copy(p[g]),x.b.copy(p[b]),x.c.copy(j.start)):(w.a.copy(p[b]),w.b.copy(j.start),w.c.copy(j.end),x.a.copy(p[g]),x.b.copy(p[b]),x.c.copy(j.end)),a.a.copy(p[m]),a.b.copy(j.end),a.c.copy(j.start),Ge(w)||n.push(w),Ge(x)||n.push(x),Ge(a)&&(n.splice(o,1),o--,r--)}else f===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0,this.trianglePool.clear(),this.coplanarTriangleUsed=!1}}function Bu(s){return s=~~s,s+4-s%4}class So{constructor(e,t=500){this.expansionFactor=1.5,this.type=e,this.length=0,this.array=null,this.setSize(t)}setType(e){if(this.length!==0)throw new Error("TypeBackedArray: Cannot change the type while there is used data in the buffer.");const t=this.array.buffer;this.array=new e(t),this.type=e}setSize(e){if(this.array&&e===this.array.length)return;const t=this.type,n=xr()?SharedArrayBuffer:ArrayBuffer,i=new t(new n(Bu(e*t.BYTES_PER_ELEMENT)));this.array&&i.set(this.array,0),this.array=i}expand(){const{array:e,expansionFactor:t}=this;this.setSize(e.length*t)}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let i=0,o=e.length;i<o;i++)t[n+i]=e[i];this.length+=e.length}clear(){this.length=0}}class Fu{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getItemSize(e){return this.groupAttributes[0][e].itemSize}getNormalized(e){return this.groupAttributes[0][e].normalized}getCount(e){if(this.groupCount<=e)return 0;const t=this.getGroupAttrArray("position",e);return t.length/t.itemSize}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let i=0;for(let o=0;o<t;o++){const r=n[o];i+=r[e].length}return i}getGroupAttrSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const i={};t.push(i);for(const o in n){const r=n[o],a=new So(r.type);a.itemSize=r.itemSize,a.normalized=r.normalized,i[o]=a}}return t[e]}getGroupAttrArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupAttrSet(t)[e]}initializeArray(e,t,n,i){const{groupAttributes:o}=this,a=o[0][e];if(a){if(a.type!==t)for(let c=0,l=o.length;c<l;c++){const u=o[c][e];u.setType(t),u.itemSize=n,u.normalized=i}}else for(let c=0,l=o.length;c<l;c++){const u=new So(t);u.itemSize=n,u.normalized=i,o[c][e]=u}}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[],this.groupCount=0}}class Eo{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:i}=this;n[e]||(n[e]=[],i.push(e)),n[e].push(t)}}const Hu=0,zu=1,Uu=2,Vu=3,Gu=4,Tr=5,vr=6,ue=new _s,Lo=new W,Z=new ne,Me=new P,Co=new yt,Po=new yt,Ro=new yt,Ui=new yt,zn=new yt,Un=new yt,Mo=new _e,Vi=new P,Gi=1e-8,ju=1e-15,ht=-1,dt=1,Zn=-2,Jn=2,un=0,at=1,Ps=2,Xu=1e-14;let Qn=null;function Io(s){Qn=s}function Ar(s,e){s.getMidpoint(ue.origin),s.getNormal(ue.direction);const t=e.raycastFirst(ue,Ft);return!!(t&&ue.direction.dot(t.face.normal)>0)?ht:dt}function Ku(s,e){function t(){return Math.random()-.5}s.getNormal(Vi),ue.direction.copy(Vi),s.getMidpoint(ue.origin);const n=3;let i=0,o=1/0;for(let r=0;r<n;r++){ue.direction.x+=t()*Gi,ue.direction.y+=t()*Gi,ue.direction.z+=t()*Gi,ue.direction.multiplyScalar(-1);const a=e.raycastFirst(ue,Ft);if(!!(a&&ue.direction.dot(a.face.normal)>0)&&i++,a!==null&&(o=Math.min(o,a.distance)),o<=ju)return a.face.normal.dot(Vi)>0?Jn:Zn;if(i/n>.5||(r-i+1)/n>.5)break}return i/n>.5?ht:dt}function Yu(s,e){const t=new Eo,n=new Eo;return Lo.copy(s.matrixWorld).invert().multiply(e.matrixWorld),s.geometry.boundsTree.bvhcast(e.geometry.boundsTree,Lo,{intersectsTriangles(i,o,r,a){if(!Ge(i)&&!Ge(o)){let c=i.intersectsTriangle(o,Mo,!0);if(!c){const l=i.plane,u=o.plane,f=l.normal,h=u.normal;f.dot(h)===1&&Math.abs(l.constant-u.constant)<Xu&&(c=!0)}if(c){let l=s.geometry.boundsTree.resolveTriangleIndex(r),u=e.geometry.boundsTree.resolveTriangleIndex(a);t.add(l,u),n.add(u,l),Qn&&(Qn.addEdge(Mo),Qn.addIntersectingTriangles(r,i,a,o))}}return!1}}),{aIntersections:t,bIntersections:n}}function $u(s,e,t,n,i,o,r=!1){const a=t.attributes,c=t.index,l=s*3,u=c.getX(l+0),f=c.getX(l+1),h=c.getX(l+2);for(const d in o){const y=a[d],_=o[d];if(!(d in a))throw new Error(`CSG Operations: Attribute ${d} not available on geometry.`);const p=y.itemSize;d==="position"?(Z.a.fromBufferAttribute(y,u).applyMatrix4(n),Z.b.fromBufferAttribute(y,f).applyMatrix4(n),Z.c.fromBufferAttribute(y,h).applyMatrix4(n),ji(Z.a,Z.b,Z.c,e,3,_,r)):d==="normal"?(Z.a.fromBufferAttribute(y,u).applyNormalMatrix(i),Z.b.fromBufferAttribute(y,f).applyNormalMatrix(i),Z.c.fromBufferAttribute(y,h).applyNormalMatrix(i),r&&(Z.a.multiplyScalar(-1),Z.b.multiplyScalar(-1),Z.c.multiplyScalar(-1)),ji(Z.a,Z.b,Z.c,e,3,_,r,!0)):(Co.fromBufferAttribute(y,u),Po.fromBufferAttribute(y,f),Ro.fromBufferAttribute(y,h),ji(Co,Po,Ro,e,p,_,r))}}function Wu(s,e,t,n,i,o,r,a=!1){Xi(s,n,i,o,r,a),Xi(a?t:e,n,i,o,r,a),Xi(a?e:t,n,i,o,r,a)}function Sr(s,e,t=!1){switch(s){case Hu:if(e===dt||e===Jn&&!t)return at;break;case zu:if(t){if(e===ht)return un}else if(e===dt||e===Zn)return at;break;case Uu:if(t){if(e===dt||e===Zn)return at}else if(e===ht)return un;break;case Gu:if(e===ht)return un;if(e===dt)return at;break;case Vu:if(e===ht||e===Jn&&!t)return at;break;case Tr:if(!t&&(e===dt||e===Zn))return at;break;case vr:if(!t&&(e===ht||e===Jn))return at;break;default:throw new Error(`Unrecognized CSG operation enum "${s}".`)}return Ps}function ji(s,e,t,n,i,o,r=!1,a=!1){const c=l=>{o.push(l.x),i>1&&o.push(l.y),i>2&&o.push(l.z),i>3&&o.push(l.w)};Ui.set(0,0,0,0).addScaledVector(s,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),zn.set(0,0,0,0).addScaledVector(s,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),Un.set(0,0,0,0).addScaledVector(s,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),a&&(Ui.normalize(),zn.normalize(),Un.normalize()),c(Ui),r?(c(Un),c(zn)):(c(zn),c(Un))}function Xi(s,e,t,n,i,o=!1){for(const r in i){const a=e[r],c=i[r];if(!(r in e))throw new Error(`CSG Operations: Attribute ${r} no available on geometry.`);const l=a.itemSize;r==="position"?(Me.fromBufferAttribute(a,s).applyMatrix4(t),c.push(Me.x,Me.y,Me.z)):r==="normal"?(Me.fromBufferAttribute(a,s).applyNormalMatrix(n),o&&Me.multiplyScalar(-1),c.push(Me.x,Me.y,Me.z)):(c.push(a.getX(s)),l>1&&c.push(a.getY(s)),l>2&&c.push(a.getZ(s)),l>3&&c.push(a.getW(s)))}}class qu{constructor(e){this.triangle=new ne().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new ne().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class Oo{constructor(){this.data={}}addTriangleIntersection(e,t,n,i){const{data:o}=this;o[e]||(o[e]=new qu(t)),o[e].addTriangle(n,i)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const i in t)n.push(t[i].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,i=new Set,o=[],r=a=>{if(n[a])if(t!==null)n[a].intersects[t]&&o.push(n[a].intersects[t]);else{const c=n[a].intersects;for(const l in c)i.has(l)||(i.add(l),o.push(c[l]))}};if(e!==null)r(e);else for(const a in n)r(a);return o}reset(){this.data={}}}class Zu{constructor(){this.enabled=!1,this.triangleIntersectsA=new Oo,this.triangleIntersectsB=new Oo,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,i){const{triangleIntersectsA:o,triangleIntersectsB:r}=this;o.addTriangleIntersection(e,t,n,i),r.addTriangleIntersection(n,i,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}init(){this.enabled&&(this.reset(),Io(this))}complete(){this.enabled&&Io(null)}}const $e=new W,ri=new Yo,ct=new ne,Vn=new ne,He=new ne,Gn=new ne,we=[],mt=[];function Ju(s){for(const e of s)return e}function Qu(s,e,t,n,i,o={}){const{useGroups:r=!0}=o,{aIntersections:a,bIntersections:c}=Yu(s,e),l=[];let u=null,f;return f=r?0:-1,Do(s,e,a,t,!1,n,i,f),No(s,e,a,t,!1,i,f),t.findIndex(d=>d!==vr&&d!==Tr)!==-1&&(f=r?s.geometry.groups.length||1:-1,Do(e,s,c,t,!0,n,i,f),No(e,s,c,t,!0,i,f)),we.length=0,mt.length=0,{groups:l,materials:u}}function Do(s,e,t,n,i,o,r,a=0){const c=s.matrixWorld.determinant()<0;$e.copy(e.matrixWorld).invert().multiply(s.matrixWorld),ri.getNormalMatrix(s.matrixWorld).multiplyScalar(c?-1:1);const l=s.geometry.groupIndices,u=s.geometry.index,f=s.geometry.attributes.position,h=e.geometry.boundsTree,d=e.geometry.index,y=e.geometry.attributes.position,_=t.ids,p=t.intersectionSet;for(let m=0,g=_.length;m<g;m++){const b=_[m],w=a===-1?0:l[b]+a,x=3*b,A=u.getX(x+0),T=u.getX(x+1),S=u.getX(x+2);ct.a.fromBufferAttribute(f,A).applyMatrix4($e),ct.b.fromBufferAttribute(f,T).applyMatrix4($e),ct.c.fromBufferAttribute(f,S).applyMatrix4($e),o.reset(),o.initialize(ct);const E=p[b];for(let I=0,C=E.length;I<C;I++){const M=3*E[I],O=d.getX(M+0),D=d.getX(M+1),k=d.getX(M+2);Vn.a.fromBufferAttribute(y,O),Vn.b.fromBufferAttribute(y,D),Vn.c.fromBufferAttribute(y,k),o.splitByTriangle(Vn)}const R=o.triangles;for(let I=0,C=R.length;I<C;I++){const M=R[I],O=o.coplanarTriangleUsed?Ku(M,h):Ar(M,h);we.length=0,mt.length=0;for(let D=0,k=n.length;D<k;D++){const q=Sr(n[D],O,i);q!==Ps&&(mt.push(q),we.push(r[D].getGroupAttrSet(w)))}if(we.length!==0){ct.getBarycoord(M.a,Gn.a),ct.getBarycoord(M.b,Gn.b),ct.getBarycoord(M.c,Gn.c);for(let D=0,k=we.length;D<k;D++){const q=we[D],nt=mt[D]===un;$u(b,Gn,s.geometry,s.matrixWorld,ri,q,c!==nt)}}}}return _.length}function No(s,e,t,n,i,o,r=0){const a=s.matrixWorld.determinant()<0;$e.copy(e.matrixWorld).invert().multiply(s.matrixWorld),ri.getNormalMatrix(s.matrixWorld).multiplyScalar(a?-1:1);const c=e.geometry.boundsTree,l=s.geometry.groupIndices,u=s.geometry.index,f=s.geometry.attributes,h=f.position,d=[],y=s.geometry.halfEdges,_=new Set,p=Cs(s.geometry);for(let m=0,g=p;m<g;m++)m in t.intersectionSet||_.add(m);for(;_.size>0;){const m=Ju(_);_.delete(m),d.push(m);const g=3*m,b=u.getX(g+0),w=u.getX(g+1),x=u.getX(g+2);He.a.fromBufferAttribute(h,b).applyMatrix4($e),He.b.fromBufferAttribute(h,w).applyMatrix4($e),He.c.fromBufferAttribute(h,x).applyMatrix4($e);const A=Ar(He,c);mt.length=0,we.length=0;for(let T=0,S=n.length;T<S;T++){const E=Sr(n[T],A,i);E!==Ps&&(mt.push(E),we.push(o[T]))}for(;d.length>0;){const T=d.pop();for(let S=0;S<3;S++){const E=y.getSiblingTriangleIndex(T,S);E!==-1&&_.has(E)&&(d.push(E),_.delete(E))}if(we.length!==0){const S=3*T,E=u.getX(S+0),R=u.getX(S+1),I=u.getX(S+2),C=r===-1?0:l[T]+r;if(He.a.fromBufferAttribute(h,E),He.b.fromBufferAttribute(h,R),He.c.fromBufferAttribute(h,I),!Ge(He))for(let M=0,O=we.length;M<O;M++){const D=mt[M],k=we[M].getGroupAttrSet(C),q=D===un;Wu(E,R,I,f,s.matrixWorld,ri,k,q!==a)}}}}}function ef(s){for(let e=0;e<s.length-1;e++){const t=s[e],n=s[e+1];if(t.materialIndex===n.materialIndex){const i=t.start,o=n.start+n.count;n.start=i,n.count=o-i,s.splice(e,1),e--}}}function tf(s,e,t,n){t.clear();const i=s.attributes;for(let o=0,r=n.length;o<r;o++){const a=n[o],c=i[a];t.initializeArray(a,c.array.constructor,c.itemSize,c.normalized)}for(const o in t.attributes)n.includes(o)||t.delete(o);for(const o in e.attributes)n.includes(o)||(e.deleteAttribute(o),e.dispose())}function nf(s,e,t){let n=!1,i=-1;const o=s.attributes,r=e.groupAttributes[0];for(const c in r){const l=e.getTotalLength(c),u=e.getType(c),f=e.getItemSize(c),h=e.getNormalized(c);let d=o[c];(!d||d.array.length<l)&&(d=new oe(new u(l),f,h),s.setAttribute(c,d),n=!0);let y=0;for(let _=0,p=Math.min(t.length,e.groupCount);_<p;_++){const m=t[_].index,{array:g,type:b,length:w}=e.groupAttributes[m][c],x=new b(g.buffer,0,w);d.array.set(x,y),y+=x.length}d.needsUpdate=!0,i=l/d.itemSize}if(s.index){const c=s.index.array;if(c.length<i)s.index=null,n=!0;else for(let l=0,u=c.length;l<u;l++)c[l]=l}let a=0;s.clearGroups();for(let c=0,l=Math.min(t.length,e.groupCount);c<l;c++){const{index:u,materialIndex:f}=t[c],h=e.getCount(u);h!==0&&(s.addGroup(a,h,f),a+=h)}s.setDrawRange(0,i),s.boundsTree=null,n&&s.dispose()}function ko(s,e){let t=e;return Array.isArray(e)||(t=[],s.forEach(n=>{t[n.materialIndex]=e})),t}class sf{constructor(){this.triangleSplitter=new ku,this.attributeData=[],this.attributes=["position","uv","normal"],this.useGroups=!0,this.consolidateGroups=!0,this.debug=new Zu}getGroupRanges(e){return!this.useGroups||e.groups.length===0?[{start:0,count:1/0,materialIndex:0}]:e.groups.map(t=>({...t}))}evaluate(e,t,n,i=new xo){let o=!0;if(Array.isArray(n)||(n=[n]),Array.isArray(i)||(i=[i],o=!1),i.length!==n.length)throw new Error("Evaluator: operations and target array passed as different sizes.");e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:r,attributeData:a,attributes:c,useGroups:l,consolidateGroups:u,debug:f}=this;for(;a.length<i.length;)a.push(new Fu);i.forEach((m,g)=>{tf(e.geometry,m.geometry,a[g],c)}),f.init(),Qu(e,t,n,r,a,{useGroups:l}),f.complete();const h=this.getGroupRanges(e.geometry),d=ko(h,e.material),y=this.getGroupRanges(t.geometry),_=ko(y,t.material);y.forEach(m=>m.materialIndex+=d.length);let p=[...h,...y].map((m,g)=>({...m,index:g}));if(l){const m=[...d,..._];u&&(p=p.map(b=>{const w=m[b.materialIndex];return b.materialIndex=m.indexOf(w),b}).sort((b,w)=>b.materialIndex-w.materialIndex));const g=[];for(let b=0,w=m.length;b<w;b++){let x=!1;for(let A=0,T=p.length;A<T;A++){const S=p[A];S.materialIndex===b&&(x=!0,S.materialIndex=g.length)}x&&g.push(m[b])}i.forEach(b=>{b.material=g})}else p=[{start:0,count:1/0,index:0,materialIndex:0}],i.forEach(m=>{m.material=d[0]});return i.forEach((m,g)=>{const b=m.geometry;nf(b,a[g],p),u&&ef(b.groups)}),o?i:i[0]}evaluateHierarchy(e,t=new xo){e.updateMatrixWorld(!0);const n=(o,r)=>{const a=o.children;for(let c=0,l=a.length;c<l;c++){const u=a[c];u.isOperationGroup?n(u,r):r(u)}},i=o=>{const r=o.children;let a=!1;for(let l=0,u=r.length;l<u;l++){const f=r[l];a=i(f)||a}const c=o.isDirty();if(c&&o.markUpdated(),a&&!o.isOperationGroup){let l;return n(o,u=>{l?l=this.evaluate(l,u,u.operation):l=this.evaluate(o,u,u.operation)}),o._cachedGeometry=l.geometry,o._cachedMaterials=l.material,!0}else return a||c};return i(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const me=32,Y=32,ze=se.clamp(8,1,me/2),ce=Y+1,Mt=me*Y,J=Mt+1,Ue=1,Se=me*Y*.5*Ue,Ct=new H(.003,500),jn=new H(.008,.2),Xn=new H(.02,.1),Zt=new P(.008,.02,.1),Kn=new H(.03,100);new sf;const lt=[0,0,.12,0,.25,.5,.35,.5,.45,.75,.5,.75,.7,1,1,1],ft=new rr,te=new Float64Array(12);for(let s=0;s<te.length;s++)te[s]=ft.Next();function of(s,e,t){return t=t*t*t*(t*(t*6-15)+10),(1-t)*s+t*e}function rf(s,e){let t=lt[0]*Ct.y-Ct.y;s+=te[0],e+=te[1];let n=ft.Perlin(s*Ct.x,e*Ct.x)*.5+.5;s+=te[2],e+=te[3],n+=(ft.Perlin(s*jn.x,e*jn.x)*.5+.5)*jn.y,s+=te[4],e+=te[5],n+=(ft.Perlin(s*Xn.x,e*Xn.x)*.5+.5)*Xn.y,n/=1+jn.y+Xn.y;for(let o=2;o<lt.length;o+=2)if(n<=lt[o]){t=of(lt[o-1],lt[o+1],se.mapLinear(n,lt[o-2],lt[o],0,1))*Ct.y-Ct.y;break}s+=te[6],e+=te[7];let i=ft.Perlin(s*Zt.x,e*Zt.x)*.5;return s+=te[6],e+=te[7],i=Math.max(i-(ft.Perlin(s*Zt.y,e*Zt.y)*.5+.5)*Zt.z,0),s+=te[10],e+=te[11],t+=(ft.Perlin(s*Kn.x,e*Kn.x)*.5+.5)*i*Kn.y-Kn.y*.3,t}function af(s,e){const t=rf(s,e),n=100,i=Math.max(Math.sqrt((s-Se)**2+(e-Se)**2)-3,0);if(i>=n)return t;const o=Math.pow(1-i/n,1/4);return o*1+(1-o)*t}const ai=new Array(me*me);function cf(){let s=new Float32Array(J*J),e=new Float32Array(s.length*3),t=new Array(Mt*Mt*6);for(let r=0;r<J;r++)for(let a=0;a<J;a++){let c=(r*J+a)*3;e[c]=a,e[c+1]=af(a,r),e[c+2]=r,s[r*J+a]=e[c+1]}for(let r=0;r<Mt;r++)for(let a=0;a<Mt;a++){let c=r*J+a,l=(r*Mt+a)*6;a%2==0&&r%2==0||a%2==1&&r%2==1?(t[l]=c+J+1,t[l+1]=c+1,t[l+2]=c,t[l+3]=c,t[l+4]=c+J,t[l+5]=c+J+1):(t[l]=c+J,t[l+1]=c+1,t[l+2]=c,t[l+3]=c+J,t[l+4]=c+J+1,t[l+5]=c+1)}let n=new Bt;n.setAttribute("position",new oe(e,3)),n.setIndex(t),n.computeVertexNormals();let i=n.getAttribute("normal").array,o=new Array(Y*Y*6);for(let r=0;r<Y;r++)for(let a=0;a<Y;a++){let c=r*ce+a,l=(r*Y+a)*6;a%2==0&&r%2==0||a%2==1&&r%2==1?(o[l]=c+ce+1,o[l+1]=c+1,o[l+2]=c,o[l+3]=c,o[l+4]=c+ce,o[l+5]=c+ce+1):(o[l]=c+ce,o[l+1]=c+1,o[l+2]=c,o[l+3]=c+ce,o[l+4]=c+ce+1,o[l+5]=c+1)}for(let r=0;r<me;r++)for(let a=0;a<me;a++){let c=new Float32Array(ce*ce*3),l=new Float32Array(c.length);for(let p=0;p<ce;p++)for(let m=0;m<ce;m++){let g=(p*ce+m)*3,b=m+a*Y,w=p+r*Y;c[g]=(b-Se)*Ue,c[g+1]=s[w*J+b]*Ue,c[g+2]=(w-Se)*Ue;let x=((r*Y+p)*J+a*Y+m)*3;l[g]=i[x],l[g+1]=i[x+1],l[g+2]=i[x+2]}const u=(a*Y-Se)*Ue,f=((a+1)*Y-Se)*Ue,h=(r*Y-Se)*Ue,d=((r+1)*Y-Se)*Ue;new sa(f-u,100,d-h).translate((u+f)/2,50,(h+d)/2);let y=new Bt;y.setAttribute("position",new oe(c,3)),y.setIndex(o),y.setAttribute("normal",new oe(l,3));let _=new gt;_.geometry=y,_.material=en,_.visible=!1,ai[r*me+a]=_}}let Yn=new Array;function lf(s){let e=se.clamp(Math.round((s.position.z+Se)/Y),ze,me-ze)*me+se.clamp(Math.round((s.position.x+Se)/Y),ze,me-ze);for(let t=0;t<Yn.length;t++)ai[Yn[t]].visible=!1;Yn=new Array;for(let t=-ze;t<ze;t++)for(let n=-ze;n<ze;n++){let i=e+t*me+n;Yn.push(i),ai[i].visible=!0}}class df{parent;scene;resize_observer;renderer;clock;camera;controls;renderJob=0;sunLight;moonLight;hemiLight;stats;gui;guiStatsEl;cameraRight=new P;cameraUp=new P;cameraForward=new P;time=0;timeUniform=new V(this.time);OCEAN=!0;TIME_PASSES=!1;_lightHelper;constructor(e=!0){this.OCEAN=e,this.scene=new oa,this.resize_observer=new ResizeObserver(this.onResize.bind(this)),this.renderer=new ra({antialias:!0}),this.clock=new aa(!0),this.stats=new rn,this.gui=new Ac({autoPlace:!1}),ec(this.scene),this.intiCamera(),this.initRenderer(),this.initScene(),this.initDomHelpers(),this.initSun(),this.hemiLight=new ca(16777215,.4),this.scene.add(this.hemiLight)}intiCamera(){this.camera=new jo(60,1,.1,100),this.camera.near=.3,this.camera.far=4e3,this.camera.position.set(0,1.5,-2);const e=this.controls=new Hc(this.camera,this.renderer.domElement);e.enableDamping=!0,e.dampingFactor=.05,e.screenSpacePanning=!1,e.minDistance=1,e.maxDistance=20,e.target.set(0,1,0)}initRenderer(){this.renderer.autoClearColor=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=la,this.scene.fog=new ua(8900331,.02)}initScene(){if(this.scene.add(this.camera),$c(),this.scene.add(si),ll(this.cameraForward,this.timeUniform),this.OCEAN){this.scene.add(Dt),cf();for(let e of ai)this.scene.add(e)}}initDomHelpers(){this.stats.dom.style.top="unset",this.stats.dom.style.bottom="0",this.gui.domElement.id="game-dat-gui";const e=this.gui.addFolder("Performance");e.add({wireframe:!1},"wireframe").onChange(i=>{this.scene.traverse(o=>{o.type==="Mesh"&&(o.material.wireframe=i)})});let t=document.createElement("li");this.guiStatsEl=document.createElement("div"),this.guiStatsEl.classList.add("gui-stats"),t.appendChild(this.guiStatsEl),e.domElement.querySelector("ul")?.appendChild(t),e.open();const n=this.gui.addFolder("World");n.add(this,"TIME_PASSES").name("Time Passes"),n.open()}onResize(){this.parent&&(this.renderer.setSize(this.parent.clientWidth,this.parent.clientHeight),this.camera.aspect=this.parent.clientWidth/this.parent.clientHeight,this.camera.updateProjectionMatrix())}render(){this.renderJob=requestAnimationFrame(()=>this.render());const e=this.clock.getDelta();this.TIME_PASSES&&(this.time+=e),this.timeUniform.value+=e,Wc(this.camera,this.time),this.OCEAN&&(ul(this.camera),lf(this.camera)),this.updateSunMoon(),this.cameraRight.copy(new P(1,0,0).applyQuaternion(this.camera.quaternion)),this.cameraUp.copy(new P(0,1,0).applyQuaternion(this.camera.quaternion)),this.cameraForward.copy(new P(0,0,-1).applyQuaternion(this.camera.quaternion)),this.controls.update(e),this.updateStats(),this.update(e),this.renderer.render(this.scene,this.camera)}attach(e){this.renderJob&&(cancelAnimationFrame(this.renderJob),this.renderJob=0),this.parent&&(this.parent.removeChild(this.gui.domElement),this.parent.removeChild(this.stats.dom),this.parent.removeChild(this.renderer.domElement),this.resize_observer.unobserve(this.parent)),this.parent=e,e&&(e.appendChild(this.gui.domElement),e.appendChild(this.stats.dom),e.appendChild(this.renderer.domElement),this.resize_observer.observe(e),this.renderer.setPixelRatio(e.ownerDocument.defaultView?.devicePixelRatio??1),this.renderJob=requestAnimationFrame(()=>this.render()))}updateStats(){this.stats.update();const e=this.renderer.info;this.guiStatsEl.textContent=[`${e.memory.geometries}`,`${e.memory.textures}`,`${e.render.calls}c`,`${e.render.triangles}`,`${e.render.lines}l`,`${e.render.points}p`].join(" ")}initSun(){this.sunLight=new Yi(16777215,1),this.moonLight=new Yi(4814236,.8),this.sunLight.castShadow=!0,this.sunLight.shadow.mapSize.width=2048,this.sunLight.shadow.mapSize.height=2048,this.sunLight.shadow.radius=1,this.sunLight.shadow.normalBias=.015;let e=this.sunLight.shadow.camera;e.near=0,e.far=500,this.scene.add(this.sunLight),this.scene.add(this.moonLight)}updateSunMoon(){const e=this.controls.target;this.sunLight.position.copy(e.clone().add(Je.clone().multiplyScalar(200))),this.sunLight.target.position.copy(e);const t=this.sunLight.shadow.camera;t.left=t.bottom=-(t.top=t.right=Math.max(this.controls.getDistance()*2,5)),t.updateProjectionMatrix(),this.moonLight.position.copy(Je.clone().multiplyScalar(-200)),this._lightHelper?.update();const n=qc();this.moonLight.intensity=.3*(1-Yc.sunVisibility.value),this.sunLight.color.setFromVector3(n),this.scene.fog?.color.copy(this.sunLight.color),this.hemiLight.color.copy(this.sunLight.color),this.hemiLight.groundColor.copy(new qe(0,n.length()/10,n.length()/5))}update(e){}}export{Ls as M,df as T,ff as a,tc as l,hf as t};
