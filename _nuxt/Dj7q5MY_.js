import{u as K,a as Pe}from"./B3wAt0Eu.js";import{d as ae,ah as ye,e as C,am as Ae,s as Me,b as v,w as ve,o as Le,M as me,a as p,P as m,O as i,Y as Be,L as I,aa as he,a3 as f,u as e,J as L,c as E,r as x,ad as Ve,F as Z,K as Ye,N as Ce,ab as Fe,_ as Xe,n as Ee,ac as De,C as He,W as be,a2 as We,al as ke,an as Ie,ae as je}from"./Cdy4ovlM.js";import{E as Ke}from"./BKGLX9HH.js";import{E as qe}from"./CjP-gbnH.js";import{l as Ze,c as ze,q as J,_ as _e,a2 as Je,a3 as Ge,E as R,A as Qe,a4 as Ue,a5 as ea,a6 as aa,a7 as sa,a8 as ta,a9 as oa,R as na,w as Se,f as ra}from"./DGHzHT3a.js";import{m as Ne}from"./Bp3YSIOJ.js";import{Q as pe,I as Oe,S as la,l as q,O as ia,J as ca,W as ua}from"./BuICEgOE.js";import{b as $e}from"./DQO4yU84.js";import{E as Y}from"./BUADUvnR.js";import{d as da}from"./LkQYafET.js";import{u as fa}from"./CAIGswUD.js";import{a as va}from"./YEiEv42s.js";var ma="Expected a function";function fe(c,B,u){var d=!0,o=!0;if(typeof c!="function")throw new TypeError(ma);return Ze(u)&&(d="leading"in u?!!u.leading:d,o="trailing"in u?!!u.trailing:o),da(c,B,{leading:d,maxWait:B,trailing:o})}const pa=ze({urlList:{type:J(Array),default:()=>Ne([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:J(String)}}),ga={close:()=>!0,switch:c=>pe(c),rotate:c=>pe(c)},wa=ae({name:"ElImageViewer"}),ya=ae({...wa,props:pa,emits:ga,setup(c,{expose:B,emit:u}){var d;const o=c,g={CONTAIN:{name:"contain",icon:ye(Ge)},ORIGINAL:{name:"original",icon:ye(Je)}};let F,X="";const{t:se}=$e(),t=Oe("image-viewer"),{nextZIndex:P}=la(),z=C(),V=C([]),A=Ae(),y=C(!0),w=C(o.initialIndex),N=Me(g.CONTAIN),r=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),te=C((d=o.zIndex)!=null?d:P()),D=v(()=>{const{urlList:a}=o;return a.length<=1}),G=v(()=>w.value===0),H=v(()=>w.value===o.urlList.length-1),W=v(()=>o.urlList[w.value]),oe=v(()=>[t.e("btn"),t.e("prev"),t.is("disabled",!o.infinite&&G.value)]),ne=v(()=>[t.e("btn"),t.e("next"),t.is("disabled",!o.infinite&&H.value)]),re=v(()=>{const{scale:a,deg:l,offsetX:n,offsetY:k,enableTransition:_}=r.value;let S=n/a,T=k/a;const j=l*Math.PI/180,ge=Math.cos(j),we=Math.sin(j);S=S*ge+T*we,T=T*ge-n/a*we;const de={transform:`scale(${a}) rotate(${l}deg) translate(${S}px, ${T}px)`,transition:_?"transform .3s":""};return N.value.name===g.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),Q=v(()=>`${w.value+1} / ${o.urlList.length}`);function M(){ee(),F?.(),document.body.style.overflow=X,u("close")}function U(){const a=fe(n=>{switch(n.code){case Y.esc:o.closeOnPressEscape&&M();break;case Y.space:b();break;case Y.left:ce();break;case Y.up:$("zoomIn");break;case Y.right:ue();break;case Y.down:$("zoomOut");break}}),l=fe(n=>{const k=n.deltaY||n.deltaX;$(k<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});A.run(()=>{K(document,"keydown",a),K(document,"wheel",l)})}function ee(){A.stop()}function le(){y.value=!1}function ie(a){y.value=!1,a.target.alt=se("el.image.error")}function s(a){if(y.value||a.button!==0||!z.value)return;r.value.enableTransition=!1;const{offsetX:l,offsetY:n}=r.value,k=a.pageX,_=a.pageY,S=fe(j=>{r.value={...r.value,offsetX:l+j.pageX-k,offsetY:n+j.pageY-_}}),T=K(document,"mousemove",S);K(document,"mouseup",()=>{T()}),a.preventDefault()}function h(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function b(){if(y.value)return;const a=na(g),l=Object.values(g),n=N.value.name,_=(l.findIndex(S=>S.name===n)+1)%a.length;N.value=g[a[_]],h()}function O(a){const l=o.urlList.length;w.value=(a+l)%l}function ce(){G.value&&!o.infinite||O(w.value-1)}function ue(){H.value&&!o.infinite||O(w.value+1)}function $(a,l={}){if(y.value)return;const{minScale:n,maxScale:k}=o,{zoomRate:_,rotateDeg:S,enableTransition:T}={zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0,...l};switch(a){case"zoomOut":r.value.scale>n&&(r.value.scale=Number.parseFloat((r.value.scale/_).toFixed(3)));break;case"zoomIn":r.value.scale<k&&(r.value.scale=Number.parseFloat((r.value.scale*_).toFixed(3)));break;case"clockwise":r.value.deg+=S,u("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=S,u("rotate",r.value.deg);break}r.value.enableTransition=T}function Te(a){var l;((l=a.detail)==null?void 0:l.focusReason)==="pointer"&&a.preventDefault()}function Re(){o.closeOnPressEscape&&M()}function xe(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return ve(W,()=>{Ee(()=>{const a=V.value[0];a?.complete||(y.value=!0)})}),ve(w,a=>{h(),u("switch",a)}),Le(()=>{U(),F=K("wheel",xe,{passive:!1}),X=document.body.style.overflow,document.body.style.overflow="hidden"}),B({setActiveItem:O}),(a,l)=>(p(),me(e(qe),{to:"body",disabled:!a.teleported},{default:m(()=>[i(Be,{name:"viewer-fade",appear:""},{default:m(()=>[I("div",{ref_key:"wrapper",ref:z,tabindex:-1,class:f(e(t).e("wrapper")),style:he({zIndex:te.value})},[i(e(Ke),{loop:"",trapped:"","focus-trap-el":z.value,"focus-start-el":"container",onFocusoutPrevented:Te,onReleaseRequested:Re},{default:m(()=>[I("div",{class:f(e(t).e("mask")),onClick:Ve(n=>a.hideOnClickModal&&M(),["self"])},null,10,["onClick"]),L(" CLOSE "),I("span",{class:f([e(t).e("btn"),e(t).e("close")]),onClick:M},[i(e(R),null,{default:m(()=>[i(e(Qe))]),_:1})],2),L(" ARROW "),e(D)?L("v-if",!0):(p(),E(Z,{key:0},[I("span",{class:f(e(oe)),onClick:ce},[i(e(R),null,{default:m(()=>[i(e(Ue))]),_:1})],2),I("span",{class:f(e(ne)),onClick:ue},[i(e(R),null,{default:m(()=>[i(e(ea))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(p(),E("div",{key:1,class:f([e(t).e("btn"),e(t).e("progress")])},[x(a.$slots,"progress",{activeIndex:w.value,total:a.urlList.length},()=>[Ye(Ce(e(Q)),1)])],2)):L("v-if",!0),L(" ACTIONS "),I("div",{class:f([e(t).e("btn"),e(t).e("actions")])},[I("div",{class:f(e(t).e("actions__inner"))},[x(a.$slots,"toolbar",{actions:$,prev:ce,next:ue,reset:b,activeIndex:w.value,setActiveItem:O},()=>[i(e(R),{onClick:n=>$("zoomOut")},{default:m(()=>[i(e(aa))]),_:1},8,["onClick"]),i(e(R),{onClick:n=>$("zoomIn")},{default:m(()=>[i(e(sa))]),_:1},8,["onClick"]),I("i",{class:f(e(t).e("actions__divider"))},null,2),i(e(R),{onClick:b},{default:m(()=>[(p(),me(Fe(e(N).icon)))]),_:1}),I("i",{class:f(e(t).e("actions__divider"))},null,2),i(e(R),{onClick:n=>$("anticlockwise")},{default:m(()=>[i(e(ta))]),_:1},8,["onClick"]),i(e(R),{onClick:n=>$("clockwise")},{default:m(()=>[i(e(oa))]),_:1},8,["onClick"])])],2)],2),L(" CANVAS "),I("div",{class:f(e(t).e("canvas"))},[(p(!0),E(Z,null,Xe(a.urlList,(n,k)=>(p(),E(Z,{key:k},[k===w.value?(p(),E("img",{key:0,ref_for:!0,ref:_=>V.value[k]=_,src:n,style:he(e(re)),class:f(e(t).e("img")),crossorigin:a.crossorigin,onLoad:le,onError:ie,onMousedown:s},null,46,["src","crossorigin"])):L("v-if",!0)],64))),128))],2),x(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ha=_e(ya,[["__file","image-viewer.vue"]]);const ba=Se(ha),ka=ze({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:J([String,Object])},previewSrcList:{type:J(Array),default:()=>Ne([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:J(String)}}),Ia={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>pe(c),close:()=>!0,show:()=>!0},La=ae({name:"ElImage",inheritAttrs:!1}),Ca=ae({...La,props:ka,emits:Ia,setup(c,{expose:B,emit:u}){const d=c,{t:o}=$e(),g=Oe("image"),F=De(),X=v(()=>ra(Object.entries(F).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),se=fa({excludeListeners:!0,excludeKeys:v(()=>Object.keys(X.value))}),t=C(),P=C(!1),z=C(!0),V=C(!1),A=C(),y=C(),w=q&&"loading"in HTMLImageElement.prototype;let N;const r=v(()=>[g.e("inner"),D.value&&g.e("preview"),z.value&&g.is("loading")]),te=v(()=>{const{fit:s}=d;return q&&s?{objectFit:s}:{}}),D=v(()=>{const{previewSrcList:s}=d;return He(s)&&s.length>0}),G=v(()=>{const{previewSrcList:s,initialIndex:h}=d;let b=h;return h>s.length-1&&(b=0),b}),H=v(()=>d.loading==="eager"?!1:!w&&d.loading==="lazy"||d.lazy),W=()=>{q&&(z.value=!0,P.value=!1,t.value=d.src)};function oe(s){z.value=!1,P.value=!1,u("load",s)}function ne(s){z.value=!1,P.value=!0,u("error",s)}function re(s){s&&(W(),U())}const Q=ua(re,200,!0);async function M(){var s;if(!q)return;await Ee();const{scrollContainer:h}=d;if(ia(h))y.value=h;else if(je(h)&&h!=="")y.value=(s=document.querySelector(h))!=null?s:void 0;else if(A.value){const O=va(A.value);y.value=ca(O)?void 0:O}const{stop:b}=Pe(A,([O])=>{Q(O.isIntersecting)},{root:y});N=b}function U(){!q||!Q||(N?.(),y.value=void 0,N=void 0)}function ee(){D.value&&(V.value=!0,u("show"))}function le(){V.value=!1,u("close")}function ie(s){u("switch",s)}return ve(()=>d.src,()=>{H.value?(z.value=!0,P.value=!1,U(),M()):W()}),Le(()=>{H.value?M():W()}),B({showPreview:ee}),(s,h)=>(p(),E("div",be({ref_key:"container",ref:A},e(X),{class:[e(g).b(),s.$attrs.class]}),[P.value?x(s.$slots,"error",{key:0},()=>[I("div",{class:f(e(g).e("error"))},Ce(e(o)("el.image.error")),3)]):(p(),E(Z,{key:1},[t.value!==void 0?(p(),E("img",be({key:0},e(se),{src:t.value,loading:s.loading,style:e(te),class:e(r),crossorigin:s.crossorigin,onClick:ee,onLoad:oe,onError:ne}),null,16,["src","loading","crossorigin"])):L("v-if",!0),z.value?(p(),E("div",{key:1,class:f(e(g).e("wrapper"))},[x(s.$slots,"placeholder",{},()=>[I("div",{class:f(e(g).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),e(D)?(p(),E(Z,{key:2},[V.value?(p(),me(e(ba),{key:0,"z-index":s.zIndex,"initial-index":e(G),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:le,onSwitch:ie},We({toolbar:m(b=>[x(s.$slots,"toolbar",ke(Ie(b)))]),default:m(()=>[s.$slots.viewer?(p(),E("div",{key:0},[x(s.$slots,"viewer")])):L("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:m(b=>[x(s.$slots,"progress",ke(Ie(b)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],16))}});var Ea=_e(Ca,[["__file","image.vue"]]);const Ba=Se(Ea);export{Ba as E};
