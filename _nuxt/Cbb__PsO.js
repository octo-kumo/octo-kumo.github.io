import{H as B}from"./mpRoWkBO.js";import{p as x,k as A}from"./BSZFgSs5.js";import{f as I,h as U}from"./CV4Hssdo.js";import{f as D,h as _,n as V}from"./B9uXPSTl.js";import{d as L,h as T,g as M,b as j,T as P,U as W,w as q,j as E,Q as K,V as d,D as F}from"./Cdy4ovlM.js";function H(t,n){return n.reduce((e,o)=>{const r=Q(t,o);return r!==void 0&&(e[o]=r),e},{})}function Q(t,n){return n.split(".").reduce((e,o)=>e&&e[o],t)}const y="default",S=/^@|^v-on:/,O=/^:|^v-bind:/,z=/^v-model/,G=["select","textarea","input"],J=["math","svg"],X=Object.fromEntries(["p","a","blockquote","code","pre","code","em","h1","h2","h3","h4","h5","h6","hr","img","ul","ol","li","strong","table","thead","tbody","td","th","tr","script"].map(t=>[t,`prose-${t}`])),Y=["script","base"],Z=L({name:"MDCRenderer",props:{body:{type:Object,required:!0},data:{type:Object,default:()=>({})},class:{type:[String,Object],default:void 0},tag:{type:[String,Boolean],default:void 0},prose:{type:Boolean,default:void 0},components:{type:Object,default:()=>({})},unwrap:{type:[Boolean,String],default:!1}},async setup(t){const e=M()?.appContext?.app?.$nuxt,o=e?.$route||e?._route,{mdc:r}=e?.$config?.public||{},s=j(()=>({...r?.components?.prose&&t.prose!==!1?X:{},...r?.components?.map||{},...P(t.data?.mdc?.components||{}),...t.components})),a=j(()=>{const i=(t.body?.children||[]).map(c=>c.tag||c.type).filter(c=>!_.includes(c));return Array.from(new Set(i)).sort().join(".")}),u=W({...t.data});q(()=>t.data,i=>{Object.assign(u,i)}),await pt(t.body,{tags:s.value});function p(i,c){const l=i.split(".").length-1;return i.split(".").reduce((f,m,v)=>v==l&&f?(f[m]=c,f[m]):typeof f=="object"?f[m]:void 0,u)}return{tags:s,contentKey:a,route:o,runtimeData:u,updateRuntimeData:p}},render(t){const{tags:n,tag:e,body:o,data:r,contentKey:s,route:a,unwrap:u,runtimeData:p,updateRuntimeData:i}=t;if(!o)return null;const c={...r,tags:n,$route:a,runtimeData:p,updateRuntimeData:i},l=e!==!1?b(e||c.component?.name||c.component||"div"):void 0;return l?T(l,{...c.component?.props,class:t.class,...this.$attrs,key:s},{default:f}):f?.();function f(){const m=w(o,T,{documentMeta:c,parentScope:c,resolveComponent:b});return m?.default?u?D(m.default(),typeof u=="string"?u.split(" "):["*"]):m.default():null}}});function k(t,n,e,o){const{documentMeta:r,parentScope:s,resolveComponent:a}=e;if(t.type==="text")return n(d,t.value);if(t.type==="comment")return n(F,null,t.value);const u=t.tag,p=N(t,r.tags);if(t.tag==="binding")return tt(t,n,r,s);const i=R(p)?f=>f:a;if(Y.includes(p))return n("pre",{class:"mdc-renderer-dangerous-tag"},"<"+p+">"+V(t)+"</"+p+">");const c=i(p);typeof c=="object"&&(c.tag=u);const l=et(t,r);return o&&(l.key=o),n(c,l,w(t,n,{documentMeta:r,parentScope:{...s,...l},resolveComponent:i}))}function w(t,n,e){const{documentMeta:o,parentScope:r,resolveComponent:s}=e,u=(t.children||[]).reduce((i,c)=>{if(!ct(c))return i[y].children.push(c),i;const l=it(c);return i[l]=i[l]||{props:{},children:[]},c.type==="element"&&(i[l].props=c.props,i[l].children.push(...c.children||[])),i},{[y]:{props:{},children:[]}});return Object.entries(u).reduce((i,[c,{props:l,children:f}])=>(f.length&&(i[c]=(m={})=>{const v=H(m,Object.keys(l||{}));let h=f.map((C,$)=>k(C,n,{documentMeta:o,parentScope:{...r,...v},resolveComponent:s},String(C.props?.key||$)));return l?.unwrap&&(h=D(h,l.unwrap)),ut(h)}),i),{})}function tt(t,n,e,o={}){const r={...e.runtimeData,...o,$document:e,$doc:e},s=/\.|\[(\d+)\]/,u=(t.props?.value.trim().split(s).filter(Boolean)).reduce((i,c)=>{if(i&&c in i)return typeof i[c]=="function"?i[c]():i[c]},r),p=t.props?.defaultValue;return n(d,u??p??"")}function et(t,n){const{tag:e="",props:o={}}=t;return Object.keys(o).reduce(function(r,s){if(s==="__ignoreMap")return r;const a=o[s];if(z.test(s))return nt(s,a,r,n,{native:G.includes(e)});if(s==="v-bind")return rt(s,a,r,n);if(S.test(s))return ot(s,a,r,n);if(O.test(s))return st(s,a,r,n);const{attribute:u}=I(U,s);return Array.isArray(a)&&a.every(p=>typeof p=="string")?(r[u]=a.join(" "),r):(r[u]=a,r)},{})}function nt(t,n,e,o,{native:r}){const s=t.match(/^v-model:([^=]+)/)?.[1]||"modelValue",a=r?"value":s,u=r?"onInput":`onUpdate:${s}`;return e[a]=g(n,o.runtimeData),e[u]=p=>{o.updateRuntimeData(n,r?p.target?.value:p)},e}function rt(t,n,e,o){const r=g(n,o);return e=Object.assign(e,r),e}function ot(t,n,e,o){return t=t.replace(S,""),e.on=e.on||{},e.on[t]=()=>g(n,o),e}function st(t,n,e,o){return t=t.replace(O,""),e[t]=g(n,o),e}const b=t=>{if(typeof t=="string"){if(_.includes(t))return t;const n=E(x(t),!1);return!t||n?.name==="AsyncComponentWrapper"||typeof n=="string"?n:"setup"in n?K(()=>new Promise(e=>e(n))):n}return t};function g(t,n){const e=t.split(".").reduce((o,r)=>typeof o=="object"?o[r]:void 0,n);return typeof e>"u"?B(t):e}function it(t){let n="";for(const e of Object.keys(t.props||{}))if(!(!e.startsWith("#")&&!e.startsWith("v-slot:"))){n=e.split(/[:#]/,2)[1];break}return n||y}function ct(t){return t.tag==="template"}function R(t){return J.includes(t)}function ut(t){const n=[];for(const e of t){const o=n[n.length-1];e.type===d&&o?.type===d?o.children=o.children+e.children:n.push(e)}return n}async function pt(t,n){if(!t)return;const e=Array.from(new Set(o(t,n)));await Promise.all(e.map(async r=>{if(r?.render||r?.ssrRender||r?.__ssrInlineRender)return;const s=b(r);s?.__asyncLoader&&!s.__asyncResolved&&await s.__asyncLoader()}));function o(r,s){const a=r.tag;if(r.type==="text"||a==="binding"||r.type==="comment")return[];const u=N(r,s.tags);if(R(u))return[];const p=[];r.type!=="root"&&!_.includes(u)&&p.push(u);for(const i of r.children||[])p.push(...o(i,s));return p}}function N(t,n){const e=t.tag;return!e||typeof t.props?.__ignoreMap<"u"?e:n[e]||n[x(e)]||n[A(t.tag)]||e}const gt=Object.assign(Z,{__name:"MDCRenderer"});export{gt as _};
